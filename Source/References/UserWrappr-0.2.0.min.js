var StatsHoldr;!function(a){"use strict";var b=function(){function a(a,b,c){void 0===c&&(c={}),this.StatsHolder=a,a.proliferate(this,a.getDefaults()),a.proliferate(this,c),this.key=b,this.hasOwnProperty("value")||(this.value=this.valueDefault),this.hasElement&&(this.element=a.createElement(this.elementTag||"div",{className:a.getPrefix()+"_value "+b}),this.element.appendChild(a.createElement("div",{textContent:b})),this.element.appendChild(a.createElement("div",{textContent:this.value}))),this.storeLocally&&(a.getLocalStorage().hasOwnProperty(a.getPrefix()+b)?this.value=this.retrieveLocalStorage():this.updateLocalStorage())}return a.prototype.update=function(){this.hasOwnProperty("minimum")&&Number(this.value)<=Number(this.minimum)?(this.value=this.minimum,this.onMinimum&&this.onMinimum.apply(this,this.StatsHolder.getCallbackArgs())):this.hasOwnProperty("maximum")&&Number(this.value)<=Number(this.maximum)&&(this.value=this.maximum,this.onMaximum&&this.onMaximum.apply(this,this.StatsHolder.getCallbackArgs())),this.modularity&&this.checkModularity(),this.triggers&&this.checkTriggers(),this.hasElement&&this.updateElement(),this.storeLocally&&this.updateLocalStorage()},a.prototype.checkTriggers=function(){this.triggers.hasOwnProperty(this.value)&&this.triggers[this.value].apply(this,this.StatsHolder.getCallbackArgs())},a.prototype.checkModularity=function(){if(this.value.constructor===Number&&this.modularity)for(;this.value>=this.modularity;)this.value=Math.max(0,this.value-this.modularity),this.onModular&&this.onModular.apply(this,this.StatsHolder.getCallbackArgs())},a.prototype.updateElement=function(){this.element.children[1].textContent=this.StatsHolder.hasDisplayChange(this.value)?this.StatsHolder.getDisplayChange(this.value):this.value},a.prototype.retrieveLocalStorage=function(){var a=localStorage.getItem(this.StatsHolder.getPrefix()+this.key);switch(a){case"undefined":return void 0;case"null":return null}return a.constructor!==String?a:JSON.parse(a)},a.prototype.updateLocalStorage=function(a){void 0===a&&(a=!1),(this.StatsHolder.getAutoSave()||a)&&(this.StatsHolder.getLocalStorage()[this.StatsHolder.getPrefix()+this.key]=JSON.stringify(this.value))},a}();a.StatsValue=b;var c=function(){function a(a){void 0===a&&(a={});var b;if(this.prefix=a.prefix||"",this.autoSave=a.autoSave,this.callbackArgs=a.callbackArgs||[],this.allowNewItems=void 0===a.allowNewItems?!0:a.allowNewItems,this.localStorage=a.localStorage?a.localStorage:"undefined"==typeof localStorage?this.createPlaceholderStorage():localStorage,this.defaults=a.defaults||{},this.displayChanges=a.displayChanges||{},this.items={},a.values){this.itemKeys=Object.keys(a.values);for(b in a.values)a.values.hasOwnProperty(b)&&this.addItem(b,a.values[b])}else this.itemKeys=[];a.doMakeContainer&&(this.containersArguments=a.containersArguments||[["div",{className:this.prefix+"_container"}]],this.container=this.makeContainer(a.containersArguments))}return a.prototype.key=function(a){return this.itemKeys[a]},a.prototype.getValues=function(){return this.items},a.prototype.getDefaults=function(){return this.defaults},a.prototype.getLocalStorage=function(){return this.localStorage},a.prototype.getAutoSave=function(){return this.autoSave},a.prototype.getPrefix=function(){return this.prefix},a.prototype.getContainer=function(){return this.container},a.prototype.getContainersArguments=function(){return this.containersArguments},a.prototype.getDisplayChanges=function(){return this.displayChanges},a.prototype.getCallbackArgs=function(){return this.callbackArgs},a.prototype.getKeys=function(){return Object.keys(this.items)},a.prototype.getItem=function(a){return this.checkExistence(a),this.items[a].value},a.prototype.getObject=function(a){return this.items[a]},a.prototype.hasKey=function(a){return this.items.hasOwnProperty(a)},a.prototype.exportItems=function(){var a,b={};for(a in this.items)this.items.hasOwnProperty(a)&&(b[a]=this.items[a].value);return b},a.prototype.addItem=function(a,c){return void 0===c&&(c={}),this.items[a]=new b(this,a,c),this.itemKeys.push(a),this.items[a]},a.prototype.removeItem=function(a){this.items.hasOwnProperty(a)&&(this.container&&this.items[a].hasElement&&this.container.removeChild(this.items[a].element),this.itemKeys.splice(this.itemKeys.indexOf(a),1),delete this.items[a])},a.prototype.clear=function(){var a;if(this.container)for(a in this.items)this.items[a].hasElement&&this.container.removeChild(this.items[a].element);this.items={},this.itemKeys=[]},a.prototype.setItem=function(a,b){this.checkExistence(a),this.items[a].value=b,this.items[a].update()},a.prototype.increase=function(a,b){void 0===b&&(b=1),this.checkExistence(a),this.items[a].value+=arguments.length>1?b:1,this.items[a].update()},a.prototype.decrease=function(a,b){void 0===b&&(b=1),this.checkExistence(a),this.items[a].value-=b,this.items[a].update()},a.prototype.toggle=function(a){this.checkExistence(a),this.items[a].value=this.items[a].value?0:1,this.items[a].update()},a.prototype.checkExistence=function(a){if(!this.items.hasOwnProperty(a)){if(!this.allowNewItems)throw new Error("Unknown key given to StatsHoldr: '"+a+"'.");this.addItem(a)}},a.prototype.saveAll=function(){for(var a in this.items)this.items.hasOwnProperty(a)&&this.items[a].updateLocalStorage(!0)},a.prototype.hideContainer=function(){this.container.style.visibility="hidden"},a.prototype.displayContainer=function(){this.container.style.visibility="visible"},a.prototype.makeContainer=function(a){var b,c,d,e=this.createElement.apply(this,a[0]),f=e;for(d=1;d<a.length;++d)b=this.createElement.apply(this,a[d]),f.appendChild(b),f=b;for(c in this.items)this.items[c].hasElement&&b.appendChild(this.items[c].element);return e},a.prototype.hasDisplayChange=function(a){return this.displayChanges.hasOwnProperty(a)},a.prototype.getDisplayChange=function(a){return this.displayChanges[a]},a.prototype.createElement=function(a){void 0===a&&(a="div");for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];var d,e=document.createElement(a);for(d=0;d<b.length;d+=1)this.proliferateElement(e,b[d]);return e},a.prototype.proliferate=function(a,b,c){void 0===c&&(c=!1);var d,e;for(e in b)if(b.hasOwnProperty(e)){if(c&&a.hasOwnProperty(e))continue;d=b[e],"object"==typeof d?(a.hasOwnProperty(e)||(a[e]=new d.constructor),this.proliferate(a[e],d,c)):a[e]=d}return a},a.prototype.proliferateElement=function(a,b,c){void 0===c&&(c=!1);var d,e,f;for(e in b)if(b.hasOwnProperty(e)){if(c&&a.hasOwnProperty(e))continue;switch(d=b[e],e){case"children":if("undefined"!=typeof d)for(f=0;f<d.length;f+=1)a.appendChild(d[f]);break;case"style":this.proliferate(a[e],d);break;default:"object"==typeof d?(a.hasOwnProperty(e)||(a[e]=new d.constructor),this.proliferate(a[e],d,c)):a[e]=d}}return a},a.prototype.createPlaceholderStorage=function(){var a,b={keys:[],getItem:function(a){return this.localStorage[a]},setItem:function(a,b){this.localStorage[a]=b},clear:function(){for(a in this)this.hasOwnProperty(a)&&delete this[a]},removeItem:function(a){delete this[a]},key:function(a){return this.keys[a]}};return Object.defineProperties(b,{length:{get:function(){return b.keys.length}},remainingSpace:{get:function(){return 9001}}}),b},a}();a.StatsHoldr=c}(StatsHoldr||(StatsHoldr={}));var AudioPlayr;!function(a){"use strict";var b=function(){function a(a){var b;if("undefined"==typeof a.library)throw new Error("No library given to AudioPlayr.");if("undefined"==typeof a.directory)throw new Error("No directory given to AudioPlayr.");if("undefined"==typeof a.fileTypes)throw new Error("No fileTypes given to AudioPlayr.");if(!a.StatsHolder)throw new Error("No StatsHoldr given to AudioPlayr.");this.StatsHolder=a.StatsHolder,this.library=a.library,this.directory=a.directory,this.fileTypes=a.fileTypes,this.getThemeDefault=a.getThemeDefault||"Theme",this.getVolumeLocal="undefined"==typeof a.getVolumeLocal?1:a.getVolumeLocal,this.sounds={},this.libraryLoad(),b=this.StatsHolder.getItem("volume"),this.setVolume(void 0===b?1:this.StatsHolder.getItem("volume")),this.setMuted(this.StatsHolder.getItem("muted")||!1)}return a.prototype.getLibrary=function(){return this.library},a.prototype.getFileTypes=function(){return this.fileTypes},a.prototype.getSounds=function(){return this.sounds},a.prototype.getTheme=function(){return this.theme},a.prototype.getDirectory=function(){return this.directory},a.prototype.getVolume=function(){return Number(this.StatsHolder.getItem("volume")||0)},a.prototype.setVolume=function(a){var b;if(!this.getMuted())for(b in this.sounds)this.sounds.hasOwnProperty(b)&&(this.sounds[b].volume=Number(this.sounds[b].getAttribute("volumeReal"))*a);this.StatsHolder.setItem("volume",a.toString())},a.prototype.getMuted=function(){return Boolean(Number(this.StatsHolder.getItem("muted")))},a.prototype.setMuted=function(){this.getMuted()?this.setMutedOn():this.setMutedOff()},a.prototype.toggleMuted=function(){this.setMuted(!this.getMuted())},a.prototype.setMutedOn=function(){for(var a in this.sounds)this.sounds.hasOwnProperty(a)&&(this.sounds[a].volume=0);this.StatsHolder.setItem("muted","1")},a.prototype.setMutedOff=function(){var a,b,c=this.getVolume();for(b in this.sounds)this.sounds.hasOwnProperty(b)&&(a=this.sounds[b],a.volume=Number(a.getAttribute("volumeReal"))*c);this.StatsHolder.setItem("muted","0")},a.prototype.getGetVolumeLocal=function(){return this.getVolumeLocal},a.prototype.setGetVolumeLocal=function(a){this.getVolumeLocal=a},a.prototype.getGetThemeDefault=function(){return this.getThemeDefault},a.prototype.setGetThemeDefault=function(a){this.getThemeDefault=a},a.prototype.play=function(a){var b,c;if(this.sounds.hasOwnProperty(a))b=this.sounds[a];else{if(!this.library.hasOwnProperty(a))throw new Error("Unknown name given to AudioPlayr.play: '"+a+"'.");b=this.sounds[a]=this.library[a]}return this.soundStop(b),this.getMuted()?b.volume=0:(b.setAttribute("volumeReal","1"),b.volume=this.getVolume()),this.playSound(b),c=Number(b.getAttribute("used")),c||(b.setAttribute("used",String(c+1)),b.addEventListener("ended",this.soundFinish.bind(this,a))),b.setAttribute("name",a),b},a.prototype.pauseAll=function(){var a;for(a in this.sounds)this.sounds.hasOwnProperty(a)&&this.pauseSound(this.sounds[a])},a.prototype.resumeAll=function(){var a;for(a in this.sounds)this.sounds.hasOwnProperty(a)&&this.playSound(this.sounds[a])},a.prototype.pauseTheme=function(){this.theme&&this.pauseSound(this.theme)},a.prototype.resumeTheme=function(){this.theme&&this.playSound(this.theme)},a.prototype.clearAll=function(){this.pauseAll(),this.clearTheme(),this.sounds={}},a.prototype.clearTheme=function(){this.theme&&(this.pauseTheme(),delete this.sounds[this.theme.getAttribute("name")],this.theme=void 0)},a.prototype.playLocal=function(a,b){void 0===b&&(b=void 0);var c,d=this.play(a);switch(this.getVolumeLocal.constructor){case Function:c=this.getVolumeLocal(b);break;case Number:c=this.getVolumeLocal;break;default:c=Number(this.getVolumeLocal)||1}return d.setAttribute("volumeReal",String(c)),d.volume=this.getMuted()?0:c*this.getVolume(),d},a.prototype.playTheme=function(a,b){if(void 0===a&&(a=void 0),void 0===b&&(b=void 0),this.pauseTheme(),b="undefined"!=typeof b?b:!0,"undefined"==typeof a)switch(this.getThemeDefault.constructor){case Function:a=this.getThemeDefault();break;default:a=this.getThemeDefault}return"undefined"!=typeof this.theme&&this.theme.hasAttribute("name")&&delete this.sounds[this.theme.getAttribute("name")],this.theme=this.sounds[a]=this.play(a),this.theme.loop=b,"1"===this.theme.getAttribute("used")&&this.theme.addEventListener("ended",this.playTheme.bind(this)),this.theme},a.prototype.playThemePrefixed=function(a,b,c){void 0===a&&(a=void 0),void 0===b&&(b=void 0),void 0===c&&(c=void 0);var d=this.play(a);if(this.pauseTheme(),"undefined"==typeof b)switch(this.getThemeDefault.constructor){case Function:b=this.getThemeDefault();break;default:b=this.getThemeDefault}return this.addEventListener(a,"ended",this.playTheme.bind(this,a+" "+b,c)),d},a.prototype.addEventListener=function(a,b,c){var d=this.library[a];if(!d)throw new Error("Unknown name given to addEventListener: '"+a+"'.");d.addedEvents||(d.addedEvents={}),d.addedEvents[b]?d.addedEvents[b].push(c):d.addedEvents[b]=[c],d.addEventListener(b,c)},a.prototype.removeEventListeners=function(a,b){var c,d,e=this.library[a];if(!e)throw new Error("Unknown name given to removeEventListeners: '"+a+"'.");if(e.addedEvents&&(c=e.addedEvents[b])){for(d=0;d<c.length;d+=1)e.removeEventListener(b,c[d]);c.length=0}},a.prototype.addEventImmediate=function(a,b,c){return!this.sounds.hasOwnProperty(a)||this.sounds[a].paused?void c():void this.sounds[a].addEventListener(b,c)},a.prototype.soundFinish=function(a){this.sounds.hasOwnProperty(a)&&delete this.sounds[a]},a.prototype.soundStop=function(a){this.pauseSound(a),a.readyState&&(a.currentTime=0)},a.prototype.libraryLoad=function(){var a,b,c,d;for(c in this.library)if(this.library.hasOwnProperty(c)){a=this.library[c];for(d in a)a.hasOwnProperty(d)&&(b=a[d],this.library[b]=this.createAudio(b,c))}},a.prototype.createAudio=function(a,b){var c,d,e,f=document.createElement("audio");for(e=0;e<this.fileTypes.length;e+=1)c=this.fileTypes[e],d=document.createElement("source"),d.type="audio/"+c,d.src=this.directory+"/"+b+"/"+c+"/"+a+"."+c,f.appendChild(d);return f.volume=0,f.setAttribute("volumeReal","1"),f.setAttribute("used","0"),this.playSound(f),f},a.prototype.playSound=function(a){return a&&a.play?(a.play(),!0):!1},a.prototype.pauseSound=function(a){return a&&a.pause?(a.pause(),!0):!1},a}();a.AudioPlayr=b}(AudioPlayr||(AudioPlayr={}));var ChangeLinr;!function(a){"use strict";var b=function(){function a(a){var b;if("undefined"==typeof a.pipeline)throw new Error("No pipeline given to ChangeLinr.");if(this.pipeline=a.pipeline||[],"undefined"==typeof a.transforms)throw new Error("No transforms given to ChangeLinr.");for(this.transforms=a.transforms||{},this.doMakeCache="undefined"==typeof a.doMakeCache?!0:a.doMakeCache,this.doUseCache="undefined"==typeof a.doUseCache?!0:a.doUseCache,this.cache={},this.cacheFull={},b=0;b<this.pipeline.length;++b){if(!this.pipeline[b])throw new Error("Pipe["+b+"] is invalid.");if(!this.transforms.hasOwnProperty(this.pipeline[b])&&!this.transforms.hasOwnProperty(this.pipeline[b]))throw new Error("Pipe["+b+'] ("'+this.pipeline[b]+'") not found in transforms.');if(!(this.transforms[this.pipeline[b]]instanceof Function))throw new Error("Pipe["+b+'] ("'+this.pipeline[b]+'") is not a valid Function from transforms.');this.cacheFull[b]=this.cacheFull[this.pipeline[b]]={}}}return a.prototype.getCache=function(){return this.cache},a.prototype.getCached=function(a){return this.cache[a]},a.prototype.getCacheFull=function(){return this.cacheFull},a.prototype.getDoMakeCache=function(){return this.doMakeCache},a.prototype.getDoUseCache=function(){return this.doUseCache},a.prototype.process=function(a,b,c){void 0===b&&(b=void 0),void 0===c&&(c=void 0);var d;if("undefined"==typeof b&&(this.doMakeCache||this.doUseCache)&&(b=a),this.doUseCache&&this.cache.hasOwnProperty(b))return this.cache[b];for(d=0;d<this.pipeline.length;++d)a=this.transforms[this.pipeline[d]](a,b,c,this),this.doMakeCache&&(this.cacheFull[this.pipeline[d]][b]=a);return this.doMakeCache&&(this.cache[b]=a),a},a.prototype.processFull=function(a,b,c){void 0===c&&(c=void 0);var d,e={};for(this.process(a,b,c),d=0;d<this.pipeline.length;++d)e[d]=e[this.pipeline[d]]=this.cacheFull[this.pipeline[d]][b];return e},a}();a.ChangeLinr=b}(ChangeLinr||(ChangeLinr={}));var EightBittr;!function(a){"use strict";var b=function(){function a(b){void 0===b&&(b={});var c,d=a.prototype.ensureCorrectCaller(this),e=b.constants,f=b.constantsSource||d,g=b.requirements;if(d.unitsize=b.unitsize||1,d.constants=e,e)for(c=0;c<e.length;c+=1)d[e[c]]=f[e[c]];d.requirements=g,g&&(g.global&&"undefined"!=typeof window&&d.checkRequirements(window,g.global,"global"),g.self&&d.checkRequirements(d,g.self,"self"))}return a.prototype.checkRequirements=function(a,b,c){var d,e=[];for(d in b)b.hasOwnProperty(d)&&!a[d]&&e.push(d);if(e.length)throw new Error("Missing "+e.length+" requirement(s) in "+c+".\n"+e.map(function(a,c){return c+". "+a+": is the '"+b[a]+"' file included?"}).join("\n"))},a.prototype.reset=function(a,b,c){void 0===c&&(c=void 0);var d,e;for(a.customs=c,e=0;e<b.length;e+=1){if(d=b[e],!a[d])throw new Error(d+" is missing on a resetting EightBittr.");a[d](a,c)}},a.prototype.resetTimed=function(a,b,c){void 0===c&&(c=void 0);var d,e,f=performance.now(),g=[];for(e=0;e<b.length;e+=1)d=performance.now(),a[b[e]](a,c),g.push({name:b[e],time:performance.now()-d});return g.push({name:"resetTimed",time:performance.now()-f}),g},a.prototype.get=function(b){var c,d=a.prototype.ensureCorrectCaller.call(this);if(c=b.constructor===String?d.followPathHard(d,b.split("."),0):b instanceof Array?d.followPathHard(d,b,0):b,"function"!=typeof c)throw new Error(b+" is not defined in this EightBitter.");return c.bind(d)},a.prototype.createCanvas=function(a,b,c){void 0===c&&(c=1);var d=document.createElement("canvas"),e=d.getContext("2d");return d.width=a,d.height=b,c=c||1,d.style.width=a*c+"px",d.style.height=b*c+"px","undefined"!=typeof e.imageSmoothingEnabled?e.imageSmoothingEnabled=!1:"undefined"!=typeof e.webkitImageSmoothingEnabled?e.webkitImageSmoothingEnabled=!1:"undefined"!=typeof e.mozImageSmoothingEnabled?e.mozImageSmoothingEnabled=!1:"undefined"!=typeof e.msImageSmoothingEnabled?e.msImageSmoothingEnabled=!1:"undefined"!=typeof e.oImageSmoothingEnabled&&(e.oImageSmoothingEnabled=!1),d},a.prototype.shiftVert=function(a,b){a.top+=b,a.bottom+=b},a.prototype.shiftHoriz=function(a,b){a.left+=b,a.right+=b},a.prototype.setTop=function(a,b){a.top=b,a.bottom=a.top+a.height*a.EightBitter.unitsize},a.prototype.setRight=function(a,b){a.right=b,a.left=a.right-a.width*a.EightBitter.unitsize},a.prototype.setBottom=function(a,b){a.bottom=b,a.top=a.bottom-a.height*a.EightBitter.unitsize},a.prototype.setLeft=function(a,b){a.left=b,a.right=a.left+a.width*a.EightBitter.unitsize},a.prototype.setMid=function(a,b,c){a.EightBitter.setMidX(a,b),a.EightBitter.setMidY(a,c)},a.prototype.setMidX=function(a,b){a.EightBitter.setLeft(a,b+a.width*a.EightBitter.unitsize/2)},a.prototype.setMidY=function(a,b){a.EightBitter.setTop(a,b+a.height*a.EightBitter.unitsize/2)},a.prototype.getMidX=function(a){return a.left+a.width*a.EightBitter.unitsize/2},a.prototype.getMidY=function(a){return a.top+a.height*a.EightBitter.unitsize/2},a.prototype.setMidObj=function(a,b){a.EightBitter.setMidXObj(a,b),a.EightBitter.setMidYObj(a,b)},a.prototype.setMidXObj=function(a,b){a.EightBitter.setLeft(a,a.EightBitter.getMidX(b)-a.width*a.EightBitter.unitsize/2)},a.prototype.setMidYObj=function(a,b){a.EightBitter.setTop(a,a.EightBitter.getMidY(b)-a.height*a.EightBitter.unitsize/2)},a.prototype.objectToLeft=function(a,b){return a.EightBitter.getMidX(a)<a.EightBitter.getMidX(b)},a.prototype.updateTop=function(a,b){a.top+=b||0,a.bottom=a.top+a.height*a.EightBitter.unitsize},a.prototype.updateRight=function(a,b){a.right+=b||0,a.left=a.right-a.width*a.EightBitter.unitsize},a.prototype.updateBottom=function(a,b){a.bottom+=b||0,a.top=a.bottom-a.height*a.EightBitter.unitsize},a.prototype.updateLeft=function(a,b){a.left+=b||0,a.right=a.left+a.width*a.EightBitter.unitsize},a.prototype.slideToX=function(a,b,c){var d=a.EightBitter.getMidX(a);c=c||1/0,b>d?a.EightBitter.shiftHoriz(a,Math.min(c,b-d)):a.EightBitter.shiftHoriz(a,Math.max(-c,b-d))},a.prototype.slideToY=function(a,b,c){var d=a.EightBitter.getMidY(a);c=c||1/0,b>d?a.EightBitter.shiftVert(a,Math.min(c,b-d)):a.EightBitter.shiftVert(a,Math.max(-c,b-d))},a.prototype.ensureCorrectCaller=function(b){if(!(b instanceof a))throw new Error("A function requires the caller ('this') to be the manipulated EightBittr object. Unfortunately, 'this' is a "+typeof this+".");return b},a.prototype.proliferate=function(a,b,c){void 0===c&&(c=!1);var d,e;for(e in b)if(b.hasOwnProperty(e)){if(c&&a.hasOwnProperty(e))continue;d=b[e],"object"==typeof d?(a.hasOwnProperty(e)||(a[e]=new d.constructor),this.proliferate(a[e],d,c)):a[e]=d}return a},a.prototype.proliferateHard=function(a,b,c){void 0===c&&(c=!1);var d,e;for(e in b)if(b.hasOwnProperty(e)){if(c&&a[e])continue;d=b[e],"object"==typeof d?(a[e]||(a[e]=new d.constructor),this.proliferate(a[e],d,c)):a[e]=d}return a},a.prototype.proliferateElement=function(a,b,c){void 0===c&&(c=!1);var d,e,f;for(e in b)if(b.hasOwnProperty(e)){if(c&&a.hasOwnProperty(e))continue;switch(d=b[e],e){case"children":if("undefined"!=typeof d)for(f=0;f<d.length;f+=1)a.appendChild(d[f]);break;case"style":this.proliferate(a[e],d);break;default:null===d?a[e]=null:"object"==typeof d?(a.hasOwnProperty(e)||(a[e]=new d.constructor),this.proliferate(a[e],d,c)):a[e]=d}}return a},a.prototype.createElement=function(b){for(var c=[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];var e,f=a.prototype.ensureCorrectCaller(this),g=document.createElement(b||"div");for(e=1;e<arguments.length;e+=1)f.proliferateElement(g,arguments[e]);return g},a.prototype.followPathHard=function(a,b,c){void 0===c&&(c=0);for(var d=c||0;d<b.length;d+=1){if("undefined"==typeof a[b[d]])return void 0;a=a[b[d]]}return a},a.prototype.arraySwitch=function(a,b,c){b.splice(b.indexOf(a),1),c.push(a)},a.prototype.arrayToBeginning=function(a,b){b.splice(b.indexOf(a),1),b.unshift(a)},a.prototype.arrayToEnd=function(a,b){b.splice(b.indexOf(a),1),b.push(a)},a}();a.EightBittr=b}(EightBittr||(EightBittr={}));var FPSAnalyzr;!function(a){"use strict";var b=function(){function a(a){void 0===a&&(a={}),this.maxKept=a.maxKept||35,this.numRecorded=0,this.ticker=-1,this.measurements=isFinite(this.maxKept)?new Array(this.maxKept):{},this.getTimestamp="undefined"==typeof a.getTimestamp?"undefined"==typeof performance?function(){return Date.now()}:(performance.now||performance.webkitNow||performance.mozNow||performance.msNow||performance.oNow).bind(performance):a.getTimestamp}return a.prototype.measure=function(a){void 0===a&&(a=this.getTimestamp()),this.timeCurrent&&this.addFPS(1e3/(a-this.timeCurrent)),this.timeCurrent=a},a.prototype.addFPS=function(a){this.ticker=(this.ticker+=1)%this.maxKept,this.measurements[this.ticker]=a,this.numRecorded+=1},a.prototype.getMaxKept=function(){return this.maxKept},a.prototype.getNumRecorded=function(){return this.numRecorded},a.prototype.getTimeCurrent=function(){return this.timeCurrent},a.prototype.getTicker=function(){return this.ticker},a.prototype.getMeasurements=function(){var a,b,c=Math.min(this.maxKept,this.numRecorded);for(isFinite(this.maxKept)?a=new Array(c):(a={},a.length=c),b=c-1;b>=0;--b)a[b]=this.measurements[b];return a},a.prototype.getDifferences=function(){var a,b=this.getMeasurements();for(a=b.length-1;a>=0;--a)b[a]=1e3/b[a];return b},a.prototype.getAverage=function(){var a,b=0,c=Math.min(this.maxKept,this.numRecorded);for(a=c-1;a>=0;--a)b+=this.measurements[a];return b/c},a.prototype.getMedian=function(){var a=this.getMeasurementsSorted(),b=a.length,c=Math.floor(b/2);return a.length%2===0?a[c]:(a[c-2]+a[c])/2},a.prototype.getExtremes=function(){var a,b,c=this.measurements[0],d=c,e=Math.min(this.maxKept,this.numRecorded);for(b=e-1;b>=0;--b)a=this.measurements[b],a>d?d=a:c>a&&(c=a);return[c,d]},a.prototype.getRange=function(){var a=this.getExtremes();return a[1]-a[0]},a.prototype.getMeasurementsSorted=function(){var a,b;if(this.measurements.constructor===Array)a=this.measurements.sort();else{a=[];for(b in this.measurements)if(this.measurements.hasOwnProperty(b)){if(void 0===this.measurements[b])break;a[b]=this.measurements[b]}a.sort()}return this.numRecorded<this.maxKept&&(a.length=this.numRecorded),a.sort()},a}();a.FPSAnalyzr=b}(FPSAnalyzr||(FPSAnalyzr={}));var GamesRunnr;!function(a){"use strict";var b=function(){function a(a){var b;if("undefined"==typeof a.games)throw new Error("No games given to GamesRunnr.");for(this.games=a.games,this.interval=a.interval||1e3/60,this.speed=a.speed||1,this.onPause=a.onPause,this.onPlay=a.onPlay,this.callbackArguments=a.callbackArguments||[this],this.adjustFramerate=a.adjustFramerate,this.FPSAnalyzer=a.FPSAnalyzer||new FPSAnalyzr.FPSAnalyzr(a.FPSAnalyzerSettings),this.scope=a.scope||this,this.paused=!0,this.upkeepScheduler=a.upkeepScheduler||function(a,b){return setTimeout(a,b)},this.upkeepCanceller=a.upkeepCanceller||function(a){clearTimeout(a)},this.upkeepBound=this.upkeep.bind(this),b=0;b<this.games.length;b+=1)this.games[b]=this.games[b].bind(this.scope);this.setIntervalReal()}return a.prototype.getFPSAnalyzer=function(){return this.FPSAnalyzer},a.prototype.getPaused=function(){return this.paused},a.prototype.getGames=function(){return this.games},a.prototype.getInterval=function(){return this.interval},a.prototype.getSpeed=function(){return this.speed},a.prototype.getOnPause=function(){return this.onPause},a.prototype.getOnPlay=function(){return this.onPlay},a.prototype.getCallbackArguments=function(){return this.callbackArguments},a.prototype.getUpkeepScheduler=function(){return this.upkeepScheduler},a.prototype.getUpkeepCanceller=function(){return this.upkeepCanceller},a.prototype.upkeep=function(){this.paused||(this.upkeepCanceller(this.upkeepNext),this.adjustFramerate?this.upkeepNext=this.upkeepScheduler(this.upkeepBound,this.intervalReal-(0|this.upkeepTimed())):(this.upkeepNext=this.upkeepScheduler(this.upkeepBound,this.intervalReal),this.games.forEach(this.run)),this.FPSAnalyzer&&this.FPSAnalyzer.measure())},a.prototype.upkeepTimed=function(){if(!this.FPSAnalyzer)throw new Error("An internal FPSAnalyzr is required for upkeepTimed.");var a=this.FPSAnalyzer.getTimestamp();return this.games.forEach(this.run),this.FPSAnalyzer.getTimestamp()-a},a.prototype.play=function(){this.paused&&(this.paused=!1,this.onPlay&&this.onPlay.apply(this,this.callbackArguments),this.upkeep())},a.prototype.pause=function(){this.paused||(this.paused=!0,this.onPause&&this.onPause.apply(this,this.callbackArguments),this.upkeepCanceller(this.upkeepNext))},a.prototype.step=function(a){void 0===a&&(a=1),this.play(),this.pause(),a>0&&this.step(a-1)},a.prototype.togglePause=function(){this.paused?this.play():this.pause()},a.prototype.setInterval=function(a){var b=Number(a);if(isNaN(b))throw new Error("Invalid interval given to setInterval: "+a);this.interval=b,this.setIntervalReal()},a.prototype.setSpeed=function(a){var b=Number(a);if(isNaN(b))throw new Error("Invalid speed given to setSpeed: "+a);this.speed=b,this.setIntervalReal()},a.prototype.setIntervalReal=function(){this.intervalReal=1/this.speed*this.interval},a.prototype.run=function(a){a()},a}();a.GamesRunnr=b}(GamesRunnr||(GamesRunnr={}));var GroupHoldr;!function(a){"use strict";var b=function(){function a(a){if("undefined"==typeof a)throw new Error("No settings given to GroupHoldr.");if("undefined"==typeof a.groupNames)throw new Error("No groupNames given to GroupHoldr.");if("undefined"==typeof a.groupTypes)throw new Error("No groupTypes given to GroupHoldr.");this.functions={setGroup:{},getGroup:{},set:{},get:{},add:{},"delete":{}},this.setGroupNames(a.groupNames,a.groupTypes)}return a.prototype.getFunctions=function(){return this.functions},a.prototype.getGroups=function(){return this.groups},a.prototype.getGroup=function(a){return this.groups[a]},a.prototype.getGroupNames=function(){return this.groupNames},a.prototype.deleteObject=function(a,b){var c=this.groups[a];c.splice(c.indexOf(b),1)},a.prototype.deleteIndex=function(a,b,c){void 0===c&&(c=1);var d=this.groups[a];d.splice(b,c)},a.prototype.switchObjectGroup=function(a,b,c,d){void 0===d&&(d=void 0),this.deleteObject(b,a),this.functions.add[c](a,d)},a.prototype.applyAll=function(a,b,c){void 0===c&&(c=void 0);var d;for(c?c.unshift(void 0):c=[void 0],a||(a=this),d=this.groupNames.length-1;d>=0;d-=1)c[0]=this.groups[this.groupNames[d]],b.apply(a,c);c.shift()},a.prototype.applyOnAll=function(a,b,c){void 0===c&&(c=void 0);var d,e,f;for(c?c.unshift(void 0):c=[void 0],a||(a=this),e=this.groupNames.length-1;e>=0;e-=1)if(d=this.groups[this.groupNames[e]],d instanceof Array)for(f=0;f<d.length;f+=1)c[0]=d[f],b.apply(a,c);else for(f in d)d.hasOwnProperty(f)&&(c[0]=d[f],b.apply(a,c))},a.prototype.callAll=function(a,b){for(var c=[],d=2;d<arguments.length;d++)c[d-2]=arguments[d];var e,c=Array.prototype.slice.call(arguments,1);for(a||(a=this),e=this.groupNames.length-1;e>=0;e-=1)c[0]=this.groups[this.groupNames[e]],b.apply(a,c)},a.prototype.callOnAll=function(a,b){var c,d,e,f=Array.prototype.slice.call(arguments,1);for(a||(a=this),d=this.groupNames.length-1;d>=0;d-=1)if(c=this.groups[this.groupNames[d]],c instanceof Array)for(e=0;e<c.length;e+=1)f[0]=c[e],b.apply(a,f);else for(e in c)c.hasOwnProperty(e)&&(f[0]=c[e],b.apply(a,f))},a.prototype.clearArrays=function(){var a,b;for(b=this.groupNames.length-1;b>=0;b-=1)a=this.groups[this.groupNames[b]],a instanceof Array&&(a.length=0)},a.prototype.setGroupNames=function(a,b){var c,d,e=this;if(!(a instanceof Array))throw new Error("groupNames is not an Array");this.groupNames&&this.clearFunctions(),this.groupNames=a,this.groupTypes={},this.groupTypeNames={},b.constructor===Object?this.groupNames.forEach(function(a){e.groupTypes[a]=e.getTypeFunction(b[a]),e.groupTypeNames[a]=e.getTypeName(b[a])}):(c=this.getTypeFunction(b),d=this.getTypeName(b),this.groupNames.forEach(function(a){e.groupTypes[a]=c,e.groupTypeNames[a]=d})),this.setGroups(),this.setFunctions()},a.prototype.clearFunctions=function(){this.groupNames.forEach(function(a){delete this["set"+a+"Group"],delete this["get"+a+"Group"],delete this["set"+a],delete this["get"+a],delete this["add"+a],delete this["delete"+a],this.functions.setGroup={},this.functions.getGroup={},this.functions.set={},this.functions.get={},this.functions.add={},this.functions["delete"]={}})},a.prototype.setGroups=function(){var a=this;this.groups={},this.groupNames.forEach(function(b){a.groups[b]=new a.groupTypes[b]})},a.prototype.setFunctions=function(){var a,b;for(b=0;b<this.groupNames.length;b+=1)a=this.groupNames[b],this.createFunctionSetGroup(a),this.createFunctionGetGroup(a),this.createFunctionSet(a),this.createFunctionGet(a),this.createFunctionAdd(a),this.createFunctionDelete(a)},a.prototype.createFunctionSetGroup=function(a){var b=this;this.functions.setGroup[a]=this["set"+a+"Group"]=function(c){b.groups[a]=c}},a.prototype.createFunctionGetGroup=function(a){var b=this;this.functions.getGroup[a]=this["get"+a+"Group"]=function(){return b.groups[a]}},a.prototype.createFunctionSet=function(a){this.functions.set[a]=this["set"+a]=function(b,c){void 0===c&&(c=void 0),this.groups[a][b]=c}},a.prototype.createFunctionGet=function(a){this.functions.get[a]=this["get"+a]=function(b){return this.groups[a][b]}},a.prototype.createFunctionAdd=function(a){var b=this.groups[a];this.functions.add[a]=this["add"+a]=this.groupTypes[a]===Object?function(a,c){b[c]=a}:function(a,c){void 0!==c?b[c]=a:b.push(a)}},a.prototype.createFunctionDelete=function(a){var b=this.groups[a];this.functions["delete"][a]=this["delete"+a]=this.groupTypes[a]===Object?function(a){delete b[a]}:function(a){b.splice(b.indexOf(a),1)}},a.prototype.getTypeName=function(a){return a&&a.charAt&&"o"===a.charAt(0).toLowerCase()?"Object":"Array"},a.prototype.getTypeFunction=function(a){return a&&a.charAt&&"o"===a.charAt(0).toLowerCase()?Object:Array},a}();a.GroupHoldr=b}(GroupHoldr||(GroupHoldr={}));var InputWritr;!function(a){"use strict";var b=function(){function a(a){if(!a.triggers)throw new Error("No triggers given to InputWritr.");this.triggers=a.triggers,this.getTimestamp="undefined"==typeof a.getTimestamp?"undefined"==typeof performance?function(){return Date.now()}:(performance.now||performance.webkitNow||performance.mozNow||performance.msNow||performance.oNow).bind(performance):a.getTimestamp,this.eventInformation=a.eventInformation,this.canTrigger=a.hasOwnProperty("canTrigger")?a.canTrigger:function(){return!0},this.isRecording=a.hasOwnProperty("isRecording")?a.isRecording:function(){return!0},this.history={},this.histories={
length:0},this.aliases={},this.addAliases(a.aliases||{}),this.keyAliasesToCodes=a.keyAliasesToCodes||{shift:16,ctrl:17,space:32,left:37,up:38,right:39,down:40},this.keyCodesToAliases=a.keyCodesToAliases||{16:"shift",17:"ctrl",32:"space",37:"left",38:"up",39:"right",40:"down"}}return a.prototype.restartHistory=function(a){void 0===a&&(a=!0),a&&this.saveHistory(this.history),this.history={},this.startingTime=this.getTimestamp()},a.prototype.getAliases=function(){return this.aliases},a.prototype.getAliasesAsKeyStrings=function(){var a,b={};for(a in this.aliases)this.aliases.hasOwnProperty(a)&&(b[a]=this.getAliasAsKeyStrings(a));return b},a.prototype.getAliasAsKeyStrings=function(a){return this.aliases[a].map(this.convertAliasToKeyString.bind(this))},a.prototype.convertAliasToKeyString=function(a){return a.constructor===String?a:a>96&&105>a?String.fromCharCode(a-48):a>64&&97>a?String.fromCharCode(a):"undefined"!=typeof this.keyCodesToAliases[a]?this.keyCodesToAliases[a]:"?"},a.prototype.convertKeyStringToAlias=function(a){return a.constructor===Number?a:1===a.length?a.charCodeAt(0)-32:"undefined"!=typeof this.keyAliasesToCodes[a]?this.keyAliasesToCodes[a]:-1},a.prototype.getHistory=function(a){return void 0===a&&(a=void 0),arguments.length?this.histories[a]:history},a.prototype.getHistories=function(){return this.histories},a.prototype.getCanTrigger=function(){return this.canTrigger},a.prototype.getIsRecording=function(){return this.isRecording},a.prototype.setCanTrigger=function(a){this.canTrigger=a.constructor===Boolean?function(){return a}:a},a.prototype.setIsRecording=function(a){this.isRecording=a.constructor===Boolean?function(){return a}:a},a.prototype.setEventInformation=function(a){this.eventInformation=a},a.prototype.addAliasValues=function(a,b){var c,d,e;this.aliases.hasOwnProperty(a)?this.aliases[a].push.apply(this.aliases[a],b):this.aliases[a]=b;for(c in this.triggers)if(this.triggers.hasOwnProperty(c)&&(d=this.triggers[c],d.hasOwnProperty(a)))for(e=0;e<b.length;e+=1)d[b[e]]=d[a]},a.prototype.removeAliasValues=function(a,b){var c,d,e;if(this.aliases.hasOwnProperty(a)){for(e=0;e<b.length;e+=1)this.aliases[a].splice(this.aliases[a].indexOf(b[e],1));for(c in this.triggers)if(this.triggers.hasOwnProperty(c)&&(d=this.triggers[c],d.hasOwnProperty(a)))for(e=0;e<b.length;e+=1)d.hasOwnProperty(b[e])&&delete d[b[e]]}},a.prototype.switchAliasValues=function(a,b,c){this.removeAliasValues(a,b),this.addAliasValues(a,c)},a.prototype.addAliases=function(a){var b;for(b in a)a.hasOwnProperty(b)&&this.addAliasValues(b,a[b])},a.prototype.addEvent=function(a,b,c){var d;if(!this.triggers.hasOwnProperty(a))throw new Error("Unknown trigger requested: '"+a+"'.");if(this.triggers[a][b]=c,this.aliases.hasOwnProperty(b))for(d=0;d<this.aliases[b].length;d+=1)this.triggers[a][this.aliases[b][d]]=c},a.prototype.removeEvent=function(a,b){var c;if(!this.triggers.hasOwnProperty(a))throw new Error("Unknown trigger requested: '"+a+"'.");if(delete this.triggers[a][b],this.aliases.hasOwnProperty(b))for(c=0;c<this.aliases[b].length;c+=1)this.triggers[a][this.aliases[b][c]]&&delete this.triggers[a][this.aliases[b][c]]},a.prototype.saveHistory=function(a){void 0===a&&(a=void 0),this.histories[this.histories.length]=history,this.histories.length+=1,arguments.length&&(this.histories[a]=history)},a.prototype.playHistory=function(){this.playEvents(this.history)},a.prototype.playEvents=function(a){var b,c,d={};for(b in a)a.hasOwnProperty(b)&&(c=this.makeEventCall(a[b]),d[b]=setTimeout(c,Number(b)-this.startingTime|0))},a.prototype.callEvent=function(a,b,c){if(this.canTrigger(a,b)){if(!a)throw new Error("Blank event given, ignoring it.");return a.constructor===String&&(a=this.triggers[a][b]),a(this.eventInformation,c)}},a.prototype.makePipe=function(a,b,c){var d=this.triggers[a],e=this;if(!d)throw new Error("No trigger of label '"+a+"' defined.");return function(f){var g=f[b];c&&f.preventDefault instanceof Function&&f.preventDefault(),d.hasOwnProperty(g)&&(e.isRecording()&&(e.history[0|e.getTimestamp()]=[a,g]),e.callEvent(d[g],g,f))}},a.prototype.makeEventCall=function(a){return function(){this.callEvent(a[0],a[1])}},a}();a.InputWritr=b}(InputWritr||(InputWritr={}));var ObjectMakr;!function(a){"use strict";var b=function(){function a(a){if("undefined"==typeof a.inheritance)throw new Error("No inheritance mapping given to ObjectMakr.");this.inheritance=a.inheritance,this.properties=a.properties||{},this.doPropertiesFull=a.doPropertiesFull,this.indexMap=a.indexMap,this.onMake=a.onMake,this.functions={},this.doPropertiesFull&&(this.propertiesFull={}),this.indexMap&&this.processProperties(this.properties),this.processFunctions(this.inheritance,Object,"Object")}return a.prototype.getInheritance=function(){return this.inheritance},a.prototype.getProperties=function(){return this.properties},a.prototype.getPropertiesOf=function(a){return this.properties[a]},a.prototype.getFullProperties=function(){return this.propertiesFull},a.prototype.getFullPropertiesOf=function(a){return this.doPropertiesFull?this.propertiesFull[a]:void 0},a.prototype.getFunctions=function(){return this.functions},a.prototype.getFunction=function(a){return this.functions[a]},a.prototype.hasFunction=function(a){return this.functions.hasOwnProperty(a)},a.prototype.getIndexMap=function(){return this.indexMap},a.prototype.make=function(a,b){void 0===b&&(b=void 0);var c;if(!this.functions.hasOwnProperty(a))throw new Error("Unknown type given to ObjectMakr: "+a);return c=new this.functions[a],b&&this.proliferate(c,b),this.onMake&&c[this.onMake]&&(this.doPropertiesFull?c[this.onMake](c,a,this.properties[a],this.propertiesFull[a]):c[this.onMake](c,a,this.properties[a],this.functions[a].prototype)),c},a.prototype.processProperties=function(a){var b;for(b in a)this.properties.hasOwnProperty(b)&&this.properties[b]instanceof Array&&(this.properties[b]=this.processPropertyArray(this.properties[b]))},a.prototype.processPropertyArray=function(a){var b,c={};for(b=a.length-1;b>=0;--b)c[this.indexMap[b]]=a[b];return c},a.prototype.processFunctions=function(a,b,c){var d,e;for(d in a)if(a.hasOwnProperty(d)){this.functions[d]=new Function,this.functions[d].prototype=new b,this.functions[d].prototype.constructor=this.functions[d];for(e in this.properties[d])this.properties[d].hasOwnProperty(e)&&(this.functions[d].prototype[e]=this.properties[d][e]);if(this.doPropertiesFull){if(this.propertiesFull[d]={},c)for(e in this.propertiesFull[c])this.propertiesFull[c].hasOwnProperty(e)&&(this.propertiesFull[d][e]=this.propertiesFull[c][e]);for(e in this.properties[d])this.properties[d].hasOwnProperty(e)&&(this.propertiesFull[d][e]=this.properties[d][e])}this.processFunctions(a[d],this.functions[d],d)}},a.prototype.proliferate=function(a,b,c){void 0===c&&(c=!1);var d,e;for(e in b)c&&a.hasOwnProperty(e)||(d=b[e],"object"==typeof d?(a.hasOwnProperty(e)||(a[e]=new d.constructor),this.proliferate(a[e],d,c)):a[e]=d);return a},a}();a.ObjectMakr=b}(ObjectMakr||(ObjectMakr={}));var MapsCreatr;!function(a){"use strict";var b=function(){function a(a,b,c){this.thing=a,this.title=a.title,this.reference=b,this.spawned=!1,this.left=b.x||0,this.top=b.y||0,this.right=this.left+(b.width||c.getFullPropertiesOf(this.title).width),this.bottom=this.top+(b.height||c.getFullPropertiesOf(this.title).height),b.position&&(this.position=b.position)}return a}();a.PreThing=b;var c=function(){function a(a){if(!a)throw new Error("No settings given to MapsCreatr.");if(!a.ObjectMaker)throw new Error("No ObjectMakr given to MapsCreatr.");if(this.ObjectMaker=a.ObjectMaker,"undefined"==typeof this.ObjectMaker.getFullProperties())throw new Error("MapsCreatr's ObjectMaker must store full properties.");if(!a.groupTypes)throw new Error("No groupTypes given to MapsCreatr.");this.groupTypes=a.groupTypes,this.keyGroupType=a.keyGroupType||"groupType",this.keyEntrance=a.keyEntrance||"entrance",this.macros=a.macros||{},this.scope=a.scope||this,this.entrances=a.entrances,this.requireEntrance=a.requireEntrance,this.maps={},a.maps&&this.storeMaps(a.maps)}return a.prototype.getObjectMaker=function(){return this.ObjectMaker},a.prototype.getGroupTypes=function(){return this.groupTypes},a.prototype.getKeyGroupType=function(){return this.keyGroupType},a.prototype.getKeyEntrance=function(){return this.keyEntrance},a.prototype.getMacros=function(){return this.macros},a.prototype.getScope=function(){return this.scope},a.prototype.getRequireEntrance=function(){return this.requireEntrance},a.prototype.getMaps=function(){return this.maps},a.prototype.getMap=function(a){var b=this.maps[a];if(!b)throw new Error("No map found under: "+a);return b.initialized||(this.setMapAreas(b),this.setMapLocations(b),b.initialized=!0),b},a.prototype.storeMaps=function(a){var b;for(b in a)a.hasOwnProperty(b)&&this.storeMap(b,a[b])},a.prototype.storeMap=function(a,b){if(!a)throw new Error("Maps cannot be created with no name.");var c=this.ObjectMaker.make("Map",b);if(!c.areas)throw new Error("Maps cannot be used with no areas: "+a);if(!c.locations)throw new Error("Maps cannot be used with no locations: "+a);return this.maps[a]=c,c},a.prototype.getPreThings=function(a){var b,c=a.map,d=a.creation,e=this.fromKeys(this.groupTypes);for(a.collections={},b=0;b<d.length;b+=1)this.analyzePreSwitch(d[b],e,a,c);return this.processPreThingsArrays(e)},a.prototype.analyzePreSwitch=function(a,b,c,d){return a.macro?this.analyzePreMacro(a,b,c,d):this.analyzePreThing(a,b,c,d)},a.prototype.analyzePreMacro=function(a,b,c,d){var e,f,g=this.macros[a.macro];if(!g)return void console.warn("A non-existent macro is referenced. It will be ignored:",g,a,b,c,d);if(e=g(a,b,c,d,this.scope))if(e instanceof Array)for(f=0;f<e.length;f+=1)this.analyzePreSwitch(e[f],b,c,d);else this.analyzePreSwitch(e,b,c,d);return e},a.prototype.analyzePreThing=function(a,c,d,e){var f,g,h=a.thing;return this.ObjectMaker.hasFunction(h)?(g=new b(this.ObjectMaker.make(h,a),a,this.ObjectMaker),f=g.thing,g.thing[this.keyGroupType]?-1===this.groupTypes.indexOf(g.thing[this.keyGroupType])?void console.warn("A Thing contains an unknown "+this.keyGroupType+". It will be ignored:",f[this.keyGroupType],g,a,c,d,e):(c[g.thing[this.keyGroupType]].push(g),!f.noBoundaryStretch&&d.boundaries&&this.stretchAreaBoundaries(g,d),void 0!==f[this.keyEntrance]&&"object"!=typeof f[this.keyEntrance]&&"undefined"!=typeof e.locations[f[this.keyEntrance]]&&("undefined"==typeof e.locations[f[this.keyEntrance]].xloc&&(e.locations[f[this.keyEntrance]].xloc=g.left),"undefined"==typeof e.locations[f[this.keyEntrance]].yloc&&(e.locations[f[this.keyEntrance]].yloc=g.top),e.locations[f[this.keyEntrance]].entrance=g.thing),a.collectionName&&d.collections&&this.ensureThingCollection(g,a.collectionName,a.collectionKey,d),g):void console.warn("A Thing does not contain a "+this.keyGroupType+". It will be ignored:",g,"\n",arguments)):void console.warn("A non-existent Thing type is referenced. It will be ignored:",h,a,c,d,e)},a.prototype.setMapAreas=function(a){var b,c,d,e=a.areas,f=a.locations,g=new e.constructor,h=new f.constructor;for(d in e)e.hasOwnProperty(d)&&(b=this.ObjectMaker.make("Area",e[d]),g[d]=b,b.map=a,b.name=d,b.boundaries={top:0,right:0,bottom:0,left:0});for(d in f)if(f.hasOwnProperty(d)){if(c=this.ObjectMaker.make("Location",f[d]),h[d]=c,c.entryRaw=f[d].entry,c.name=d,c.area=f[d].area||0,this.requireEntrance&&!this.entrances.hasOwnProperty(c.entryRaw))throw new Error("Location "+d+" has unknown entry string: "+c.entryRaw);this.entrances&&c.entryRaw?c.entry=this.entrances[c.entryRaw]:c.entry&&c.entry.constructor===String&&(c.entry=this.entrances[String(c.entry)])}a.areas=g,a.locations=h},a.prototype.setMapLocations=function(a){var b,c,d=a.locations,e=new d.constructor;for(c in d)if(d.hasOwnProperty(c)&&(b=this.ObjectMaker.make("Location",d[c]),e[c]=b,b.area=a.areas[d[c].area||0],!e[c].area))throw new Error("Location "+c+" references an invalid area:"+d[c].area);a.locations=e},a.prototype.stretchAreaBoundaries=function(a,b){var c=b.boundaries;c.top=Math.min(a.top,c.top),c.right=Math.max(a.right,c.right),c.bottom=Math.max(a.bottom,c.bottom),c.left=Math.min(a.left,c.left)},a.prototype.ensureThingCollection=function(a,b,c,d){var e=a.thing,f=d.collections[b];f||(f=d.collections[b]={}),e.collection=f,f[c]=e},a.prototype.processPreThingsArrays=function(a){var b,c=this,d={};for(b in a)if(a.hasOwnProperty(b)){var e=a[b],f={xInc:this.getArraySorted(e,this.sortPreThingsXInc),xDec:this.getArraySorted(e,this.sortPreThingsXDec),yInc:this.getArraySorted(e,this.sortPreThingsYInc),yDec:this.getArraySorted(e,this.sortPreThingsYDec)};f.push=function(a){c.addArraySorted(this.xInc,a,c.sortPreThingsXInc),c.addArraySorted(this.xDec,a,c.sortPreThingsXDec),c.addArraySorted(this.yInc,a,c.sortPreThingsYInc),c.addArraySorted(this.yDec,a,c.sortPreThingsYDec)}.bind(f),d[b]=f}return d},a.prototype.fromKeys=function(a){var b,c={};for(b=0;b<a.length;b+=1)c[a[b]]=[];return c},a.prototype.getArraySorted=function(a,b){var c=a.slice();return c.sort(b),c},a.prototype.addArraySorted=function(a,b,c){for(var d,e=0,f=a.length;e!==f;)d=(e+f)/2|0,c(b,a[d])<0?f=d:e=d+1;return e===f?void a.splice(e,0,b):void 0},a.prototype.sortPreThingsXInc=function(a,b){return a.left===b.left?a.top-b.top:a.left-b.left},a.prototype.sortPreThingsXDec=function(a,b){return b.right===a.right?b.bottom-a.bottom:b.right-a.right},a.prototype.sortPreThingsYInc=function(a,b){return a.top===b.top?a.left-b.left:a.top-b.top},a.prototype.sortPreThingsYDec=function(a,b){return b.bottom===a.bottom?b.right-a.right:b.bottom-a.bottom},a}();a.MapsCreatr=c}(MapsCreatr||(MapsCreatr={}));var MapScreenr;!function(a){"use strict";var b=function(){function a(a){var b;if("undefined"==typeof a.width)throw new Error("No width given to MapScreenr.");if("undefined"==typeof a.height)throw new Error("No height given to MapScreenr.");for(b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);this.variables=a.variables||{},this.variableArgs=a.variableArgs||[]}return a.prototype.clearScreen=function(){this.left=0,this.top=0,this.right=this.width,this.bottom=this.height,this.setMiddleX(),this.setMiddleY(),this.setVariables()},a.prototype.setMiddleX=function(){this.middleX=(this.left+this.right)/2},a.prototype.setMiddleY=function(){this.middleY=(this.top+this.bottom)/2},a.prototype.setVariables=function(){var a;for(a in this.variables)this.variables.hasOwnProperty(a)&&(this[a]=this.variables[a].apply(this,this.variableArgs))},a.prototype.shift=function(a,b){a&&this.shiftX(a),b&&this.shiftY(b)},a.prototype.shiftX=function(a){this.left+=a,this.right+=a},a.prototype.shiftY=function(a){this.top+=a,this.bottom+=a},a}();a.MapScreenr=b}(MapScreenr||(MapScreenr={}));var MapsHandlr;!function(a){"use strict";var b=function(){function a(a){if(!a)throw new Error("No settings given to MapsHandlr.");if(!a.MapsCreator)throw new Error("No MapsCreator provided to MapsHandlr.");if(this.MapsCreator=a.MapsCreator,!a.MapScreener)throw new Error("No MapScreener provided to MapsHandlr.");this.MapScreener=a.MapScreener,this.onSpawn=a.onSpawn,this.onUnspawn=a.onUnspawn,this.screenAttributes=a.screenAttributes||[],this.stretchAdd=a.stretchAdd,this.afterAdd=a.afterAdd}return a.prototype.getMapsCreator=function(){return this.MapsCreator},a.prototype.getMapScreener=function(){return this.MapScreener},a.prototype.getScreenAttributes=function(){return this.screenAttributes},a.prototype.getMapName=function(){return this.mapName},a.prototype.getMap=function(a){return void 0===a&&(a=void 0),"undefined"!=typeof a?this.MapsCreator.getMap(a):this.mapCurrent},a.prototype.getMaps=function(){return this.MapsCreator.getMaps()},a.prototype.getArea=function(){return this.areaCurrent},a.prototype.getAreaName=function(){return this.areaCurrent.name},a.prototype.getLocation=function(a){return this.areaCurrent.map.locations[a]},a.prototype.getPreThings=function(){return this.prethings},a.prototype.setMap=function(a,b){if(void 0===b&&(b=void 0),this.mapCurrent=this.getMap(a),!this.mapCurrent)throw new Error("Unknown Map in setMap: '"+a+"'.");return this.mapName=a,arguments.length>1&&this.setLocation(b),this.mapCurrent},a.prototype.setLocation=function(a){var b,c,d;if(b=this.mapCurrent.locations[a],!b)throw new Error("Unknown location in setLocation: '"+a+"'.");for(this.locationCurrent=b,this.areaCurrent=b.area,this.areaCurrent.boundaries={top:0,right:0,bottom:0,left:0},d=0;d<this.screenAttributes.length;d+=1)c=this.screenAttributes[d],this.MapScreener[c]=this.areaCurrent[c];this.prethings=this.MapsCreator.getPreThings(b.area),this.areaCurrent.stretches?this.setStretches(this.areaCurrent.stretches):this.stretches=void 0,this.areaCurrent.afters?this.setAfters(this.areaCurrent.afters):this.afters=void 0},a.prototype.setStretches=function(a){this.stretches=a,this.stretches.forEach(this.stretchAdd)},a.prototype.setAfters=function(a){this.afters=a,this.afters.forEach(this.afterAdd)},a.prototype.spawnMap=function(a,b,c,d,e){this.onSpawn&&this.applySpawnAction(this.onSpawn,!0,a,b,c,d,e)},a.prototype.unspawnMap=function(a,b,c,d,e){this.onUnspawn&&this.applySpawnAction(this.onUnspawn,!1,a,b,c,d,e)},a.prototype.applySpawnAction=function(a,b,c,d,e,f,g){var h,i,j,k,l,m,n;for(h in this.prethings)if(this.prethings.hasOwnProperty(h)&&(i=this.prethings[h][c],0!==i.length))for(k=i.length/2|0,l=this.findPreThingsSpawnStart(c,i,k,d,e,f,g),m=this.findPreThingsSpawnEnd(c,i,k,d,e,f,g),n=l;m>=n;n+=1)j=i[n],j.spawned!==b&&(j.spawned=b,a(j))},a.prototype.findPreThingsSpawnStart=function(b,c,d,e,f,g,h){var i,j=a.directionKeys[b],k=this.getDirectionEnd(j,e,f,g,h);for(i=0;i<c.length;i+=1)if(c[i][j]>=k)return i;return i},a.prototype.findPreThingsSpawnEnd=function(b,c,d,e,f,g,h){var i,j=a.directionKeys[b],k=a.directionKeys[a.directionOpposites[b]],l=this.getDirectionEnd(k,e,f,g,h);for(i=c.length-1;i>=0;i-=1)if(c[i][j]<=l)return i;return i},a.prototype.getDirectionEnd=function(a,b,c,d,e){switch(a){case"top":return b;case"right":return c;case"bottom":return d;case"left":return e;default:throw new Error("Unknown directionKey: "+a)}},a.directionKeys={xInc:"left",xDec:"right",yInc:"top",yDec:"bottom"},a.directionOpposites={xInc:"xDec",xDec:"xInc",yInc:"yDec",yDec:"yInc"},a}();a.MapsHandlr=b}(MapsHandlr||(MapsHandlr={}));var StringFilr;!function(a){"use strict";var b=function(){function a(a){if(!a)throw new Error("No settings given to StringFilr.");if(!a.library)throw new Error("No library given to StringFilr.");if(this.library=a.library,this.normal=a.normal,this.requireNormalKey=a.requireNormalKey,this.cache={},this.requireNormalKey){if("undefined"==typeof this.normal)throw new Error("StringFilr is given requireNormalKey, but no normal class.");this.ensureLibraryNormal()}}return a.prototype.getLibrary=function(){return this.library},a.prototype.getNormal=function(){return this.normal},a.prototype.getCache=function(){return this.cache},a.prototype.getCached=function(a){return this.cache[a]},a.prototype.clearCache=function(){this.cache={}},a.prototype.clearCached=function(a){this.normal&&(a=a.replace(this.normal,"")),delete this.cache[a]},a.prototype.get=function(a){var b,c;return b=this.normal?a.replace(this.normal,""):a,this.cache.hasOwnProperty(b)?this.cache[b]:(c=this.followClass(b.split(/\s+/g),this.library),this.cache[b]=this.cache[a]=c,c)},a.prototype.findLackingNormal=function(a,b,c){var d;if(a.hasOwnProperty(this.normal)||c.push(b),"object"==typeof a[d])for(d in a)a.hasOwnProperty(d)&&this.findLackingNormal(a[d],b+" "+d,c);return c},a.prototype.followClass=function(a,b){var c,d;if(!a||!a.length)return b;for(d=0;d<a.length;d+=1)if(c=a[d],b.hasOwnProperty(c))return a.splice(d,1),this.followClass(a,b[c]);return this.normal&&b.hasOwnProperty(this.normal)?this.followClass(a,b[this.normal]):b},a.prototype.ensureLibraryNormal=function(){var a=this.findLackingNormal(this.library,"base",[]);if(a.length)throw new Error("Found "+a.length+" library sub-directories missing the normal: \r\n  "+a.join("\r\n  "))},a}();a.StringFilr=b}(StringFilr||(StringFilr={}));var PixelRendr;!function(a){"use strict";var b=function(){function a(a){if(!a)throw new Error("No settings given to PixelRendr.");if(!a.paletteDefault)throw new Error("No paletteDefault given to PixelRendr.");this.paletteDefault=a.paletteDefault,this.digitsizeDefault=this.getDigitSize(this.paletteDefault),this.digitsplit=new RegExp(".{1,"+this.digitsizeDefault+"}","g"),this.library={raws:a.library||{},posts:[]},this.filters=a.filters||{},this.scale=a.scale||1,this.flipVert=a.flipVert||"flip-vert",this.flipHoriz=a.flipHoriz||"flip-horiz",this.spriteWidth=a.spriteWidth||"spriteWidth",this.spriteHeight=a.spriteHeight||"spriteHeight",this.Uint8ClampedArray=a.Uint8ClampedArray||window.Uint8ClampedArray||window.Uint8Array,this.ProcessorBase=new ChangeLinr.ChangeLinr({transforms:{spriteUnravel:this.spriteUnravel.bind(this),spriteApplyFilter:this.spriteApplyFilter.bind(this),spriteExpand:this.spriteExpand.bind(this),spriteGetArray:this.spriteGetArray.bind(this)},pipeline:["spriteUnravel","spriteApplyFilter","spriteExpand","spriteGetArray"]}),this.ProcessorDims=new ChangeLinr.ChangeLinr({transforms:{spriteRepeatRows:this.spriteRepeatRows.bind(this),spriteFlipDimensions:this.spriteFlipDimensions.bind(this)},pipeline:["spriteRepeatRows","spriteFlipDimensions"]}),this.ProcessorEncode=new ChangeLinr.ChangeLinr({transforms:{imageGetData:this.imageGetData.bind(this),imageGetPixels:this.imageGetPixels.bind(this),imageMapPalette:this.imageMapPalette.bind(this),imageCombinePixels:this.imageCombinePixels.bind(this)},pipeline:["imageGetData","imageGetPixels","imageMapPalette","imageCombinePixels"],doUseCache:!1}),this.library.sprites=this.libraryParse(this.library.raws,""),this.libraryPosts(),this.BaseFiler=new StringFilr.StringFilr({library:this.library.sprites,normal:"normal"})}return a.prototype.getBaseLibrary=function(){return this.BaseFiler.getLibrary()},a.prototype.getBaseFiler=function(){return this.BaseFiler},a.prototype.getProcessorBase=function(){return this.ProcessorBase},a.prototype.getProcessorDims=function(){return this.ProcessorDims},a.prototype.getProcessorEncode=function(){return this.ProcessorEncode},a.prototype.getSpriteBase=function(a){return this.BaseFiler.get(a)},a.prototype.decode=function(a,b){var c=this.BaseFiler.get(a);if(!c)throw new Error("No raw sprite found for "+a+".");if(c.multiple)c.processed||this.processSpriteMultiple(c,a,b);else{if(!(c instanceof this.Uint8ClampedArray))throw new Error("No single raw sprite found for: '"+a+"'");c=this.ProcessorDims.process(c,a,b)}return c},a.prototype.encode=function(a,b,c){var d=this.ProcessorEncode.process(a);return b&&b(d,a,c),d},a.prototype.encodeUri=function(a,b){var c=document.createElement("img");c.onload=this.encode.bind(self,c,b),c.src=a},a.prototype.generatePaletteFromRawData=function(a,b,c){void 0===b&&(b=!1),void 0===c&&(c=!1);var d,e,f={},g=[],h=[];for(e=0;e<a.length;e+=4)0!==a[e+3]?f[a[e]]&&f[a[e]][a[e+1]]&&f[a[e]][a[e+1]][a[e+2]]&&f[a[e]][a[e+1]][a[e+2]][a[e+3]]||(f[a[e]]||(f[a[e]]={}),f[a[e]][a[e+1]]||(f[a[e]][a[e+1]]={}),f[a[e]][a[e+1]][a[e+2]]||(f[a[e]][a[e+1]][a[e+2]]={}),f[a[e]][a[e+1]][a[e+2]][a[e+3]]||(f[a[e]][a[e+1]][a[e+2]][a[e+3]]=!0,a[e]===a[e+1]&&a[e+1]===a[e+2]?h.push(a.subarray(e,e+4)):g.push(a.subarray(e,e+4)))):b=!0;if(h.sort(function(a,b){return a[0]-b[0]}),g.sort(function(a,b){for(e=0;4>e;e+=1)if(a[e]!==b[e])return b[e]-a[e]}),d=b?[new this.Uint8ClampedArray([0,0,0,0])].concat(h).concat(g):h.concat(g),!c)return d;for(e=0;e<d.length;e+=1)d[e]=Array.prototype.slice.call(d[e]);return d},a.prototype.memcpyU8=function(a,b,c,d,e){if(void 0===c&&(c=0),void 0===d&&(d=0),void 0===e&&(e=Math.max(0,Math.min(a.length,b.length))),!(!a||!b||0>c||0>d||0>=e||c>=a.length||d>=b.length))for(var f=e+0,g=d+0,h=c+0;f--;)b[g++]=a[h++]},a.prototype.libraryParse=function(a,b){var c,d,e={};for(d in a)if(a.hasOwnProperty(d))switch(c=a[d],c.constructor){case String:e[d]=this.ProcessorBase.process(c,b+" "+d);break;case Array:this.library.posts.push({caller:e,name:d,command:a[d],path:b+" "+d});break;default:e[d]=this.libraryParse(c,b+" "+d)}return e},a.prototype.libraryPosts=function(){var a,b,c=this.library.posts;for(b=0;b<c.length;b+=1)a=c[b],a.caller[a.name]=this.evaluatePost(a.caller,a.command,a.path)},a.prototype.evaluatePost=function(a,b,c){var d,e;switch(b[0]){case"same":return d=this.followPath(this.library.raws,b[1],0),d.constructor===String?this.ProcessorBase.process(d,c):d.constructor===Array?this.evaluatePost(a,d,c):this.libraryParse(d,c);case"filter":return d=this.followPath(this.library.raws,b[1],0),e=this.filters[b[2]],e||(console.warn("Invalid filter provided:",b[2],this.filters),e={}),this.evaluatePostFilter(d,c,e);case"multiple":return this.evaluatePostMultiple(c,b);default:console.warn("Unknown post command: '"+b[0]+"'.",a,b,c)}},a.prototype.evaluatePostFilter=function(a,b,c){if(a.constructor===String)return this.ProcessorBase.process(a,b,{filter:c});if(a instanceof Array)return this.evaluatePostFilter(this.followPath(this.library.raws,a[1],0),a[1].join(" "),c);if(a instanceof Object){var d,e={};for(d in a)a.hasOwnProperty(d)&&(e[d]=this.evaluatePostFilter(a[d],b+" "+d,c));return e}console.warn("Invalid sprite provided for a post filter.",a,b,c)},a.prototype.evaluatePostMultiple=function(a,b){var c,d=b[1],e=b[2],f={direction:d,multiple:!0,sprites:{},processed:!1,topheight:0|e.topheight,rightwidth:0|e.rightwidth,bottomheight:0|e.bottomheight,leftwidth:0|e.leftwidth,middleStretch:e.middleStretch||!1};for(c in e)e.hasOwnProperty(c)&&(f.sprites[c]=this.ProcessorBase.process(e[c],a+d+c));return f},a.prototype.processSpriteMultiple=function(a,b,c){var d;for(d in a.sprites)a.sprites[d]instanceof this.Uint8ClampedArray&&(a.sprites[d]=this.ProcessorDims.process(a.sprites[d],b+" "+d,c));a.processed=!0},a.prototype.spriteUnravel=function(a){for(var b,c,d,e=this.getPaletteReferenceStarting(this.paletteDefault),f=this.digitsizeDefault,g=a.length,h="",i=0;g>i;)switch(a[i]){case"x":for(d=a.indexOf(",",++i),b=this.makeDigit(e[a.slice(i,i+=f)],this.digitsizeDefault),c=Number(a.slice(i,d));c--;)h+=b;i=d+1;break;case"p":"["===a[++i]?(d=a.indexOf("]"),e=this.getPaletteReference(a.slice(i+1,d).split(",")),i=d+1,f=1):(e=this.getPaletteReference(this.paletteDefault),f=this.digitsizeDefault);break;default:h+=this.makeDigit(e[a.slice(i,i+=f)],this.digitsizeDefault)}return h},a.prototype.spriteExpand=function(a){for(var b,c,d="",e=a.length,f=0;e>f;)for(c=a.slice(f,f+=this.digitsizeDefault),b=0;b<this.scale;++b)d+=c;return d},a.prototype.spriteApplyFilter=function(a,b,c){if(!c||!c.filter)return a;var d=c.filter,e=d[0];if(!e)return a;switch(e){case"palette":var f,g=a.match(this.digitsplit);for(f in d[1])d[1].hasOwnProperty(f)&&this.arrayReplace(g,f,d[1][f]);return g.join("");default:console.warn("Unknown filter: '"+e+"'.")}return a},a.prototype.spriteGetArray=function(a){var b,c,d,e,f=a.length,g=f/this.digitsizeDefault,h=a.match(this.digitsplit),i=4*g,j=new this.Uint8ClampedArray(i);for(c=0,d=0;g>c;++c){for(b=this.paletteDefault[Number(h[c])],e=0;4>e;++e)j[d+e]=b[e];d+=4}return j},a.prototype.spriteRepeatRows=function(a,b,c){var d,e,f=new this.Uint8ClampedArray(a.length*this.scale),g=4*c[this.spriteWidth],h=c[this.spriteHeight]*this.scale,i=0,j=0;for(d=0;h>d;++d){for(e=0;e<this.scale;++e)this.memcpyU8(a,f,i,j,g),j+=g;i+=g}return f},a.prototype.spriteFlipDimensions=function(a,b,c){return-1!==b.indexOf(this.flipHoriz)?-1!==b.indexOf(this.flipVert)?this.flipSpriteArrayBoth(a):this.flipSpriteArrayHoriz(a,c):-1!==b.indexOf(this.flipVert)?this.flipSpriteArrayVert(a,c):a},a.prototype.flipSpriteArrayHoriz=function(a,b){var c,d,e,f,g,h=a.length,i=b[this.spriteWidth]+0,j=new this.Uint8ClampedArray(h),k=4*i;for(e=0;h>e;e+=k)for(c=e,d=e+k-4,f=0;k>f;f+=4){for(g=0;4>g;++g)j[c+g]=a[d+g];c+=4,d-=4}return j},a.prototype.flipSpriteArrayVert=function(a,b){for(var c,d,e=a.length,f=b[this.spriteWidth]+0,g=new this.Uint8ClampedArray(e),h=4*f,i=0,j=e-h;e>i;){for(c=0;h>c;c+=4)for(d=0;4>d;++d)g[i+c+d]=a[j+c+d];i+=h,j-=h}return g},a.prototype.flipSpriteArrayBoth=function(a){for(var b,c=a.length,d=new this.Uint8ClampedArray(c),e=a.length-4,f=0;c>f;){for(b=0;4>b;++b)d[f+b]=a[e+b];f+=4,e-=4}return d},a.prototype.imageGetData=function(a){var b=document.createElement("canvas"),c=b.getContext("2d");return b.width=a.width,b.height=a.height,c.drawImage(a,0,0),c.getImageData(0,0,a.width,a.height).data},a.prototype.imageGetPixels=function(a){var b,c,d,e=new Array(a.length/4),f={};for(c=0,d=0;c<a.length;c+=4,d+=1)b=this.getClosestInPalette(this.paletteDefault,a.subarray(c,c+4)),e[d]=b,f.hasOwnProperty(b)?f[b]+=1:f[b]=1;return[e,f]},a.prototype.imageMapPalette=function(a){var b=a[0],c=a[1],d=Object.keys(c),e=this.getDigitSize(d),f=this.getValueIndices(d),g=b.map(this.getKeyValue.bind(this,f));return[d,g,e]},a.prototype.imageCombinePixels=function(a){var b,c,d,e,f=a[0],g=a[1],h=a[2],i=Math.max(3,Math.round(4/h)),j=0;for(b="p["+f.map(this.makeSizedDigit.bind(this,h)).join(",")+"]";j<g.length;){for(e=j+1,c=g[j],d=this.makeDigit(c,h);c===g[e];)e+=1;if(e-j>i)b+="x"+d+String(e-j)+",",j=e;else do b+=d,j+=1;while(e>j)}return b},a.prototype.getDigitSize=function(a){return Math.floor(Math.log(a.length)/Math.LN10)+1},a.prototype.getPaletteReference=function(a){var b,c={},d=this.getDigitSize(a);for(b=0;b<a.length;b+=1)c[this.makeDigit(b,d)]=this.makeDigit(a[b],d);return c},a.prototype.getPaletteReferenceStarting=function(a){var b,c={};for(b=0;b<a.length;b+=1)c[this.makeDigit(b,this.digitsizeDefault)]=this.makeDigit(b,this.digitsizeDefault);return c},a.prototype.getClosestInPalette=function(a,b){var c,d,e,f=1/0;for(e=a.length-1;e>=0;e-=1)c=this.arrayDifference(a[e],b),f>c&&(f=c,d=e);return d},a.prototype.stringOf=function(a,b){return void 0===b&&(b=1),0===b?"":new Array(1+(b||1)).join(a)},a.prototype.makeDigit=function(a,b,c){return void 0===c&&(c="0"),this.stringOf(c,Math.max(0,b-String(a).length))+a},a.prototype.makeSizedDigit=function(a,b){return this.makeDigit(b,a,"0")},a.prototype.arrayReplace=function(a,b,c){for(var d=a.length-1;d>=0;d-=1)a[d]===b&&(a[d]=c);return a},a.prototype.arrayDifference=function(a,b){var c,d=0;for(c=a.length-1;c>=0;c-=1)d+=0|Math.abs(a[c]-b[c]);return d},a.prototype.getValueIndices=function(a){var b,c={};for(b=0;b<a.length;b+=1)c[a[b]]=b;return c},a.prototype.getKeyValue=function(a,b){return a[b]},a.prototype.followPath=function(a,b,c){return c<b.length&&a.hasOwnProperty(b[c])?this.followPath(a[b[c]],b,c+1):a},a}();a.PixelRendr=b}(PixelRendr||(PixelRendr={}));var QuadsKeepr;!function(a){"use strict";var b=function(){function a(a){if(!a.ObjectMaker)throw new Error("No ObjectMaker given to QuadsKeepr.");if(this.ObjectMaker=a.ObjectMaker,!a.numRows)throw new Error("No numRows given to QuadsKeepr.");if(this.numRows=a.numRows,!a.numCols)throw new Error("No numCols given to QuadsKeepr.");if(this.numCols=a.numCols,!a.quadrantWidth)throw new Error("No quadrantWidth given to QuadsKeepr.");if(this.quadrantWidth=0|a.quadrantWidth,!a.quadrantHeight)throw new Error("No quadrantHeight given to QuadsKeepr.");if(this.quadrantHeight=0|a.quadrantHeight,!a.groupNames)throw new Error("No groupNames given to QuadsKeepr.");this.groupNames=a.groupNames,this.onAdd=a.onAdd,this.onRemove=a.onRemove,this.startLeft=0|a.startLeft,this.startTop=0|a.startTop,this.keyTop=a.keyTop||"top",this.keyLeft=a.keyLeft||"left",this.keyBottom=a.keyBottom||"bottom",this.keyRight=a.keyRight||"right",this.keyNumQuads=a.keyNumQuads||"numquads",this.keyQuadrants=a.keyQuadrants||"quadrants",this.keyChanged=a.keyChanged||"changed",this.keyToleranceX=a.keyToleranceX||"tolx",this.keyToleranceY=a.keyToleranceY||"toly",this.keyGroupName=a.keyGroupName||"group",this.keyOffsetX=a.keyOffsetX,this.keyOffsetY=a.keyOffsetY}return a.prototype.getQuadrantRows=function(){return this.quadrantRows},a.prototype.getQuadrantCols=function(){return this.quadrantCols},a.prototype.getNumRows=function(){return this.numRows},a.prototype.getNumCols=function(){return this.numCols},a.prototype.getQuadrantWidth=function(){return this.quadrantWidth;

},a.prototype.getQuadrantHeight=function(){return this.quadrantHeight},a.prototype.resetQuadrants=function(){var a,b,c,d=this.startLeft,e=this.startTop;for(this.top=this.startTop,this.right=this.startLeft+this.quadrantWidth*this.numCols,this.bottom=this.startTop+this.quadrantHeight*this.numRows,this.left=this.startLeft,this.quadrantRows=[],this.quadrantCols=[],this.offsetX=0,this.offsetY=0,b=0;b<this.numRows;b+=1)this.quadrantRows.push({left:this.startLeft,top:e,quadrants:[]}),e+=this.quadrantHeight;for(c=0;c<this.numCols;c+=1)this.quadrantCols.push({left:d,top:this.startTop,quadrants:[]}),d+=this.quadrantWidth;for(e=this.startTop,b=0;b<this.numRows;b+=1){for(d=this.startLeft,c=0;c<this.numCols;c+=1)a=this.createQuadrant(d,e),this.quadrantRows[b].quadrants.push(a),this.quadrantCols[c].quadrants.push(a),d+=this.quadrantWidth;e+=this.quadrantHeight}this.onAdd&&this.onAdd("xInc",this.top,this.right,this.bottom,this.left)},a.prototype.shiftQuadrants=function(a,b){void 0===a&&(a=0),void 0===b&&(b=0);var c,d;for(a=0|a,b=0|b,this.offsetX+=a,this.offsetY+=b,this.top+=b,this.right+=a,this.bottom+=b,this.left+=a,c=0;c<this.numRows;c+=1)this.quadrantRows[c].left+=a,this.quadrantRows[c].top+=b;for(d=0;d<this.numCols;d+=1)this.quadrantCols[d].left+=a,this.quadrantCols[d].top+=b;for(c=0;c<this.numRows;c+=1)for(d=0;d<this.numCols;d+=1)this.shiftQuadrant(this.quadrantRows[c].quadrants[d],a,b);this.adjustOffsets()},a.prototype.pushQuadrantRow=function(a){void 0===a&&(a=!1);var b,c=this.createQuadrantRow(this.left,this.bottom);for(this.numRows+=1,this.quadrantRows.push(c),b=0;b<this.quadrantCols.length;b+=1)this.quadrantCols[b].quadrants.push(c.quadrants[b]);return this.bottom+=this.quadrantHeight,a&&this.onAdd&&this.onAdd("yInc",this.bottom,this.right,this.bottom-this.quadrantHeight,this.left),c},a.prototype.pushQuadrantCol=function(a){void 0===a&&(a=!1);var b,c=this.createQuadrantCol(this.right,this.top);for(this.numCols+=1,this.quadrantCols.push(c),b=0;b<this.quadrantRows.length;b+=1)this.quadrantRows[b].quadrants.push(c.quadrants[b]);return this.right+=this.quadrantWidth,a&&this.onAdd&&this.onAdd("xInc",this.top,this.right-this.offsetY,this.bottom,this.right-this.quadrantWidth-this.offsetY),c},a.prototype.popQuadrantRow=function(a){void 0===a&&(a=!1);for(var b=0;b<this.quadrantCols.length;b+=1)this.quadrantCols[b].quadrants.pop();this.numRows-=1,this.quadrantRows.pop(),a&&this.onRemove&&this.onRemove("yInc",this.bottom,this.right,this.bottom-this.quadrantHeight,this.left),this.bottom-=this.quadrantHeight},a.prototype.popQuadrantCol=function(a){void 0===a&&(a=!1);for(var b=0;b<this.quadrantRows.length;b+=1)this.quadrantRows[b].quadrants.pop();this.numCols-=1,this.quadrantCols.pop(),a&&this.onRemove&&this.onRemove("xDec",this.top,this.right-this.offsetY,this.bottom,this.right-this.quadrantWidth-this.offsetY),this.right-=this.quadrantWidth},a.prototype.unshiftQuadrantRow=function(a){void 0===a&&(a=!1);var b,c=this.createQuadrantRow(this.left,this.top-this.quadrantHeight);for(this.numRows+=1,this.quadrantRows.unshift(c),b=0;b<this.quadrantCols.length;b+=1)this.quadrantCols[b].quadrants.unshift(c.quadrants[b]);return this.top-=this.quadrantHeight,a&&this.onAdd&&this.onAdd("yInc",this.top,this.right,this.top+this.quadrantHeight,this.left),c},a.prototype.unshiftQuadrantCol=function(a){void 0===a&&(a=!1);var b,c=this.createQuadrantCol(this.left-this.quadrantWidth,this.top);for(this.numCols+=1,this.quadrantCols.unshift(c),b=0;b<this.quadrantRows.length;b+=1)this.quadrantRows[b].quadrants.unshift(c.quadrants[b]);return this.left-=this.quadrantWidth,a&&this.onAdd&&this.onAdd("xInc",this.top,this.left,this.bottom,this.left+this.quadrantWidth),c},a.prototype.shiftQuadrantRow=function(a){void 0===a&&(a=!1);for(var b=0;b<this.quadrantCols.length;b+=1)this.quadrantCols[b].quadrants.shift();this.numRows-=1,this.quadrantRows.pop(),a&&this.onRemove&&this.onRemove("yInc",this.top,this.right,this.top+this.quadrantHeight,this.left),this.top+=this.quadrantHeight},a.prototype.shiftQuadrantCol=function(a){void 0===a&&(a=!1);for(var b=0;b<this.quadrantRows.length;b+=1)this.quadrantRows[b].quadrants.shift();this.numCols-=1,this.quadrantCols.pop(),a&&this.onRemove&&this.onRemove("xInc",this.top,this.left+this.quadrantWidth,this.bottom,this.left),this.left+=this.quadrantWidth},a.prototype.determineAllQuadrants=function(a,b){var c,d;for(c=0;c<this.numRows;c+=1)for(d=0;d<this.numCols;d+=1)this.quadrantRows[c].quadrants[d].numthings[a]=0;b.forEach(this.determineThingQuadrants.bind(this))},a.prototype.determineThingQuadrants=function(a){var b,c,d=a[this.keyGroupName],e=this.findQuadrantRowStart(a),f=this.findQuadrantColStart(a),g=this.findQuadrantRowEnd(a),h=this.findQuadrantColEnd(a);for(a[this.keyChanged]&&this.markThingQuadrantsChanged(a),a[this.keyNumQuads]=0,b=e;g>=b;b+=1)for(c=f;h>=c;c+=1)this.setThingInQuadrant(a,this.quadrantRows[b].quadrants[c],d);a[this.keyChanged]=!1},a.prototype.setThingInQuadrant=function(a,b,c){a[this.keyQuadrants][a[this.keyNumQuads]]=b,a[this.keyNumQuads]+=1,b.things[c][b.numthings[c]]=a,b.numthings[c]+=1,a[this.keyChanged]&&(b.changed=!0)},a.prototype.adjustOffsets=function(){for(;-this.offsetX>this.quadrantWidth;)this.shiftQuadrantCol(!0),this.pushQuadrantCol(!0),this.offsetX+=this.quadrantWidth;for(;this.offsetX>this.quadrantWidth;)this.popQuadrantCol(!0),this.unshiftQuadrantCol(!0),this.offsetX-=this.quadrantWidth;for(;-this.offsetY>this.quadrantHeight;)this.unshiftQuadrantRow(!0),this.pushQuadrantRow(!0),this.offsetY+=this.quadrantHeight;for(;this.offsetY>this.quadrantHeight;)this.popQuadrantRow(!0),this.unshiftQuadrantRow(!0),this.offsetY-=this.quadrantHeight},a.prototype.shiftQuadrant=function(a,b,c){a.top+=c,a.right+=b,a.bottom+=c,a.left+=b,a.changed=!0},a.prototype.createQuadrant=function(a,b){var c,d=this.ObjectMaker.make("Quadrant");for(d.changed=!0,d.things={},d.numthings={},c=0;c<this.groupNames.length;c+=1)d.things[this.groupNames[c]]=[],d.numthings[this.groupNames[c]]=0;return d.left=a,d.top=b,d.right=a+this.quadrantWidth,d.bottom=b+this.quadrantHeight,d.canvas=this.createCanvas(this.quadrantWidth,this.quadrantHeight),d.context=d.canvas.getContext("2d"),d},a.prototype.createQuadrantRow=function(a,b){void 0===a&&(a=0),void 0===b&&(b=0);var c,d={left:a,top:b,quadrants:[]};for(c=0;c<this.numCols;c+=1)d.quadrants.push(this.createQuadrant(a,b)),a+=this.quadrantWidth;return d},a.prototype.createQuadrantCol=function(a,b){var c,d={left:a,top:b,quadrants:[]};for(c=0;c<this.numRows;c+=1)d.quadrants.push(this.createQuadrant(a,b)),b+=this.quadrantHeight;return d},a.prototype.getTop=function(a){return this.keyOffsetY?a[this.keyTop]-Math.abs(a[this.keyOffsetY]):a[this.keyTop]},a.prototype.getRight=function(a){return this.keyOffsetX?a[this.keyRight]+Math.abs(a[this.keyOffsetX]):a[this.keyRight]},a.prototype.getBottom=function(a){return this.keyOffsetX?a[this.keyBottom]+Math.abs(a[this.keyOffsetY]):a[this.keyBottom]},a.prototype.getLeft=function(a){return this.keyOffsetX?a[this.keyLeft]-Math.abs(a[this.keyOffsetX]):a[this.keyLeft]},a.prototype.markThingQuadrantsChanged=function(a){for(var b=0;b<a[this.keyNumQuads];b+=1)a[this.keyQuadrants][b].changed=!0},a.prototype.findQuadrantRowStart=function(a){return Math.max(Math.floor((this.getTop(a)-this.top)/this.quadrantHeight),0)},a.prototype.findQuadrantRowEnd=function(a){return Math.min(Math.floor((this.getBottom(a)-this.top)/this.quadrantHeight),this.numRows-1)},a.prototype.findQuadrantColStart=function(a){return Math.max(Math.floor((this.getLeft(a)-this.left)/this.quadrantWidth),0)},a.prototype.findQuadrantColEnd=function(a){return Math.min(Math.floor((this.getRight(a)-this.left)/this.quadrantWidth),this.numCols-1)},a.prototype.createCanvas=function(a,b){var c=document.createElement("canvas");return c.width=a,c.height=b,c},a}();a.QuadsKeepr=b}(QuadsKeepr||(QuadsKeepr={}));var PixelDrawr;!function(a){"use strict";var b=function(){function a(a){this.PixelRender=a.PixelRender,this.MapScreener=a.MapScreener,this.createCanvas=a.createCanvas,this.unitsize=a.unitsize||1,this.noRefill=a.noRefill,this.spriteCacheCutoff=a.spriteCacheCutoff||0,this.groupNames=a.groupNames,this.framerateSkip=a.framerateSkip||1,this.framesDrawn=0,this.epsilon=a.epsilon||.007,this.keyWidth=a.keyWidth||"width",this.keyHeight=a.keyHeight||"height",this.keyTop=a.keyTop||"top",this.keyRight=a.keyRight||"right",this.keyBottom=a.keyBottom||"bottom",this.keyLeft=a.keyLeft||"left",this.keyOffsetX=a.keyOffsetX,this.keyOffsetY=a.keyOffsetY,this.generateObjectKey=a.generateObjectKey||function(a){return a.toString()},this.resetBackground()}return a.prototype.getFramerateSkip=function(){return this.framerateSkip},a.prototype.getThingArray=function(){return this.thingArrays},a.prototype.getCanvas=function(){return this.canvas},a.prototype.getContext=function(){return this.context},a.prototype.getBackgroundCanvas=function(){return this.backgroundCanvas},a.prototype.getBackgroundContext=function(){return this.backgroundContext},a.prototype.getNoRefill=function(){return this.noRefill},a.prototype.getEpsilon=function(){return this.epsilon},a.prototype.setFramerateSkip=function(a){this.framerateSkip=a},a.prototype.setThingArrays=function(a){this.thingArrays=a},a.prototype.setCanvas=function(a){this.canvas=a,this.context=a.getContext("2d")},a.prototype.setNoRefill=function(a){this.noRefill=a},a.prototype.setEpsilon=function(a){this.epsilon=a},a.prototype.resetBackground=function(){this.backgroundCanvas=this.createCanvas(this.MapScreener[this.keyWidth],this.MapScreener[this.keyHeight]),this.backgroundContext=this.backgroundCanvas.getContext("2d")},a.prototype.setBackground=function(a){this.backgroundContext.fillStyle=a,this.backgroundContext.fillRect(0,0,this.MapScreener[this.keyWidth],this.MapScreener[this.keyHeight])},a.prototype.drawBackground=function(){this.context.drawImage(this.backgroundCanvas,0,0)},a.prototype.setThingSprite=function(a){a.hidden||(a.sprite=this.PixelRender.decode(this.generateObjectKey(a),a),a.sprite.multiple?(a.numSprites=0,this.refillThingCanvasMultiple(a)):(a.numSprites=1,this.refillThingCanvasSingle(a)))},a.prototype.refillThingCanvasSingle=function(a){if(!(a[this.keyWidth]<1||a[this.keyHeight]<1)){var b=a.canvas,c=a.context,d=c.getImageData(0,0,b[this.keyWidth],b[this.keyHeight]);this.PixelRender.memcpyU8(a.sprite,d.data),c.putImageData(d,0,0)}},a.prototype.refillThingCanvasMultiple=function(a){if(!(a[this.keyWidth]<1||a[this.keyHeight]<1)){var b,c,d,e,f=a.sprite,g=a.canvases={direction:f.direction,multiple:!0};a.numSprites=1;for(e in f.sprites)f.sprites.hasOwnProperty(e)&&(b=this.createCanvas(a.spritewidth*this.unitsize,a.spriteheight*this.unitsize),c=b.getContext("2d"),d=c.getImageData(0,0,b[this.keyWidth],b[this.keyHeight]),this.PixelRender.memcpyU8(f.sprites[e],d.data),c.putImageData(d,0,0),g[e]={canvas:b,context:c},a.numSprites+=1);a[this.keyWidth]*a[this.keyHeight]<this.spriteCacheCutoff?(a.canvas[this.keyWidth]=a[this.keyWidth]*this.unitsize,a.canvas[this.keyHeight]=a[this.keyHeight]*this.unitsize,this.drawThingOnContextMultiple(a.context,a.canvases,a,0,0)):a.canvas[this.keyWidth]=a.canvas[this.keyHeight]=0}},a.prototype.refillGlobalCanvas=function(){if(this.framesDrawn+=1,this.framesDrawn%this.framerateSkip===0){this.noRefill||this.drawBackground();for(var a=0;a<this.thingArrays.length;a+=1)this.refillThingArray(this.thingArrays[a])}},a.prototype.refillThingArray=function(a){for(var b=0;b<a.length;b+=1)this.drawThingOnContext(this.context,a[b])},a.prototype.refillQuadrantGroups=function(a){var b;if(this.framesDrawn+=1,this.framesDrawn%this.framerateSkip===0)for(b=0;b<a.length;b+=1)this.refillQuadrants(a[b].quadrants)},a.prototype.refillQuadrants=function(a){var b,c;for(c=0;c<a.length;c+=1)b=a[c],b.changed&&b[this.keyTop]<this.MapScreener[this.keyHeight]&&b[this.keyRight]>0&&b[this.keyBottom]>0&&b[this.keyLeft]<this.MapScreener[this.keyWidth]&&(this.refillQuadrant(b),this.context.drawImage(b.canvas,b[this.keyLeft],b[this.keyTop]))},a.prototype.refillQuadrant=function(a){var b,c,d;for(this.noRefill||a.context.drawImage(this.backgroundCanvas,a[this.keyLeft],a[this.keyTop],a.canvas[this.keyWidth],a.canvas[this.keyHeight],0,0,a.canvas[this.keyWidth],a.canvas[this.keyHeight]),c=this.groupNames.length-1;c>=0;c-=1)for(b=a.things[this.groupNames[c]],d=0;d<b.length;d+=1)this.drawThingOnQuadrant(b[d],a);a.changed=!1},a.prototype.drawThingOnContext=function(a,b){b.hidden||b.opacity<this.epsilon||b[this.keyHeight]<1||b[this.keyWidth]<1||this.getTop(b)>this.MapScreener[this.keyHeight]||this.getRight(b)<0||this.getBottom(b)<0||this.getLeft(b)>this.MapScreener[this.keyWidth]||("undefined"==typeof b.numSprites&&this.setThingSprite(b),b.canvas[this.keyWidth]>0?this.drawThingOnContextSingle(a,b.canvas,b,this.getLeft(b),this.getTop(b)):this.drawThingOnContextMultiple(a,b.canvases,b,this.getLeft(b),this.getTop(b)))},a.prototype.drawThingOnQuadrant=function(a,b){return a.hidden||this.getTop(a)>b[this.keyBottom]||this.getRight(a)<b[this.keyLeft]||this.getBottom(a)<b[this.keyTop]||this.getLeft(a)>b[this.keyRight]||a.opacity<this.epsilon?void 0:1===a.numSprites?this.drawThingOnContextSingle(b.context,a.canvas,a,this.getLeft(a)-b[this.keyLeft],this.getTop(a)-b[this.keyTop]):this.drawThingOnContextMultiple(b.context,a.canvases,a,this.getLeft(a)-b[this.keyLeft],this.getTop(a)-b[this.keyTop])},a.prototype.drawThingOnContextSingle=function(a,b,c,d,e){c.repeat?this.drawPatternOnContext(a,b,d,e,c.unitwidth,c.unitheight,c.opacity||1):1!==c.opacity?(a.globalAlpha=c.opacity,a.drawImage(b,d,e,b.width*c.scale,b.height*c.scale),a.globalAlpha=1):a.drawImage(b,d,e,b.width*c.scale,b.height*c.scale)},a.prototype.drawThingOnContextMultiple=function(a,b,c,d,e){var f,g,h,i=c.sprite,j=e,k=d,l=d+c.unitwidth,m=e+c.unitheight,n=c.unitwidth,o=c.unitheight,p=c.spritewidthpixels,q=c.spriteheightpixels,r=Math.min(n,p),s=Math.min(o,q),t=c.opacity;switch(b.direction){case"vertical":(h=b[this.keyBottom])&&(g=i.bottomheight?i.bottomheight*this.unitsize:q,this.drawPatternOnContext(a,h.canvas,k,m-g,n,s,t),m-=g,o-=g),(h=b[this.keyTop])&&(g=i.topheight?i.topheight*this.unitsize:q,this.drawPatternOnContext(a,h.canvas,k,j,n,s,t),j+=g,o-=g);break;case"horizontal":(h=b[this.keyLeft])&&(f=i.leftwidth?i.leftwidth*this.unitsize:p,this.drawPatternOnContext(a,h.canvas,k,j,r,o,t),k+=f,n-=f),(h=b[this.keyRight])&&(f=i.rightwidth?i.rightwidth*this.unitsize:p,this.drawPatternOnContext(a,h.canvas,l-f,j,r,o,t),l-=f,n-=f);break;case"corners":g=i.topheight?i.topheight*this.unitsize:q,f=i.leftwidth?i.leftwidth*this.unitsize:p,this.drawPatternOnContext(a,b.topLeft.canvas,k,j,r,s,t),this.drawPatternOnContext(a,b[this.keyLeft].canvas,k,j+g,r,o-2*g,t),this.drawPatternOnContext(a,b.bottomLeft.canvas,k,m-g,r,s,t),k+=f,n-=f,f=i.rightwidth?i.rightwidth*this.unitsize:p,this.drawPatternOnContext(a,b[this.keyTop].canvas,k,j,n-f,s,t),this.drawPatternOnContext(a,b.topRight.canvas,l-f,j,r,s,t),j+=g,o-=g,g=i.bottomheight?i.bottomheight*this.unitsize:q,this.drawPatternOnContext(a,b[this.keyRight].canvas,l-f,j,r,o-g,t),this.drawPatternOnContext(a,b.bottomRight.canvas,l-f,m-g,r,s,t),this.drawPatternOnContext(a,b[this.keyBottom].canvas,k,m-g,n-f,s,t),l-=f,n-=f,m-=g,o-=g}(h=b.middle)&&m>j&&l>k&&(i.middleStretch?(a.globalAlpha=t,a.drawImage(h.canvas,k,j,n,o),a.globalAlpha=1):this.drawPatternOnContext(a,h.canvas,k,j,n,o,t))},a.prototype.getTop=function(a){return this.keyOffsetY?a[this.keyTop]+a[this.keyOffsetY]:a[this.keyTop]},a.prototype.getRight=function(a){return this.keyOffsetX?a[this.keyRight]+a[this.keyOffsetX]:a[this.keyRight]},a.prototype.getBottom=function(a){return this.keyOffsetX?a[this.keyBottom]+a[this.keyOffsetY]:a[this.keyBottom]},a.prototype.getLeft=function(a){return this.keyOffsetX?a[this.keyLeft]+a[this.keyOffsetX]:a[this.keyLeft]},a.prototype.drawPatternOnContext=function(a,b,c,d,e,f,g){a.globalAlpha=g,a.translate(c,d),a.fillStyle=a.createPattern(b,"repeat"),a.fillRect(0,0,e,f),a.translate(-c,-d),a.globalAlpha=1},a}();a.PixelDrawr=b}(PixelDrawr||(PixelDrawr={}));var TimeHandlr;!function(a){"use strict";var b=function(){function a(a){this.time=0,this.events={},this.timingDefault=a.timingDefault||1,this.keyCycles=a.keyCycles||"cycles",this.keyClassName=a.keyClassName||"className",this.keyOnClassCycleStart=a.keyOnClassCycleStart||"onClassCycleStart",this.keyDoClassCycleStart=a.keyDoClassCycleStart||"doClassCycleStart",this.keyCycleCheckValidity=a.keyCycleCheckValidity,this.copyCycleSettings="undefined"==typeof a.copyCycleSettings?!0:a.copyCycleSettings,this.classAdd=a.classAdd||this.classAddGeneric,this.classRemove=a.classRemove||this.classRemoveGeneric}return a.prototype.getTime=function(){return this.time},a.prototype.getEvents=function(){return this.events},a.prototype.addEvent=function(a,b){void 0===b&&(b=1);for(var c=[],d=2;d<arguments.length;d++)c[d-2]=arguments[d];var e;if("function"!=typeof a)throw new Error("Invalid event given to addEvent.");return b=b||1,e=this.createEvent(a,this.time+b,b,c,1),this.insertEvent(e,e.timeDelay),e},a.prototype.addEventInterval=function(a,b,c){void 0===b&&(b=1),void 0===c&&(c=1);for(var d=[],e=3;e<arguments.length;e++)d[e-3]=arguments[e];var f,g;if("function"!=typeof a)throw new Error("Invalid event given to addEventInterval.");return b=b||1,c=c||1,g=Array.prototype.slice.call(arguments,3),f=this.createEvent(a,this.time+b,b,g,c),a.event=f,this.insertEvent(f,f.timeDelay),f},a.prototype.addEventIntervalSynched=function(a,b,c,d,e){var f=b*e.length,g=Math.ceil(this.time/f)*f,h=this,i=Array.prototype.slice.call(arguments),j=Function.apply.bind(this.addEventInterval,h,i);return b=b||1,c=c||1,g===this.time?j():void this.addEvent(j,g-this.time,h,i,d)},a.prototype.handleEvents=function(){var a,b,c,d;if(this.time+=1,a=this.events[this.time]){for(d=0,c=a.length;c>d;++d)b=a[d],b.repeat>0&&!b.callback.apply(this,b.args)&&(b.count_changer&&b.count_changer(b),b.repeat.constructor===Function?b.repeat.call(b)&&(b.count+=b.timeRepeat,this.insertEvent(b,b.timeDelay)):(b.repeat=b.repeat-1,b.repeat>0&&(b.timeDelay+=b.timeRepeat,this.insertEvent(b,b.timeDelay))));delete this.events[this.time]}},a.prototype.cancelEvent=function(a){a.repeat=0},a.prototype.cancelAllEvents=function(){this.events={}},a.prototype.cancelClassCycle=function(a,b){var c;a[this.keyCycles]&&a[this.keyCycles][b]&&(c=a[this.keyCycles][b],c.length=1,c[0]=!1,delete a[this.keyCycles][b])},a.prototype.cancelAllCycles=function(a){var b,c,d=a[this.keyCycles];for(c in d)d.hasOwnProperty(c)&&(b=d[c],b.length=1,b[0]=!1,delete d[c])},a.prototype.addClassCycle=function(a,b,c,d){var e,f="function"==typeof d;return a[this.keyCycles]||(a[this.keyCycles]={}),this.cancelClassCycle(a,c),c=c||"0",e=a[this.keyCycles][c]=this.setClassCycle(a,b,f?0:d),e.event&&f&&(e.event.count_changer=d),this.cycleClass(a,b),e},a.prototype.addClassCycleSynched=function(a,b,c,d){var e;return a[this.keyCycles]||(a[this.keyCycles]={}),this.cancelClassCycle(a,c),c=c||"0",e=a[this.keyCycles][c]=this.setClassCycle(a,b,d,!0),this.cycleClass(a,a[this.keyCycles][c]),e},a.prototype.setClassCycle=function(a,b,c,d){void 0===d&&(d=!1);var e,f=this;return this.copyCycleSettings&&(b=this.makeSettingsCopy(b)),b.loc=b.oldclass=-1,e=d?this.addEventIntervalSynched:this.addEventInterval,e=e.bind(f),a[this.keyOnClassCycleStart]=function(){e(f.cycleClass,c||f.timingDefault,1/0,a,b)},a[this.keyDoClassCycleStart]&&a[this.keyOnClassCycleStart](),b},a.prototype.cycleClass=function(a,b){var c,d;return a&&b&&b.length&&(!this.keyCycleCheckValidity||a[this.keyCycleCheckValidity])?(-1!==b.oldclass&&""!==b.oldclass&&this.classRemove(a,b.oldclass),b.loc=(b.loc+=1)%b.length,c=b[b.loc],c?(d=c.constructor===Function?c(a,b):c,"string"==typeof d?(b.oldclass=d,this.classAdd(a,d),!1):d===!1):c===!1):!0},a.prototype.createEvent=function(a,b,c,d,e){return{callback:a,timeDelay:b,timeRepeat:c,args:d,repeat:e,count:0}},a.prototype.insertEvent=function(a,b){return this.events[b]?this.events[b].push(a):this.events[b]=[a],this.events[b]},a.prototype.makeSettingsCopy=function(a){var b,c=new a.constructor;for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c},a.prototype.classAddGeneric=function(a,b){a[this.keyClassName]+=" "+b},a.prototype.classRemoveGeneric=function(a,b){a[this.keyClassName]=a[this.keyClassName].replace(b,"")},a}();a.TimeHandlr=b}(TimeHandlr||(TimeHandlr={}));var LevelEditr;!function(a){"use strict";var b=function(){function a(a){this.GameStarter=a.GameStarter,this.prethings=a.prethings,this.thingGroups=a.thingGroups,this.thingKeys=a.thingKeys,this.macros=a.macros,this.beautifier=a.beautifier,this.mapNameDefault=a.mapNameDefault||"New Map",this.mapTimeDefault=a.mapTimeDefault||1/0,this.mapSettingDefault=a.mapSettingDefault||"",this.mapEntryDefault=a.mapEntryDefault||"",this.mapDefault=a.mapDefault,this.blocksize=a.blocksize||1,this.keyUndefined=a.keyUndefined||"-none-",this.currentPreThings=[],this.currentMode="Build",this.currentClickMode="Thing"}return a.prototype.getGameStarter=function(){return this.GameStarter},a.prototype.getOldInformation=function(){return this.oldInformation},a.prototype.getPreThings=function(){return this.prethings},a.prototype.getThingGroups=function(){return this.thingGroups},a.prototype.getThingKeys=function(){return this.thingKeys},a.prototype.getMacros=function(){return this.macros},a.prototype.getMapNameDefault=function(){return this.mapNameDefault},a.prototype.getMapTimeDefault=function(){return this.mapTimeDefault},a.prototype.getMapEntryDefault=function(){return this.mapEntryDefault},a.prototype.getMapDefault=function(){return this.mapDefault},a.prototype.getDisplay=function(){return this.display},a.prototype.getCurrentMode=function(){return this.currentMode},a.prototype.getBlockSize=function(){return this.blocksize},a.prototype.getBeautifier=function(){return this.beautifier},a.prototype.getCurrentPreThings=function(){return this.currentPreThings},a.prototype.getCurrentTitle=function(){return this.currentTitle},a.prototype.getCurrentArgs=function(){return this.currentArgs},a.prototype.getPageStylesAdded=function(){return this.pageStylesAdded},a.prototype.getKeyUndefined=function(){return this.keyUndefined},a.prototype.enable=function(){this.oldInformation={map:this.GameStarter.MapsHandler.getMapName()},this.clearAllThings(),this.resetDisplay(),this.GameStarter.InputWriter.setCanTrigger(!1),this.setCurrentMode("Build"),this.setTextareaValue(this.stringifySmart(this.mapDefault),!0),this.resetDisplayMap(),this.disableThing(this.GameStarter.player),this.pageStylesAdded||(this.GameStarter.addPageStyles(this.createPageStyles()),this.pageStylesAdded=!0),this.GameStarter.container.insertBefore(this.display.container,this.GameStarter.container.children[0])},a.prototype.disable=function(){this.display&&(this.GameStarter.container.removeChild(this.display.container),this.display=void 0,this.GameStarter.InputWriter.setCanTrigger(!0),this.GameStarter.setMap(this.oldInformation.map))},a.prototype.minimize=function(){this.display.minimizer.innerText="+",this.display.minimizer.onclick=this.maximize.bind(this),this.display.container.className+=" minimized"},a.prototype.maximize=function(){this.display.minimizer.innerText="-",this.display.minimizer.onclick=this.minimize.bind(this),-1!==this.display.container.className.indexOf("minimized")&&(this.display.container.className=this.display.container.className.replace(/ minimized/g,""))},a.prototype.startBuilding=function(){this.beautifyTextareaValue(),this.setDisplayMap(!0),this.GameStarter.InputWriter.setCanTrigger(!1),this.setCurrentMode("Build"),this.maximize()},a.prototype.startPlaying=function(){this.beautifyTextareaValue(),this.setDisplayMap(!1),this.GameStarter.InputWriter.setCanTrigger(!0),this.setCurrentMode("Play"),this.minimize()},a.prototype.downloadCurrentJSON=function(){var a=this.downloadFile(this.getMapName()+".json",this.display.stringer.textarea.value||"");window.open(a.href)},a.prototype.setCurrentJSON=function(a){this.startBuilding(),this.setTextareaValue(a,!0),this.getMapObjectAndTry()},a.prototype.loadCurrentJSON=function(){this.display.inputDummy.click()},a.prototype.handleUploadCompletion=function(a){this.enable(),this.setCurrentJSON(a.currentTarget.result),this.setSectionJSON()},a.prototype.setCurrentMode=function(a){this.currentMode=a},a.prototype.setCurrentClickMode=function(a,b){this.currentClickMode=a,this.cancelEvent(b)},a.prototype.setCurrentThing=function(a,b,c,d){void 0===c&&(c=0),void 0===d&&(d=0),this.currentTitle=a,this.currentArgs=b,this.currentPreThings=[{xloc:0,yloc:0,thing:this.GameStarter.ObjectMaker.make(this.currentTitle,this.GameStarter.proliferate({onThingMake:void 0,onThingAdd:void 0,onThingAdded:void 0,outerok:!0},this.getNormalizedThingArguments(b)))}],this.disableThing(this.currentPreThings[0].thing),this.GameStarter.addThing(this.currentPreThings[0].thing,c,d)},a.prototype.setCurrentMacroThings=function(){var a,b;for(b=0;b<this.currentPreThings.length;b+=1)a=this.currentPreThings[b],a.thing.outerok=!0,this.disableThing(a.thing),this.GameStarter.addThing(a.thing,a.xloc||0,a.yloc||0)},a.prototype.setCurrentArgs=function(){"Thing"===this.currentClickMode?this.setCurrentThing(this.currentTitle,this.generateCurrentArgs()):this.onMacroIconClick(this.currentTitle,void 0,this.generateCurrentArgs())},a.prototype.onMouseDownScroller=function(a,b){var c=b.target,d=this;c.setAttribute("scrolling","1"),this.GameStarter.TimeHandler.addEventInterval(function(){return"1"!==c.getAttribute("scrolling")?!0:0>a&&d.GameStarter.MapScreener.left<=0?void(d.display.scrollers.left.style.opacity="0"):(d.GameStarter.scrollWindow(a),void(d.display.scrollers.left.style.opacity="1"))},1,1/0)},a.prototype.onMouseUpScrolling=function(a){a.target.setAttribute("scrolling","0")},a.prototype.onMouseMoveEditing=function(a){var b,c,d=a.x||a.clientX||0,e=a.y||a.clientY||0;for(c=0;c<this.currentPreThings.length;c+=1)b=this.currentPreThings[c],b.thing&&(this.GameStarter.setLeft(b.thing,this.roundTo(d-this.GameStarter.container.offsetLeft,this.blocksize)+(b.left||0)*this.GameStarter.unitsize),this.GameStarter.setTop(b.thing,this.roundTo(e-this.GameStarter.container.offsetTop,this.blocksize)-(b.top||0)*this.GameStarter.unitsize))},a.prototype.onClickEditingThing=function(a){if("Build"===this.currentMode){var b=this.roundTo(a.x||a.clientX||0,this.blocksize),c=this.roundTo(a.y||a.clientY||0,this.blocksize);this.currentPreThings.length&&this.addMapCreationThing(b,c)&&this.onClickEditingGenericAdd(b,c,this.currentTitle,this.currentArgs)}},a.prototype.onClickEditingMacro=function(a){if("Build"===this.currentMode){var b,c,d=this.roundTo(a.x||a.clientX||0,this.blocksize),e=this.roundTo(a.y||a.clientY||0,this.blocksize);if(this.currentPreThings.length&&this.addMapCreationMacro(d,e))for(c=0;c<this.currentPreThings.length;c+=1)b=this.currentPreThings[c],this.onClickEditingGenericAdd(d+(b.left||0)*this.GameStarter.unitsize,e-(b.top||0)*this.GameStarter.unitsize,b.thing.title||b.title,b.reference)}},a.prototype.onClickEditingGenericAdd=function(a,b,c,d){var e=this.GameStarter.ObjectMaker.make(c,this.GameStarter.proliferate({onThingMake:void 0,onThingAdd:void 0,onThingAdded:void 0,movement:void 0},this.getNormalizedThingArguments(d)));"Build"===this.currentMode&&this.disableThing(e,.7),this.GameStarter.addThing(e,this.roundTo(a-this.GameStarter.container.offsetLeft,this.blocksize),this.roundTo(b-this.GameStarter.container.offsetTop,this.blocksize))},a.prototype.onThingIconClick=function(a,b){var c=b.x||b.clientX||0,d=b.y||b.clientY||0,e="DIV"===b.target.nodeName?b.target:b.target.parentNode,f=this;this.cancelEvent(b),this.killCurrentPreThings(),setTimeout(function(){f.setCurrentThing(a,f.getCurrentArgs(),c,d)}),this.setVisualOptions(e.getAttribute("name"),void 0,e.options)},a.prototype.onMacroIconClick=function(a,b,c){b&&this.setVisualOptions(a,b,c);var d=this.getMapObject();d&&(this.currentPreThings=[],this.GameStarter.MapsCreator.analyzePreMacro(this.GameStarter.proliferate({macro:a},this.generateCurrentArgs()),this.createPrethingsHolder(this.currentPreThings),this.getCurrentAreaObject(d),d),this.currentTitle=a,this.setCurrentMacroThings())},a.prototype.createPrethingsHolder=function(a){var b={};return this.thingGroups.forEach(function(c){b[c]=a}),b},a.prototype.generateCurrentArgs=function(){var a,b,c,d,e,f={},g=this.display.sections.ClickToPlace.VisualOptions,h=g.getElementsByClassName("VisualOptionsList");if(0===h.length)return f;for(h=h[0].childNodes,e=0;e<h.length;e+=1){switch(a=h[e],b=a.querySelector(".VisualOptionLabel"),c=a.querySelector(".VisualOptionValue"),(c.getAttribute("data:type")||c.type).toLowerCase()){case"boolean":d="true"===c.value?!0:!1;break;case"number":d=(Number(c.value)||0)*(Number(c.getAttribute("data:mod"))||1);break;default:d=c.value}d!==this.keyUndefined&&(f[b.textContent]=d)}return f},a.prototype.setMapName=function(){var a=this.getMapName(),b=this.getMapObject();b&&b.name!==a&&(b.name=a,this.display.namer.value=a,this.setTextareaValue(this.stringifySmart(b),!0),this.GameStarter.StatsHolder.setItem("world",a))},a.prototype.setMapTime=function(a){var b,c=this.getMapObject();c&&(a?(b=Number(this.display.sections.MapSettings.Time.value),c.time=b):(b=c.time,this.display.sections.MapSettings.Time.value=b.toString()),this.setTextareaValue(this.stringifySmart(c),!0),this.GameStarter.StatsHolder.setItem("time",b),this.GameStarter.TimeHandler.cancelAllEvents())},a.prototype.setMapSetting=function(a){var b,c,d=this.getMapObject();d&&(b=this.getCurrentAreaObject(d),a?(c=this.display.sections.MapSettings.Setting.Primary.value,this.display.sections.MapSettings.Setting.Secondary.value&&(c+=" "+this.display.sections.MapSettings.Setting.Secondary.value),this.display.sections.MapSettings.Setting.Tertiary.value&&(c+=" "+this.display.sections.MapSettings.Setting.Tertiary.value),b.setting=c):(c=b.setting.split(" "),this.display.sections.MapSettings.Setting.Primary.value=c[0],this.display.sections.MapSettings.Setting.Secondary.value=c[1],this.display.sections.MapSettings.Setting.Tertiary.value=c[2]),this.setTextareaValue(this.stringifySmart(d),!0),this.setDisplayMap(!0))},a.prototype.setLocationArea=function(){var a,b=this.getMapObject();b&&(a=this.getCurrentLocationObject(b),a.area=this.getCurrentArea(),this.setTextareaValue(this.stringifySmart(b),!0),this.setDisplayMap(!0))},a.prototype.setMapEntry=function(a){var b,c,d=this.getMapObject();d&&(b=this.getCurrentLocationObject(d),a?(c=this.display.sections.MapSettings.Entry.value,b.entry=c):(console.warn("Was this code ever reached? area.location?"),this.display.sections.MapSettings.Entry.value=c),this.setTextareaValue(this.stringifySmart(d),!0),this.setDisplayMap(!0))},a.prototype.setCurrentLocation=function(a){var b,c=this.getMapObject();c&&(b=this.getCurrentLocationObject(c),a?this.display.sections.MapSettings.Area.value=b.area?b.area.toString():"0":console.warn("This code is never reached, right?"),this.setTextareaValue(this.stringifySmart(c),!0),this.setDisplayMap(!0))},a.prototype.addLocationToMap=function(){var a=this.display.sections.MapSettings.Location.options.length.toString(),b=this.getMapObject();b&&(b.locations[a]={entry:this.mapEntryDefault},this.resetAllVisualOptionSelects("VisualOptionLocation",Object.keys(b.locations)),this.setTextareaValue(this.stringifySmart(b),!0),this.setDisplayMap(!0))},a.prototype.addAreaToMap=function(){var a=this.display.sections.MapSettings.Area.options.length.toString(),b=this.getMapObject();b&&(b.areas[a]={setting:this.mapSettingDefault,creation:[]},this.resetAllVisualOptionSelects("VisualOptionArea",Object.keys(b.areas)),this.setTextareaValue(this.stringifySmart(b),!0),this.setDisplayMap(!0))},a.prototype.resetAllVisualOptionSelects=function(a,b){var c,d,e,f=this.getMapObject(),g=this.display.container.getElementsByClassName(a),h={children:b.map(function(a){return new Option(a,a)})};if(f)for(e=0;e<g.length;e+=1)c=g[e],d=c.value,c.textContent="",this.GameStarter.proliferateElement(c,h),c.value=d},a.prototype.getMapObject=function(){var a;try{a=this.parseSmart(this.display.stringer.textarea.value),
this.display.stringer.messenger.textContent="",this.display.namer.value=a.name||this.mapNameDefault}catch(b){this.setSectionJSON(),this.display.stringer.messenger.textContent=b.message}return a},a.prototype.getMapObjectAndTry=function(){var a=this.getMapName()+"::Temporary",b=this.getMapObject();if(!b)return!1;try{this.GameStarter.MapsCreator.storeMap(a,b),this.GameStarter.MapsCreator.getMap(a),this.setDisplayMap(!0)}catch(c){return this.display.stringer.messenger.textContent=c.message,!1}},a.prototype.getCurrentArea=function(){return this.display.sections.MapSettings.Area.value},a.prototype.getCurrentAreaObject=function(a){void 0===a&&(a=this.getMapObject());var b=a.locations[this.getCurrentLocation()].area;return a.areas[b?b.toString():"0"]},a.prototype.getCurrentLocation=function(){return this.display.sections.MapSettings.Location.value},a.prototype.getCurrentLocationObject=function(a){return a.locations[this.getCurrentLocation()]},a.prototype.addMapCreationThing=function(a,b){var c=this.getMapObject(),d=this.GameStarter.proliferate({thing:this.currentTitle,x:this.getNormalizedX(a)+this.GameStarter.MapScreener.left/this.GameStarter.unitsize,y:this.getNormalizedY(b)},this.currentArgs);return c?(c.areas[this.getCurrentArea()].creation.push(d),this.setTextareaValue(this.stringifySmart(c),!0),!0):!1},a.prototype.addMapCreationMacro=function(a,b){var c=this.getMapObject(),d=this.GameStarter.proliferate({macro:this.currentTitle,x:this.getNormalizedX(a)+this.GameStarter.MapScreener.left/this.GameStarter.unitsize,y:this.getNormalizedY(b)},this.generateCurrentArgs());return c?(c.areas[this.getCurrentArea()].creation.push(d),this.setTextareaValue(this.stringifySmart(c),!0),!0):!1},a.prototype.resetDisplay=function(){this.display={container:this.GameStarter.createElement("div",{className:"LevelEditor",onclick:this.cancelEvent.bind(this),ondragenter:this.handleDragEnter.bind(this),ondragover:this.handleDragOver.bind(this),ondrop:this.handleDragDrop.bind(this)}),scrollers:{},stringer:{},sections:{ClickToPlace:{},MapSettings:{Setting:{}},buttons:{ClickToPlace:{}}}},this.resetDisplayScrollers(),this.resetDisplayGui(),this.resetDisplayHead(),this.resetDisplaySectionChoosers(),this.resetDisplayOptionsList(),this.resetDisplayMapSettings()},a.prototype.resetDisplayGui=function(){this.display.gui=this.GameStarter.createElement("div",{className:"EditorGui"}),this.display.container.appendChild(this.display.gui)},a.prototype.resetDisplayScrollers=function(){this.display.scrollers={left:this.GameStarter.createElement("div",{className:"EditorScroller EditorScrollerLeft",onmousedown:this.onMouseDownScroller.bind(this,2*-this.GameStarter.unitsize),onmouseup:this.onMouseUpScrolling.bind(this),onmouseout:this.onMouseUpScrolling.bind(this),onclick:this.cancelEvent.bind(this),innerText:"<",style:{paddingTop:this.GameStarter.MapScreener.height/2-35+"px",fontSize:"70px",opacity:0}}),right:this.GameStarter.createElement("div",{className:"EditorScroller EditorScrollerRight",onmousedown:this.onMouseDownScroller.bind(this,2*this.GameStarter.unitsize),onmouseup:this.onMouseUpScrolling.bind(this),onmouseout:this.onMouseUpScrolling.bind(this),onclick:this.cancelEvent.bind(this),innerText:">",style:{paddingTop:this.GameStarter.MapScreener.height/2-35+"px",fontSize:"70px"}}),container:this.GameStarter.createElement("div",{className:"EditorScrollers",onmousemove:this.onMouseMoveEditing.bind(this),onclick:this.onClickEditingThing.bind(this)})},this.display.scrollers.container.appendChild(this.display.scrollers.left),this.display.scrollers.container.appendChild(this.display.scrollers.right),this.display.container.appendChild(this.display.scrollers.container)},a.prototype.resetDisplayHead=function(){this.display.minimizer=this.GameStarter.createElement("div",{className:"EditorHeadButton EditorMinimizer",onclick:this.minimize.bind(this),textContent:"-"}),this.display.head=this.GameStarter.createElement("div",{className:"EditorHead",children:[this.GameStarter.createElement("div",{className:"EditorNameContainer",children:[this.display.namer=this.GameStarter.createElement("input",{className:"EditorNameInput",type:"text",placeholder:this.mapNameDefault,value:this.mapNameDefault,onkeyup:this.setMapName.bind(this),onchange:this.setMapName.bind(this)})]}),this.display.minimizer,this.GameStarter.createElement("div",{className:"EditorHeadButton EditorCloser",textContent:"X",onclick:this.disable.bind(this)})]}),this.display.gui.appendChild(this.display.head)},a.prototype.resetDisplaySectionChoosers=function(){var a=this.GameStarter.createElement("div",{className:"EditorSectionChoosers",onclick:this.cancelEvent.bind(this),children:[this.display.sections.buttons.ClickToPlace.container=this.GameStarter.createElement("div",{className:"EditorMenuOption EditorSectionChooser EditorMenuOptionThird",style:{background:"white"},textContent:"Visual",onclick:this.setSectionClickToPlace.bind(this)}),this.display.sections.buttons.MapSettings=this.GameStarter.createElement("div",{className:"EditorMenuOption EditorSectionChooser EditorMenuOptionThird",style:{background:"gray"},textContent:"Map",onclick:this.setSectionMapSettings.bind(this)}),this.display.sections.buttons.JSON=this.GameStarter.createElement("div",{className:"EditorMenuOption EditorSectionChooser EditorMenuOptionThird",style:{background:"gray"},textContent:"JSON",onclick:this.setSectionJSON.bind(this)})]});this.display.gui.appendChild(a)},a.prototype.resetDisplayOptionsList=function(){this.display.sections.ClickToPlace.container=this.GameStarter.createElement("div",{className:"EditorOptionsList EditorSectionMain",onclick:this.cancelEvent.bind(this),style:{display:"block"}}),this.resetDisplayOptionsListSubOptionsMenu(),this.resetDisplayOptionsListSubOptions(),this.display.gui.appendChild(this.display.sections.ClickToPlace.container)},a.prototype.resetDisplayOptionsListSubOptionsMenu=function(){var a=this.GameStarter.createElement("div",{className:"EditorSubOptionsListsMenu"});this.display.sections.buttons.ClickToPlace.Things=this.GameStarter.createElement("div",{className:"EditorMenuOption EditorSubOptionsListChooser EditorMenuOptionHalf",textContent:"Things",onclick:this.setSectionClickToPlaceThings.bind(this),style:{background:"#CCC"}}),this.display.sections.buttons.ClickToPlace.Macros=this.GameStarter.createElement("div",{className:"EditorMenuOption EditorSubOptionsListChooser EditorMenuOptionHalf",textContent:"Macros",onclick:this.setSectionClickToPlaceMacros.bind(this),style:{background:"#777"}}),a.appendChild(this.display.sections.buttons.ClickToPlace.Things),a.appendChild(this.display.sections.buttons.ClickToPlace.Macros),this.display.sections.ClickToPlace.container.appendChild(a)},a.prototype.resetDisplayMapSettings=function(){this.display.sections.MapSettings.container=this.GameStarter.createElement("div",{className:"EditorMapSettings EditorSectionMain",onclick:this.cancelEvent.bind(this),style:{display:"none"},children:[this.GameStarter.createElement("div",{className:"EditorMenuOption",textContent:"+ Add Area",onclick:this.addAreaToMap.bind(this)}),this.GameStarter.createElement("div",{className:"EditorMenuOption",textContent:"+ Add Location",onclick:this.addLocationToMap.bind(this)})]}),this.resetDisplayMapSettingsCurrent(),this.resetDisplayMapSettingsMap(),this.resetDisplayMapSettingsLocation(),this.resetDisplayJSON(),this.resetDisplayVisualContainers(),this.resetDisplayButtons(),this.display.gui.appendChild(this.display.sections.MapSettings.container)},a.prototype.resetDisplayMapSettingsCurrent=function(){this.display.sections.MapSettings.container.appendChild(this.GameStarter.createElement("div",{className:"EditorMapSettingsSubGroup",children:[this.GameStarter.createElement("label",{textContent:"Current Location"}),this.display.sections.MapSettings.Location=this.createSelect(["0"],{className:"VisualOptionLocation",onchange:this.setCurrentLocation.bind(this,!0)})]}))},a.prototype.resetDisplayMapSettingsMap=function(){this.display.sections.MapSettings.container.appendChild(this.GameStarter.createElement("div",{className:"EditorMapSettingsGroup",children:[this.GameStarter.createElement("h4",{textContent:"Map"}),this.GameStarter.createElement("div",{className:"EditorMapSettingsSubGroup",children:[this.GameStarter.createElement("label",{className:"EditorMapSettingsLabel",textContent:"Time"}),this.display.sections.MapSettings.Time=this.createSelect(["100","200","300","400","500","1000","Infinity"],{value:this.mapTimeDefault.toString(),onchange:this.setMapTime.bind(this,!0)})]})]}))},a.prototype.resetDisplayMapSettingsLocation=function(){this.display.sections.MapSettings.container.appendChild(this.GameStarter.createElement("div",{className:"EditorMapSettingsGroup",children:[this.GameStarter.createElement("h4",{textContent:"Location"}),this.GameStarter.createElement("div",{className:"EditorMapSettingsSubGroup",children:[this.GameStarter.createElement("label",{textContent:"Area"}),this.display.sections.MapSettings.Area=this.createSelect(["0"],{className:"VisualOptionArea",onchange:this.setLocationArea.bind(this,!0)})]}),this.GameStarter.createElement("div",{className:"EditorMapSettingsSubGroup",children:[this.GameStarter.createElement("label",{textContent:"Setting"}),this.display.sections.MapSettings.Setting.Primary=this.createSelect(["Overworld","Underworld","Underwater","Castle"],{onchange:this.setMapSetting.bind(this,!0)}),this.display.sections.MapSettings.Setting.Secondary=this.createSelect(["","Night","Underwater","Alt"],{onchange:this.setMapSetting.bind(this,!0)}),this.display.sections.MapSettings.Setting.Tertiary=this.createSelect(["","Night","Underwater","Alt"],{onchange:this.setMapSetting.bind(this,!0)})]}),this.GameStarter.createElement("div",{className:"EditorMapSettingsSubGroup",children:[this.GameStarter.createElement("label",{textContent:"Entrance"}),this.display.sections.MapSettings.Entry=this.createSelect(["Plain","Normal","Castle","PipeVertical","PipeHorizontal"],{onchange:this.setMapEntry.bind(this,!0)})]})]}))},a.prototype.resetDisplayJSON=function(){this.display.sections.JSON=this.GameStarter.createElement("div",{className:"EditorJSON EditorSectionMain",onclick:this.cancelEvent.bind(this),style:{display:"none"},children:[this.display.stringer.textarea=this.GameStarter.createElement("textarea",{className:"EditorJSONInput",spellcheck:!1,onkeyup:this.getMapObjectAndTry.bind(this),onchange:this.getMapObjectAndTry.bind(this)}),this.display.stringer.messenger=this.GameStarter.createElement("div",{className:"EditorJSONInfo"})]}),this.display.gui.appendChild(this.display.sections.JSON)},a.prototype.resetDisplayVisualContainers=function(){this.display.sections.ClickToPlace.VisualSummary=this.GameStarter.createElement("div",{className:"EditorVisualSummary",onclick:this.cancelEvent.bind(this)}),this.display.sections.ClickToPlace.VisualOptions=this.GameStarter.createElement("div",{className:"EditorVisualOptions",onclick:this.cancelEvent.bind(this),textContent:"Click an icon to view options.",style:{display:"block"}}),this.display.gui.appendChild(this.display.sections.ClickToPlace.VisualSummary),this.display.gui.appendChild(this.display.sections.ClickToPlace.VisualOptions)},a.prototype.resetDisplayButtons=function(){var a=this;this.display.gui.appendChild(this.GameStarter.createElement("div",{className:"EditorMenu",onclick:this.cancelEvent.bind(this),children:function(b){return Object.keys(b).map(function(c){return a.GameStarter.createElement("div",{className:"EditorMenuOption EditorMenuOptionFifth EditorMenuOption-"+c,textContent:c,onclick:b[c][0].bind(a),children:b[c][1]})})}({Build:[this.startBuilding.bind(this)],Play:[this.startPlaying.bind(this)],Save:[this.downloadCurrentJSON.bind(this)],Load:[this.loadCurrentJSON.bind(this),this.display.inputDummy=this.GameStarter.createElement("input",{type:"file",style:{display:"none"},onchange:this.handleUploadStart.bind(this)})],Reset:[this.resetDisplayMap.bind(this)]})}))},a.prototype.resetDisplayOptionsListSubOptions=function(){this.resetDisplayOptionsListSubOptionsThings(),this.resetDisplayOptionsListSubOptionsMacros()},a.prototype.resetDisplayOptionsListSubOptionsThings=function(){var a=this,b=this.onThingIconClick;this.display.sections.ClickToPlace.Things=this.GameStarter.createElement("div",{className:"EditorSectionSecondary EditorOptions EditorOptions-Things",style:{display:"block"},children:function(){var c=0,d=Object.keys(a.prethings).map(function(c){var d=Object.keys(a.prethings[c]).map(function(d){var e=a.GameStarter.ObjectMaker.make(d),f=a.GameStarter.createElement("div",{className:"EditorListOption",name:d,options:a.prethings[c][d],children:[e.canvas],onclick:b.bind(a,d)}),g=70,h=e.width*a.GameStarter.unitsize,i=e.height*a.GameStarter.unitsize,j=(g-h)/2,k=(g-i)/2;return e.canvas.style.top=k+"px",e.canvas.style.right=j+"px",e.canvas.style.bottom=k+"px",e.canvas.style.left=j+"px",a.GameStarter.PixelDrawer.setThingSprite(e),f});return a.GameStarter.createElement("div",{className:"EditorOptionContainer",style:{display:"none"},children:d})}),e=a.createSelect(Object.keys(a.prethings),{className:"EditorOptionContainerSwitchers",onchange:function(){d[c+1].style.display="none",d[e.selectedIndex+1].style.display="block",c=e.selectedIndex}});return d[0].style.display="block",d.unshift(e),d}()}),this.display.sections.ClickToPlace.container.appendChild(this.display.sections.ClickToPlace.Things)},a.prototype.resetDisplayOptionsListSubOptionsMacros=function(){var a=this;a.display.sections.ClickToPlace.Macros=a.GameStarter.createElement("div",{className:"EditorSectionSecondary EditorOptions EditorOptions-Macros",style:{display:"none"},children:Object.keys(a.macros).map(function(b){var c=a.macros[b];return a.GameStarter.createElement("div",{className:"EditorOptionContainer",children:[a.GameStarter.createElement("div",{className:"EditorOptionTitle EditorMenuOption",textContent:b,onclick:a.onMacroIconClick.bind(a,b,c.description,c.options)})]})})}),this.display.sections.ClickToPlace.container.appendChild(this.display.sections.ClickToPlace.Macros)},a.prototype.setSectionClickToPlace=function(){this.display.sections.ClickToPlace.VisualOptions.style.display="block",this.display.sections.ClickToPlace.container.style.display="block",this.display.sections.MapSettings.container.style.display="none",this.display.sections.JSON.style.display="none",this.display.sections.buttons.ClickToPlace.container.style.backgroundColor="white",this.display.sections.buttons.MapSettings.style.background="gray",this.display.sections.buttons.JSON.style.background="gray"},a.prototype.setSectionMapSettings=function(){this.display.sections.ClickToPlace.VisualOptions.style.display="none",this.display.sections.ClickToPlace.container.style.display="none",this.display.sections.MapSettings.container.style.display="block",this.display.sections.JSON.style.display="none",this.display.sections.buttons.ClickToPlace.container.style.background="gray",this.display.sections.buttons.MapSettings.style.background="white",this.display.sections.buttons.JSON.style.background="gray"},a.prototype.setSectionJSON=function(){this.display.sections.ClickToPlace.VisualOptions.style.display="none",this.display.sections.ClickToPlace.container.style.display="none",this.display.sections.MapSettings.container.style.display="none",this.display.sections.JSON.style.display="block",this.display.sections.buttons.ClickToPlace.container.style.background="gray",this.display.sections.buttons.MapSettings.style.background="gray",this.display.sections.buttons.JSON.style.background="white"},a.prototype.setSectionClickToPlaceThings=function(a){this.setCurrentClickMode("Thing",a),this.display.container.onclick=this.onClickEditingThing.bind(this),this.display.scrollers.container.onclick=this.onClickEditingThing.bind(this),this.display.sections.ClickToPlace.VisualOptions.style.display="block",this.display.sections.ClickToPlace.Things.style.display="block",this.display.sections.ClickToPlace.Macros.style.display="none",this.display.sections.buttons.ClickToPlace.Things.style.background="#CCC",this.display.sections.buttons.ClickToPlace.Macros.style.background="#777"},a.prototype.setSectionClickToPlaceMacros=function(a){this.setCurrentClickMode("Macro",a),this.display.container.onclick=this.onClickEditingMacro.bind(this),this.display.scrollers.container.onclick=this.onClickEditingMacro.bind(this),this.display.sections.ClickToPlace.VisualOptions.style.display="block",this.display.sections.ClickToPlace.Things.style.display="none",this.display.sections.ClickToPlace.Macros.style.display="block",this.display.sections.buttons.ClickToPlace.Things.style.background="#777",this.display.sections.buttons.ClickToPlace.Macros.style.background="#CCC"},a.prototype.setTextareaValue=function(a,b){void 0===b&&(b=!1),this.display.stringer.textarea.value=b?this.beautifier(a):a},a.prototype.beautifyTextareaValue=function(){this.display.stringer.textarea.value=this.beautifier(this.display.stringer.textarea.value)},a.prototype.setVisualOptions=function(a,b,c){var d=this.display.sections.ClickToPlace.VisualOptions,e=this.createVisualOption.bind(this),f=this;d.textContent="",d.appendChild(this.GameStarter.createElement("h3",{className:"VisualOptionName",textContent:a})),b&&d.appendChild(this.GameStarter.createElement("div",{className:"VisualOptionDescription",textContent:b})),c&&d.appendChild(f.GameStarter.createElement("div",{className:"VisualOptionsList",children:Object.keys(c).map(function(a){return f.GameStarter.createElement("div",{className:"VisualOption",children:[f.GameStarter.createElement("div",{className:"VisualOptionLabel",textContent:a}),e(c[a])]})})})),this.display.sections.ClickToPlace.VisualSummary.textContent=a},a.prototype.createVisualOption=function(a){var b=this.createVisualOptionObject(a);switch(b.type){case"Boolean":return this.createVisualOptionBoolean();case"Number":return this.createVisualOptionNumber(b);case"Select":return this.createVisualOptionSelect(b);case"String":return this.createVisualOptionString(b);case"Location":return this.createVisualOptionLocation(b);case"Area":return this.createVisualOptionArea(b);case"Everything":return this.createVisualOptionEverything(b);default:return this.createVisualOptionDefault(b)}},a.prototype.createVisualOptionObject=function(a){var b;switch(a.constructor){case Number:b={type:"Number",mod:a};break;case String:b={type:a};break;case Array:b={type:"Select",options:a};break;default:b=a}return b},a.prototype.createVisualOptionBoolean=function(){return this.createSelect(["false","true"],{className:"VisualOptionValue","data:type":"Boolean",onchange:this.setCurrentArgs.bind(this)})},a.prototype.createVisualOptionNumber=function(a){var b=this;return this.GameStarter.createElement("div",{className:"VisualOptionHolder",children:function(){var c=a.mod||1,d=b.GameStarter.createElement("input",{type:"Number","data:type":"Number",value:void 0===a.value?1:a.value},{className:"VisualOptionValue modReal"+c,onchange:b.setCurrentArgs.bind(b)}),e=[d];if(d.setAttribute("data:mod",c.toString()),a.Infinite){var f=void 0,g=b.createSelect(["Number","Infinite"],{className:"VisualOptionInfiniter",onchange:function(){"Number"===g.value?(d.type="Number",d.disabled=!1,d.value=f,d.onchange(void 0)):(d.type="Text",d.disabled=!0,f=d.value,d.value="Infinity",d.onchange(void 0))}});a.value===1/0&&(g.value="Infinite",g.onchange(void 0)),e.push(g)}return c>1&&e.push(b.GameStarter.createElement("div",{className:"VisualOptionRecommendation",textContent:"x"+a.mod})),e}()})},a.prototype.createVisualOptionSelect=function(a){return this.createSelect(a.options,{className:"VisualOptionValue","data:type":"Boolean",onchange:this.setCurrentArgs.bind(this)})},a.prototype.createVisualOptionString=function(a){return this.createSelect(a.options,{className:"VisualOptionValue","data:type":"String",onchange:this.setCurrentArgs.bind(this)})},a.prototype.createVisualOptionLocation=function(){var a,b=this.getMapObject();return b?(a=Object.keys(b.locations),a.unshift(this.keyUndefined),this.createSelect(a,{className:"VisualOptionValue VisualOptionLocation","data-type":"Number"})):this.GameStarter.createElement("div",{className:"VisualOptionValue VisualOptionLocation EditorComplaint",text:"Fix map compilation to get locations!"})},a.prototype.createVisualOptionArea=function(){var a,b=this.getMapObject();return b?(a=Object.keys(b.areas),a.unshift(this.keyUndefined),this.createSelect(a,{className:"VisualOptionValue VisualOptionArea","data-type":"Number",onchange:this.setCurrentArgs.bind(this)})):this.GameStarter.createElement("div",{className:"VisualOptionValue VisualOptionArea EditorComplaint",text:"Fix map compilation to get areas!"})},a.prototype.createVisualOptionEverything=function(){return this.createSelect(this.thingKeys,{className:"VisualOptionValue VisualOptionEverything","data-type":"String",onchange:this.setCurrentArgs.bind(this)})},a.prototype.createVisualOptionDefault=function(a){return this.GameStarter.createElement("div",{className:"EditorComplaint",textContent:"Unknown type requested: "+a.type})},a.prototype.resetDisplayMap=function(){this.setTextareaValue(this.stringifySmart(this.mapDefault),!0),this.setDisplayMap(!0),this.GameStarter.InputWriter.setCanTrigger(!1)},a.prototype.setDisplayMap=function(a){void 0===a&&(a=!1);var b,c,d=this.display.stringer.textarea.value,e=this.getMapName();try{b=this.parseSmart(d),this.setTextareaValue(this.display.stringer.textarea.value)}catch(f){return this.setSectionJSON(),void(this.display.stringer.messenger.textContent=f.message)}try{this.GameStarter.MapsCreator.storeMap(e,b),c=this.GameStarter.MapsCreator.getMap(e)}catch(f){return this.setSectionJSON(),void(this.display.stringer.messenger.textContent=f.message)}this.display.stringer.messenger.textContent="",this.setTextareaValue(this.display.stringer.textarea.value),this.GameStarter.setMap(e,this.getCurrentLocation()),a&&this.disableAllThings()},a.prototype.getMapName=function(){return this.display.namer.value||this.mapNameDefault},a.prototype.roundTo=function(a,b){return Math.round(a/b)*b},a.prototype.stringifySmart=function(a){return void 0===a&&(a={}),JSON.stringify(a,this.jsonReplacerSmart)},a.prototype.parseSmart=function(a){return JSON.parse(a,this.jsonReplacerSmart)},a.prototype.jsonReplacerSmart=function(a,b){return b!==b?"NaN":b===1/0?"Infinity":b===-(1/0)?"-Infinity":b},a.prototype.disableThing=function(a,b){void 0===b&&(b=.49),a.movement=void 0,a.onThingMake=void 0,a.onThingAdd=void 0,a.onThingAdded=void 0,a.nofall=!0,a.nocollide=!0,a.xvel=0,a.yvel=0,a.opacity=typeof b},a.prototype.disableAllThings=function(){var a,b=this,c=this.GameStarter.GroupHolder.getGroups();for(a in c)c.hasOwnProperty(a)&&c[a].forEach(function(a){b.disableThing(a)});this.GameStarter.StatsHolder.setItem("time",1/0)},a.prototype.clearAllThings=function(){var a,b=this,c=this.GameStarter.GroupHolder.getGroups();for(a in c)c.hasOwnProperty(a)&&c[a].forEach(function(a){b.GameStarter.killNormal(a)})},a.prototype.getNormalizedX=function(a){return a/this.GameStarter.unitsize},a.prototype.getNormalizedY=function(a){return this.GameStarter.MapScreener.floor-a/this.GameStarter.unitsize+3*this.GameStarter.unitsize},a.prototype.getNormalizedThingArguments=function(a){var b=this.GameStarter.proliferate({},a);return b.height===1/0&&(b.height=this.GameStarter.MapScreener.height),b.width===1/0&&(b.width=this.GameStarter.MapScreener.width),b},a.prototype.createSelect=function(a,b){var c,d=this.GameStarter.createElement("select",b);for(c=0;c<a.length;c+=1)d.appendChild(this.GameStarter.createElement("option",{value:a[c],textContent:a[c]}));return"undefined"!=typeof b.value&&(d.value=b.value),d},a.prototype.downloadFile=function(a,b){var c=this.GameStarter.createElement("a",{download:a,href:"data:text/json;charset=utf-8,"+encodeURIComponent(b)});return this.display.container.appendChild(c),c.click(),this.display.container.removeChild(c),c},a.prototype.killCurrentPreThings=function(){for(var a=0;a<this.currentPreThings.length-1;a+=1)this.GameStarter.killNormal(this.currentPreThings[a].thing)},a.prototype.handleUploadStart=function(a){var b,c;this.cancelEvent(a),a&&a.dataTransfer?b=a.dataTransfer.files[0]:(b=this.display.inputDummy.files[0],c=new FileReader),b&&(c=new FileReader,c.onloadend=this.handleUploadCompletion.bind(this),c.readAsText(b))},a.prototype.handleDragEnter=function(){this.setSectionJSON()},a.prototype.handleDragOver=function(a){this.cancelEvent(a)},a.prototype.handleDragDrop=function(a){this.handleUploadStart(a)},a.prototype.cancelEvent=function(a){a&&("function"==typeof a.preventDefault&&a.preventDefault(),"function"==typeof a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},a.prototype.createPageStyles=function(){return{".LevelEditor":{position:"absolute",top:"0",right:"0",bottom:"0",left:"0"},".LevelEditor h4":{margin:"14px 0 7px 0"},".LevelEditor select, .LevelEditor input":{margin:"7px",padding:"3px 7px","font-size":"1.17em"},".LevelEditor .EditorGui":{position:"absolute",top:"0",right:"0",bottom:"0",width:"50%",background:"rgba(0, 7, 14, .84)",overflow:"hidden","user-select":"none","box-sizing":"border-box","z-index":"70",transition:"117ms all"},".LevelEditor .EditorMenuContainer":{position:"absolute",top:"0",right:"0",bottom:"0",width:"50%",background:"rgba(0, 7, 14, .84)",overflow:"hidden","user-select":"none","box-sizing":"border-box","z-index":"70",transition:"117ms all"},".LevelEditor .EditorScrollers":{position:"absolute",top:"0",right:"50%",bottom:"0",left:"0",transition:"117ms all"},".EditorScroller":{position:"absolute",width:"70px",height:"101%",cursor:"pointer","box-sizing":"border-box","text-align":"center",transition:"280ms opacity"},".EditorScrollerRight":{right:"0"},".EditorScrollerLeft":{left:"0"},".LevelEditor.minimized .EditorGui":{width:"117px"},".LevelEditor.minimized .EditorMenuContainer":{width:"117px"},".LevelEditor.minimized .EditorScrollers":{right:"117px","padding-right":"117px"},".LevelEditor .EditorHead":{position:"relative",height:"35px"},".LevelEditor .EditorHead .EditorNameContainer":{position:"absolute",top:"1px",right:"73px",left:"2px",height:"35px"},".LevelEditor .EditorHead .EditorNameInput":{display:"block",margin:"0",padding:"3px 7px",width:"100%",background:"white",border:"1px solid black","font-size":"1.4em","box-sizing":"border-box"},".LevelEditor .EditorHead .EditorHeadButton":{position:"absolute",top:"2px",width:"32px",height:"32px",background:"rgb(35,35,35)",border:"1px solid silver","box-sizing":"border-box","text-align":"center","padding-top":"7px",cursor:"pointer"},".LevelEditor .EditorHead .EditorMinimizer":{right:"38px"},".LevelEditor .EditorHead .EditorCloser":{right:"3px"},".LevelEditor .EditorSectionChooser":{width:"50%","box-sizing":"border-box",height:"35px",background:"white",border:"3px solid black",color:"black",cursor:"pointer"},".LevelEditor .EditorSectionChooser.Inactive":{background:"gray"},".LevelEditor.minimized .EditorSectionChoosers":{opacity:"0"},".LevelEditor .EditorSectionMain":{position:"absolute",top:"70px",right:"0",bottom:"49px",left:"0","overflow-y":"auto"},".LevelEditor .EditorSectionSecondary":{position:"absolute",top:"35px",right:"248px",bottom:"0px",left:"0","overflow-y":"auto"},".LevelEditor .EditorJSON":{"font-family":"Courier"},".LevelEditor .EditorJSONInput":{display:"block",width:"100%",height:"84%",background:"rgba(0, 3, 7, .91)",color:"rgba(255, 245, 245, .91)","box-sizing":"border-box","overflow-y":"auto",resize:"none"},".LevelEditor .EditorJSONInfo":{height:"1.75em",padding:"3px 7px"},".LevelEditor.minimized .EditorJSON":{opacity:"0"},".LevelEditor .EditorOptions, .LevelEditor .EditorOptionContainer":{"padding-left":"3px",clear:"both","min-width":"98px"},".LevelEditor.minimized .EditorOptionsList":{opacity:"0"},".LevelEditor .EditorListOption":{position:"relative","float":"left",margin:"0 7px 7px 0",width:"70px",height:"70px",background:"black",border:"white",overflow:"hidden",cursor:"pointer"},".LevelEditor .EditorListOption canvas":{position:"absolute"},".LevelEditor .EditorVisualSummary":{margin:"42px 7px",opacity:"0",transition:"117ms opacity"},".LevelEditor.minimized .EditorVisualSummary":{opacity:"0"},".LevelEditor .EditorVisualOptions":{position:"absolute",right:"21px",top:"119px",bottom:"42px",padding:"7px 11px",width:"210px",border:"1px solid silver","border-width":"1px 0 0 1px","overflow-x":"visible","overflow-y":"auto",opacity:"1","box-sizing":"border-box",transition:"117ms opacity"},".LevelEditor.minimized .EditorVisualOptions":{left:"100%"},".LevelEditor .EditorVisualOptions .VisualOption":{padding:"14px 0"},".LevelEditor .EditorVisualOptions .VisualOptionName":{margin:"3px 0 7px 0"},".LevelEditor .EditorVisualOptions .VisualOptionDescription":{"padding-bottom":"14px"},".LevelEditor .EditorVisualOptions .VisualOptionValue":{"max-width":"117px"},".LevelEditor .EditorVisualOptions .VisualOptionInfiniter, .LevelEditor .EditorVisualOptions .VisualOptionRecommendation":{display:"inline"},".LevelEditor .EditorMenu":{position:"absolute",right:"0",bottom:"0",left:"0"},".LevelEditor .EditorMenuOption":{display:"inline-block",padding:"7px 14px",background:"white",border:"3px solid black","box-sizing":"border-box",color:"black","text-align":"center",overflow:"hidden",cursor:"pointer"},".LevelEditor.minimized .EditorMenuOption:not(:first-of-type)":{display:"none"},".LevelEditor.minimized .EditorMenuOption:first-of-type":{width:"auto"},".LevelEditor .EditorMenuOption:hover":{opacity:".91"},".LevelEditor .EditorMenuOption.EditorMenuOptionHalf":{width:"50%"},".LevelEditor .EditorMenuOption.EditorMenuOptionThird":{width:"33%"},".LevelEditor .EditorMenuOption.EditorMenuOptionFifth":{width:"20%"},".LevelEditor .EditorMapSettingsGroup":{"padding-left":"7px"},".LevelEditor .EditorMapSettingsSubGroup":{"padding-left":"14px"},".LevelEditor.minimized .EditorMapSettings":{opacity:"0"}}},a}();a.LevelEditr=b}(LevelEditr||(LevelEditr={}));var ModAttachr;!function(a){"use strict";var b=function(){function a(a){this.mods={},this.events={},a&&(this.scopeDefault=a.scopeDefault,a.StatsHoldr?this.StatsHolder=a.StatsHoldr:a.storeLocally&&(this.StatsHolder=new StatsHoldr.StatsHoldr),a.mods&&this.addMods(a.mods))}return a.prototype.getMods=function(){return this.mods},a.prototype.getMod=function(a){return this.mods[a]},a.prototype.getEvents=function(){return this.events},a.prototype.getEvent=function(a){return this.events[a]},a.prototype.getStatsHolder=function(){return this.StatsHolder},a.prototype.addMod=function(a){var b,c=a.events;for(b in c)c.hasOwnProperty(b)&&(this.events.hasOwnProperty(b)?this.events[b].push(a):this.events[b]=[a]);a.scope=a.scope||this.scopeDefault,this.mods[a.name]=a,a.enabled&&a.events.hasOwnProperty("onModEnable")&&this.fireModEvent("onModEnable",a.name,arguments),this.StatsHolder&&(this.StatsHolder.addItem(a.name,{valueDefault:0,storeLocally:!0}),this.StatsHolder.getItem(a.name)&&this.enableMod(a.name))},a.prototype.addMods=function(a){for(var b=0;b<a.length;b+=1)this.addMod(a[b])},a.prototype.enableMod=function(a){var b,c=this.mods[a];if(!c)throw new Error("No mod of name: '"+a+"'");return c.enabled=!0,b=Array.prototype.slice.call(arguments),b[0]=c,this.StatsHolder&&this.StatsHolder.setItem(a,!0),c.events.hasOwnProperty("onModEnable")?this.fireModEvent("onModEnable",c.name,arguments):void 0},a.prototype.enableMods=function(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];a.forEach(this.enableMod.bind(this))},a.prototype.disableMod=function(a){var b,c=this.mods[a];if(!this.mods[a])throw new Error("No mod of name: '"+a+"'");return this.mods[a].enabled=!1,b=Array.prototype.slice.call(arguments),b[0]=c,this.StatsHolder&&this.StatsHolder.setItem(a,!1),c.events.hasOwnProperty("onModDisable")?this.fireModEvent("onModDisable",c.name,b):void 0},a.prototype.disableMods=function(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];a.forEach(this.disableMod.bind(this))},a.prototype.toggleMod=function(a){var b=this.mods[a];if(!b)throw new Error("No mod found under "+a);

return b.enabled?this.disableMod(a):this.enableMod(a)},a.prototype.toggleMods=function(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];a.forEach(this.toggleMod.bind(this))},a.prototype.fireEvent=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];var d,e,f=this.events[a],g=Array.prototype.splice.call(arguments,0);if(f)for(e=0;e<f.length;e+=1)d=f[e],g[0]=d,d.enabled&&d.events[a].apply(d.scope,g)},a.prototype.fireModEvent=function(a,b){for(var c=[],d=2;d<arguments.length;d++)c[d-2]=arguments[d];var e,f=this.mods[b],g=Array.prototype.slice.call(arguments,2);if(!f)throw new Error("Unknown mod requested: '"+b+"'");if(g[0]=f,e=f.events[a],!e)throw new Error("Mod does not contain event: '"+a+"'");return e.apply(f.scope,g)},a}();a.ModAttachr=b}(ModAttachr||(ModAttachr={}));var NumberMakr;!function(a){"use strict";var b=function(){function a(a){void 0===a&&(a={}),this.stateLength=a.stateLength||624,this.statePeriod=a.statePeriod||397,this.matrixA=a.matrixA||2567483615,this.maskUpper=a.maskUpper||2147483648,this.maskLower=a.maskLower||2147483647,this.stateVector=new Array(this.stateLength),this.stateIndex=this.stateLength+1,this.matrixAMagic=new Array(0,this.matrixA),this.resetFromSeed(a.seed||(new Date).getTime())}return a.prototype.getSeed=function(){return this.seed},a.prototype.getStateLength=function(){return this.stateLength},a.prototype.getStatePeriod=function(){return this.statePeriod},a.prototype.getMatrixA=function(){return this.matrixA},a.prototype.getMaskUpper=function(){return this.maskUpper},a.prototype.getMaskLower=function(){return this.maskLower},a.prototype.resetFromSeed=function(a){void 0===a&&(a=0);var b;for(this.stateVector[0]=a>>>0,this.stateIndex=1;this.stateIndex<this.stateLength;this.stateIndex+=1)b=this.stateVector[this.stateIndex-1]^this.stateVector[this.stateIndex-1]>>>30,this.stateVector[this.stateIndex]=(1812433253*((4294901760&b)>>>16)<<16)+1812433253*(65535&b)+this.stateIndex>>>0;this.seed=a},a.prototype.resetFromArray=function(a,b){void 0===b&&(b=a.length);var c,d,e=1,f=0;for(this.resetFromSeed(19650218),"undefined"==typeof b&&(b=a.length),c=this.stateLength>b?this.stateLength:b;c>0;)d=this.stateVector[e-1]^this.stateVector[e-1]>>>30,this.stateVector[e]=(this.stateVector[e]^(1664525*((4294901760&d)>>>16)<<16)+1664525*(65535&d)+a[f]+f)>>>0,e+=1,f+=1,e>=this.stateLength&&(this.stateVector[0]=this.stateVector[this.stateLength-1],e=1),f>=b&&(f=0);for(c=this.stateLength-1;c;c-=1)d=this.stateVector[e-1]^this.stateVector[e-1]>>>30,this.stateVector[e]=(this.stateVector[e]^(1566083941*((4294901760&d)>>>16)<<16)+1566083941*(65535&d))-e>>>0,e+=1,e>=this.stateLength&&(this.stateVector[0]=this.stateVector[this.stateLength-1],e=1);this.stateVector[0]=2147483648,this.seed=a},a.prototype.randomInt32=function(){var a,b;if(this.stateIndex>=this.stateLength){for(this.stateIndex===this.stateLength+1&&this.resetFromSeed(5489),b=0;b<this.stateLength-this.statePeriod;b+=1)a=this.stateVector[b]&this.maskUpper|this.stateVector[b+1]&this.maskLower,this.stateVector[b]=this.stateVector[b+this.statePeriod]^a>>>1^this.matrixAMagic[1&a];for(;b<this.stateLength-1;b+=1)a=this.stateVector[b]&this.maskUpper|this.stateVector[b+1]&this.maskLower,this.stateVector[b]=this.stateVector[b+(this.statePeriod-this.stateLength)]^a>>>1^this.matrixAMagic[1&a];a=this.stateVector[this.stateLength-1]&this.maskUpper|this.stateVector[0]&this.maskLower,this.stateVector[this.stateLength-1]=this.stateVector[this.statePeriod-1]^a>>>1^this.matrixAMagic[1&a],this.stateIndex=0}return a=this.stateVector[this.stateIndex],this.stateIndex+=1,a^=a>>>11,a^=a<<7&2636928640,a^=a<<15&4022730752,a^=a>>>18,a>>>0},a.prototype.random=function(){return this.randomInt32()*(1/4294967296)},a.prototype.randomInt31=function(){return this.randomInt32()>>>1},a.prototype.randomReal1=function(){return this.randomInt32()*(1/4294967295)},a.prototype.randomReal3=function(){return(this.randomInt32()+.5)*(1/4294967296)},a.prototype.randomReal53Bit=function(){var a=this.randomInt32()>>>5,b=this.randomInt32()>>>6;return(67108864*a+b)*(1/9007199254740992)},a.prototype.randomUnder=function(a){return this.random()*a},a.prototype.randomWithin=function(a,b){return this.randomUnder(b-a)+a},a.prototype.randomInt=function(a){return 0|this.randomUnder(a)},a.prototype.randomIntWithin=function(a,b){return this.randomUnder(b-a)+a|0},a.prototype.randomBoolean=function(){return 1===this.randomInt(2)},a.prototype.randomBooleanProbability=function(a){return this.random()<a},a.prototype.randomBooleanFraction=function(a,b){return this.random()<=a/b},a.prototype.randomArrayIndex=function(a){return this.randomIntWithin(0,a.length)},a.prototype.randomArrayMember=function(a){return a[this.randomArrayIndex(a)]},a}();a.NumberMakr=b}(NumberMakr||(NumberMakr={}));var ThingHittr;!function(a){"use strict";var b=function(){function a(a){this.globalCheckGenerators=a.globalCheckGenerators,this.hitCheckGenerators=a.hitCheckGenerators,this.hitFunctionGenerators=a.hitFunctionGenerators,this.groupNames=a.groupNames,this.keyNumQuads=a.keyNumQuads||"numquads",this.keyQuadrants=a.keyQuadrants||"quadrants",this.keyGroupName=a.keyGroupName||"group",this.hitChecks={},this.globalChecks={},this.hitFunctions={},this.cachedGroupNames={},this.cachedTypeNames={},this.checkHitsOf={}}return a.prototype.cacheHitCheckGroup=function(a){this.cachedGroupNames[a]||(this.cachedGroupNames[a]=!0,"undefined"!=typeof this.globalCheckGenerators[a]&&(this.globalChecks[a]=this.cacheGlobalCheck(a)))},a.prototype.cacheHitCheckType=function(a,b){this.cachedTypeNames[a]||("undefined"!=typeof this.globalCheckGenerators[b]&&(this.globalChecks[a]=this.cacheGlobalCheck(b)),"undefined"!=typeof this.hitCheckGenerators[b]&&(this.hitChecks[a]=this.cacheFunctionGroup(this.hitCheckGenerators[b])),"undefined"!=typeof this.hitFunctionGenerators[b]&&(this.hitFunctions[a]=this.cacheFunctionGroup(this.hitFunctionGenerators[b])),this.cachedTypeNames[a]=!0,this.checkHitsOf[a]=this.generateHitsCheck(a).bind(this))},a.prototype.generateHitsCheck=function(a){return function(b){var c,d,e,f,g,h;if("undefined"==typeof this.globalChecks[this.typeName]||this.globalChecks[this.typeName](b))for(f=0;f<b[this.keyNumQuads];f+=1)for(g=0;g<this.groupNames.length;g+=1)if(e=this.hitChecks[a][this.groupNames[g]])for(c=b[this.keyQuadrants][f].things[this.groupNames[g]],h=0;h<c.length&&(d=c[h],b!==d);h+=1)("undefined"==typeof this.globalChecks[d[this.keyGroupName]]||this.globalChecks[d[this.keyGroupName]](d))&&e(b,d)&&this.hitFunctions[a][d[this.keyGroupName]](b,d)}},a.prototype.checkHit=function(a,b,c,d){var e,f=this.hitChecks[c];if(!f)throw new Error("No hit checks defined for "+c+".");if(e=f[d],!e)throw new Error("No hit check defined for "+c+" and "+d+".");return e(a,b)},a.prototype.cacheGlobalCheck=function(a){return this.globalCheckGenerators[a]()},a.prototype.cacheFunctionGroup=function(a){var b,c={};for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]());return c},a}();a.ThingHittr=b}(ThingHittr||(ThingHittr={}));var WorldSeedr;!function(a){"use strict";var b=function(){function a(a){if(this.directionOpposites={top:"bottom",right:"left",bottom:"top",left:"right"},this.directionSizing={top:"height",right:"width",bottom:"height",left:"width"},this.directionNames=["top","right","bottom","left"],this.sizingNames=["width","height"],"undefined"==typeof a.possibilities)throw new Error("No possibilities given to WorldSeedr.");this.possibilities=a.possibilities,this.random=a.random||Math.random.bind(Math),this.onPlacement=a.onPlacement||console.log.bind(console,"Got:"),this.clearGeneratedCommands()}return a.prototype.getPossibilities=function(){return this.possibilities},a.prototype.setPossibilities=function(a){this.possibilities=a},a.prototype.getOnPlacement=function(){return this.onPlacement},a.prototype.setOnPlacement=function(a){this.onPlacement=a},a.prototype.clearGeneratedCommands=function(){this.generatedCommands=[]},a.prototype.runGeneratedCommands=function(){this.onPlacement(this.generatedCommands)},a.prototype.generate=function(a,b){var c=this.possibilities[a];if(!c)throw new Error("No possibility exists under '"+a+"'");if(!c.contents)throw new Error("Possibility '"+a+"' has no possibile outcomes.");return this.generateChildren(c,this.objectCopy(b))},a.prototype.generateFull=function(a){var b,c,d=this.generate(a.title,a);if(d&&d.children)for(c=0;c<d.children.length;c+=1)switch(b=d.children[c],b.type){case"Known":this.generatedCommands.push(b);break;case"Random":this.generateFull(b)}},a.prototype.generateChildren=function(a,b,c){void 0===c&&(c=void 0);var d,e=a.contents,f=e.spacing||0,g=this.objectMerge(a,b);switch(c=e.direction||c,e.mode){case"Random":d=this.generateChildrenRandom(e,g,c,f);break;case"Certain":d=this.generateChildrenCertain(e,g,c,f);break;case"Repeat":d=this.generateChildrenRepeat(e,g,c,f);break;case"Multiple":d=this.generateChildrenMultiple(e,g,c,f)}return this.wrapChoicePositionExtremes(d)},a.prototype.generateChildrenCertain=function(a,b,c,d){var e=this;return a.children.map(function(f){if("Final"===f.type)return e.parseChoiceFinal(a,f,b,c);var g=e.parseChoice(f,b,c);return g&&("Known"!==g.type&&(g.contents=e.generate(g.title,b)),e.shrinkPositionByChild(b,g,c,d)),g}).filter(function(a){return void 0!==a})},a.prototype.generateChildrenRepeat=function(a,b,c,d){for(var e,f,g=a.children,h=[],i=0;this.positionIsNotEmpty(b,c)&&(e=g[i],"Final"===e.type?f=this.parseChoiceFinal(a,e,b,c):(f=this.parseChoice(e,b,c),f&&"Known"!==f.type&&(f.contents=this.generate(f.title,b))),f&&this.choiceFitsPosition(f,b));)this.shrinkPositionByChild(b,f,c,d),h.push(f),i+=1,i>=g.length&&(i=0);return h},a.prototype.generateChildrenRandom=function(a,b,c,d){for(var e,f=[];this.positionIsNotEmpty(b,c)&&(e=this.generateChild(a,b,c));)if(this.shrinkPositionByChild(b,e,c,d),f.push(e),a.limit&&f.length>a.limit)return;return f},a.prototype.generateChildrenMultiple=function(a,b,c,d){var e=this;return a.children.map(function(a){var f=e.parseChoice(a,e.objectCopy(b),c);return c&&e.movePositionBySpacing(b,c,d),f})},a.prototype.generateChild=function(a,b,c){var d=this.chooseAmongPosition(a.children,b);return d?this.parseChoice(d,b,c):void 0},a.prototype.parseChoice=function(a,b,c){var d=a.title,e=this.possibilities[d],f={title:d,type:a.type,arguments:a.arguments instanceof Array?this.chooseAmong(a.arguments).values:a.arguments,width:void 0,height:void 0,top:void 0,right:void 0,bottom:void 0,left:void 0};switch(this.ensureSizingOnChoice(f,a,e),this.ensureDirectionBoundsOnChoice(f,b),f[c]=f[this.directionOpposites[c]]+f[this.directionSizing[c]],e.contents.snap){case"top":f.bottom=f.top-f.height;break;case"right":f.left=f.right-f.width;break;case"bottom":f.top=f.bottom+f.height;break;case"left":f.right=f.left+f.width}return a.stretch&&(f.arguments||(f.arguments={}),a.stretch.width&&(f.left=b.left,f.right=b.right,f.width=f.right-f.left,f.arguments.width=f.width),a.stretch.height&&(f.top=b.top,f.bottom=b.bottom,f.height=f.top-f.bottom,f.arguments.height=f.height)),this.copySchemaArguments(e,a,f),f},a.prototype.parseChoiceFinal=function(a,b,c){var d=this.possibilities[b.source],e={type:"Known",title:b.title,arguments:b.arguments,width:d.width,height:d.height,top:c.top,right:c.right,bottom:c.bottom,left:c.left};return this.copySchemaArguments(d,b,e),e},a.prototype.chooseAmong=function(a){if(!a.length)return void 0;if(1===a.length)return a[0];var b,c=this.randomPercentage(),d=0;for(b=0;b<a.length;b+=1)if(d+=a[b].percent,d>=c)return a[b]},a.prototype.chooseAmongPosition=function(a,b){var c=b.right-b.left,d=b.top-b.bottom,e=this;return this.chooseAmong(a.filter(function(a){return e.choiceFits(e.possibilities[a.title],c,d)}))},a.prototype.choiceFits=function(a,b,c){return a.width<=b&&a.height<=c},a.prototype.choiceFitsPosition=function(a,b){return this.choiceFits(a,b.right-b.left,b.top-b.bottom)},a.prototype.randomPercentage=function(){return Math.floor(100*this.random())+1},a.prototype.randomBetween=function(a,b){return Math.floor(this.random()*(1+b-a))+a},a.prototype.objectCopy=function(a){var b,c={};for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c},a.prototype.objectMerge=function(a,b){var c,d=this.objectCopy(a);for(c in b)b.hasOwnProperty(c)&&!d.hasOwnProperty(c)&&(d[c]=b[c]);return d},a.prototype.positionIsNotEmpty=function(a,b){return"right"===b||"left"===b?a.left<a.right:a.top>a.bottom},a.prototype.shrinkPositionByChild=function(a,b,c,d){switch(c){case"top":a.bottom=b.top+this.parseSpacing(d);break;case"right":a.left=b.right+this.parseSpacing(d);break;case"bottom":a.top=b.bottom-this.parseSpacing(d);break;case"left":a.right=b.left-this.parseSpacing(d)}},a.prototype.movePositionBySpacing=function(a,b,c){void 0===c&&(c=0);var d=this.parseSpacing(c);switch(b){case"top":a.top+=d,a.bottom+=d;break;case"right":a.left+=d,a.right+=d;break;case"bottom":a.top-=d,a.bottom-=d;break;case"left":a.left-=d,a.right-=d}},a.prototype.parseSpacing=function(a){if(!a)return 0;switch(a.constructor){case Array:return this.parseSpacingObject(a[0].constructor===Number?this.randomBetween(a[0],a[1]):this.chooseAmong(a).value);case Object:return this.parseSpacingObject(a);default:return a}},a.prototype.parseSpacingObject=function(a){if(a.constructor===Number)return a;var b=a.min,c=a.max,d=a.units||1;return this.randomBetween(b/d,c/d)*d},a.prototype.wrapChoicePositionExtremes=function(a){var b,c,d;if(!a||!a.length)return void 0;if(c=a[0],b={title:void 0,top:c.top,right:c.right,bottom:c.bottom,left:c.left,width:void 0,height:void 0,children:a},1===a.length)return b;for(d=1;d<a.length;d+=1){if(c=a[d],!Object.keys(c).length)return b;b.top=Math.max(b.top,c.top),b.right=Math.max(b.right,c.right),b.bottom=Math.min(b.bottom,c.bottom),b.left=Math.min(b.left,c.left)}return b.width=b.right-b.left,b.height=b.top-b.bottom,b},a.prototype.copySchemaArguments=function(a,b,c){var d,e=a.contents.argumentMap;if(e){c.arguments||(c.arguments={});for(d in e)e.hasOwnProperty(d)&&(c.arguments[e[d]]=b[d])}},a.prototype.ensureSizingOnChoice=function(a,b,c){var d,e;for(e in this.sizingNames)this.sizingNames.hasOwnProperty(e)&&(d=this.sizingNames[e],a[d]=b.sizing&&"undefined"!=typeof b.sizing[d]?b.sizing[d]:c[d])},a.prototype.ensureDirectionBoundsOnChoice=function(a,b){for(var c in this.directionNames)this.directionNames.hasOwnProperty(c)&&(a[this.directionNames[c]]=b[this.directionNames[c]])},a}();a.WorldSeedr=b}(WorldSeedr||(WorldSeedr={})),function(){function a(a,c){"use strict";var d=new b(a,c);return d.beautify()}function b(a,b){"use strict";function d(a,b){var c=0;a&&(c=a.indentation_level,!j()&&a.lineIndent_level>c&&(c=a.lineIndent_level));var d={mode:b,parent:a,last_text:a?a.last_text:"",last_word:a?a.last_word:"",declaration_statement:!1,declaration_assignment:!1,in_html_comment:!1,multiline_frame:!1,if_block:!1,else_block:!1,do_block:!1,do_while:!1,in_case_statement:!1,in_case:!1,case_body:!1,indentation_level:c,lineIndent_level:a?a.lineIndent_level:c,start_lineIndex:X.length,had_comment:!1,ternary_depth:0};return d}function e(){return{text:[]}}function f(a){if(a=void 0===a?!1:a,X.length)for(g(X[X.length-1]);a&&X.length>1&&0===X[X.length-1].text.length;)X.pop(),g(X[X.length-1])}function g(a){for(;a.text.length&&(" "===a.text[a.text.length-1]||a.text[a.text.length-1]===aa||a.text[a.text.length-1]===ua);)a.text.pop()}function h(a){return a.replace(/^\s+|\s+$/g,"")}function i(a){a=a.replace(/\x0d/g,"");for(var b=[],c=a.indexOf("\n");-1!==c;)b.push(a.substring(0,c)),a=a.substring(c+1),c=a.indexOf("\n");return a.length&&b.push(a),b}function j(){var a=X[X.length-1];return 0===a.text.length}function k(){if(j()){if(1===X.length)return!0;var a=X[X.length-2];return 0===a.text.length}return!1}function l(a){if(a=void 0===a?!1:a,ta.wrap_line_length&&!a){var b=X[X.length-1],c=0;b.text.length>0&&(c=b.text.join("").length+Y.length+(na?1:0),c>=ta.wrap_line_length&&(a=!0))}(ta.preserve_newlines&&ma||a)&&!j()&&m(!1,!0)}function m(a,b){if(na=!1,!b&&";"!==ba.last_text&&","!==ba.last_text&&"="!==ba.last_text&&"TK_OPERATOR"!==$)for(;ba.mode===sa.Statement&&!ba.if_block&&!ba.do_block;)x();1===X.length&&j()||(a||!j())&&(ba.multiline_frame=!0,X.push(e()))}function n(){if(j()){var a=X[X.length-1];if(ta.keep_arrayIndentation&&v(ba.mode)&&ma){a.text.push("");for(var b=0;b<qa.length;b+=1)a.text.push(qa[b])}else ua&&a.text.push(ua),o(ba.indentation_level)}}function o(a){if(X.length>1){var b=X[X.length-1];ba.lineIndent_level=a;for(var c=0;a>c;c+=1)b.text.push(aa)}}function p(){var a=X[X.length-1];if(na&&a.text.length){var b=a.text[a.text.length-1];" "!==b&&b!==aa&&a.text.push(" ")}}function q(a){a=a||Y,n(),p(),na=!1,X[X.length-1].text.push(a)}function r(){ba.indentation_level+=1}function s(){ba.indentation_level>0&&(!ba.parent||ba.indentation_level>ba.parent.indentation_level)&&(ba.indentation_level-=1)}function t(a){if(!a.multiline_frame)for(var b,c=a.start_lineIndex,d=0;c<X.length;)b=X[c],c++,0!==b.text.length&&(d=ua&&b.text[0]===ua?1:0,b.text[d]===aa&&b.text.splice(d,1))}function u(a){ba?(da.push(ba),ca=ba):ca=d(null,a),ba=d(ca,a)}function v(a){return a===sa.ArrayLiteral}function w(a){return D(a,[sa.Expression,sa.ForInitializer,sa.Conditional])}function x(){da.length>0&&(ca=ba,ba=da.pop(),ca.mode===sa.Statement&&t(ca))}function y(){return ba.parent.mode===sa.ObjectLiteral&&ba.mode===sa.Statement&&":"===ba.last_text&&0===ba.ternary_depth}function z(){return"TK_RESERVED"===$&&D(ba.last_text,["var","let","const"])&&"TK_WORD"===Z||"TK_RESERVED"===$&&"do"===ba.last_text||"TK_RESERVED"===$&&"return"===ba.last_text&&!ma||"TK_RESERVED"===$&&"else"===ba.last_text&&("TK_RESERVED"!==Z||"if"!==Y)||"TK_END_EXPR"===$&&(ca.mode===sa.ForInitializer||ca.mode===sa.Conditional)||"TK_WORD"===$&&ba.mode===sa.BlockStatement&&!ba.in_case&&"--"!==Y&&"++"!==Y&&"TK_WORD"!==Z&&"TK_RESERVED"!==Z||ba.mode===sa.ObjectLiteral&&":"===ba.last_text&&0===ba.ternary_depth?(u(sa.Statement),r(),"TK_RESERVED"===$&&D(ba.last_text,["var","let","const"])&&"TK_WORD"===Z&&(ba.declaration_statement=!0),y()||l("TK_RESERVED"===Z&&D(Y,["do","for","if","while"])),!0):!1}function A(a,b){for(var c=0;c<a.length;c++){var d=h(a[c]);if(d.charAt(0)!==b)return!1}return!0}function B(a,b){for(var c,d=0,e=a.length;e>d;d++)if(c=a[d],c&&0!==c.indexOf(b))return!1;return!0}function C(a){return D(a,["case","return","do","if","throw","else"])}function D(a,b){for(var c=0;c<b.length;c+=1)if(b[c]===a)return!0;return!1}function E(a){for(var b,c=!1,d="",e=0,f="",g=0;c||e<a.length;)if(b=a.charAt(e),e++,c){if(c=!1,"x"===b)f=a.substr(e,2),e+=2;else{if("u"!==b){d+="\\"+b;continue}f=a.substr(e,4),e+=4}if(!f.match(/^[0123456789abcdefABCDEF]+$/))return a;if(g=parseInt(f,16),g>=0&&32>g){d+="x"===b?"\\x"+f:"\\u"+f;continue}if(34===g||39===g||92===g)d+="\\"+String.fromCharCode(g);else{if("x"===b&&g>126&&255>=g)return a;d+=String.fromCharCode(g)}}else"\\"===b?c=!0:d+=b;return d}function F(a){for(var b=ha,c=W.charAt(b);D(c,ea)&&c!==a;){if(b++,b>=oa)return!1;c=W.charAt(b)}return c===a}function G(){var a;if(pa=0,ha>=oa)return["","TK_EOF"];ma=!1,qa=[];var b=W.charAt(ha);for(ha+=1;D(b,ea);){if("\n"===b?(pa+=1,qa=[]):pa&&(b===aa?qa.push(aa):"\r"!==b&&qa.push(" ")),ha>=oa)return["","TK_EOF"];b=W.charAt(ha),ha+=1}if(c.isIdentifierChar(W.charCodeAt(ha-1))){if(oa>ha)for(;c.isIdentifierChar(W.charCodeAt(ha))&&(b+=W.charAt(ha),ha+=1,ha!==oa););if(ha!==oa&&b.match(/^[0-9]+[Ee]$/)&&("-"===W.charAt(ha)||"+"===W.charAt(ha))){var d=W.charAt(ha);ha+=1;var e=G();return b+=d+e[0],[b,"TK_WORD"]}return"TK_DOT"===$||"TK_RESERVED"===$&&D(ba.last_text,["set","get"])||!D(b,ja)?[b,"TK_WORD"]:"in"===b?[b,"TK_OPERATOR"]:[b,"TK_RESERVED"]}if("("===b||"["===b)return[b,"TK_START_EXPR"];if(")"===b||"]"===b)return[b,"TK_END_EXPR"];if("{"===b)return[b,"TK_START_BLOCK"];if("}"===b)return[b,"TK_END_BLOCK"];if(";"===b)return[b,"TK_SEMICOLON"];if("/"===b){var f="",g=!0;if("*"===W.charAt(ha)){if(ha+=1,oa>ha)for(;oa>ha&&("*"!==W.charAt(ha)||!W.charAt(ha+1)||"/"!==W.charAt(ha+1))&&(b=W.charAt(ha),f+=b,("\n"===b||"\r"===b)&&(g=!1),ha+=1,!(ha>=oa)););return ha+=2,g&&0===pa?["/*"+f+"*/","TKInLINE_COMMENT"]:["/*"+f+"*/","TK_BLOCK_COMMENT"]}if("/"===W.charAt(ha)){for(f=b;"\r"!==W.charAt(ha)&&"\n"!==W.charAt(ha)&&(f+=W.charAt(ha),ha+=1,!(ha>=oa)););return[f,"TK_COMMENT"]}}if("`"===b||"'"===b||'"'===b||("/"===b||ta.e4x&&"<"===b&&W.slice(ha-1).match(/^<([-a-zA-Z:0-9_.]+|{[^{}]*}|!\[CDATA\[[\s\S]*?\]\])\s*([-a-zA-Z:0-9_.]+=('[^']*'|"[^"]*"|{[^{}]*})\s*)*\/?\s*>/))&&("TK_RESERVED"===$&&C(ba.last_text)||"TK_END_EXPR"===$&&D(ca.mode,[sa.Conditional,sa.ForInitializer])||D($,["TK_COMMENT","TK_START_EXPR","TK_START_BLOCK","TK_END_BLOCK","TK_OPERATOR","TK_EQUALS","TK_EOF","TK_SEMICOLON","TK_COMMA"]))){var i=b,j=!1,k=!1;if(a=b,oa>ha)if("/"===i){for(var l=!1;j||l||W.charAt(ha)!==i;)if(a+=W.charAt(ha),j?j=!1:(j="\\"===W.charAt(ha),"["===W.charAt(ha)?l=!0:"]"===W.charAt(ha)&&(l=!1)),ha+=1,ha>=oa)return[a,"TK_STRING"]}else if(ta.e4x&&"<"===i){var m=/<(\/?)([-a-zA-Z:0-9_.]+|{[^{}]*}|!\[CDATA\[[\s\S]*?\]\])\s*([-a-zA-Z:0-9_.]+=('[^']*'|"[^"]*"|{[^{}]*})\s*)*(\/?)\s*>/g,n=W.slice(ha-1),o=m.exec(n);if(o&&0===o.index){for(var p=o[2],q=0;o;){var r=!!o[1],s=o[2],t=!!o[o.length-1]||"![CDATA["===s.slice(0,8);if(s!==p||t||(r?--q:++q),0>=q)break;o=m.exec(n)}var u=o?o.index+o[0].length:n.length;return ha+=u-1,[n.slice(0,u),"TK_STRING"]}}else for(;j||W.charAt(ha)!==i;)if(a+=W.charAt(ha),j?(("x"===W.charAt(ha)||"u"===W.charAt(ha))&&(k=!0),j=!1):j="\\"===W.charAt(ha),ha+=1,ha>=oa)return[a,"TK_STRING"];if(ha+=1,a+=i,k&&ta.unescape_strings&&(a=E(a)),"/"===i)for(;oa>ha&&D(W.charAt(ha),fa);)a+=W.charAt(ha),ha+=1;return[a,"TK_STRING"]}if("#"===b){if(1===X.length&&0===X[0].text.length&&"!"===W.charAt(ha)){for(a=b;oa>ha&&"\n"!==b;)b=W.charAt(ha),a+=b,ha+=1;return[h(a)+"\n","TK_UNKNOWN"]}var v="#";if(oa>ha&&D(W.charAt(ha),ka)){do b=W.charAt(ha),v+=b,ha+=1;while(oa>ha&&"#"!==b&&"="!==b);return"#"===b||("["===W.charAt(ha)&&"]"===W.charAt(ha+1)?(v+="[]",ha+=2):"{"===W.charAt(ha)&&"}"===W.charAt(ha+1)&&(v+="{}",ha+=2)),[v,"TK_WORD"]}}if("<"===b&&"<!--"===W.substring(ha-1,ha+3)){for(ha+=3,b="<!--";"\n"!==W.charAt(ha)&&oa>ha;)b+=W.charAt(ha),ha++;return ba.in_html_comment=!0,[b,"TK_COMMENT"]}if("-"===b&&ba.in_html_comment&&"-->"===W.substring(ha-1,ha+2))return ba.in_html_comment=!1,ha+=2,["-->","TK_COMMENT"];if("."===b)return[b,"TK_DOT"];if(D(b,ga)){for(;oa>ha&&D(b+W.charAt(ha),ga)&&(b+=W.charAt(ha),ha+=1,!(ha>=oa)););return","===b?[b,"TK_COMMA"]:"="===b?[b,"TK_EQUALS"]:[b,"TK_OPERATOR"]}return[b,"TK_UNKNOWN"]}function H(){z();var a=sa.Expression;if("["===Y){if("TK_WORD"===$||")"===ba.last_text)return"TK_RESERVED"===$&&D(ba.last_text,ia)&&(na=!0),u(a),q(),r(),void(ta.spaceIn_paren&&(na=!0));a=sa.ArrayLiteral,v(ba.mode)&&("["===ba.last_text||","===ba.last_text&&("]"===_||"}"===_))&&(ta.keep_arrayIndentation||m())}else"TK_RESERVED"===$&&"for"===ba.last_text?a=sa.ForInitializer:"TK_RESERVED"===$&&D(ba.last_text,["if","while"])&&(a=sa.Conditional);";"===ba.last_text||"TK_START_BLOCK"===$?m():"TK_END_EXPR"===$||"TK_START_EXPR"===$||"TK_END_BLOCK"===$||"."===ba.last_text?l(ma):"TK_RESERVED"===$&&"("===Y||"TK_WORD"===$||"TK_OPERATOR"===$?"TK_RESERVED"===$&&("function"===ba.last_word||"typeof"===ba.last_word)||"*"===ba.last_text&&"function"===_?ta.jslint_happy&&(na=!0):"TK_RESERVED"!==$||!D(ba.last_text,ia)&&"catch"!==ba.last_text||ta.space_before_conditional&&(na=!0):na=!0,"("===Y&&("TK_EQUALS"===$||"TK_OPERATOR"===$)&&(y()||l()),u(a),q(),ta.spaceIn_paren&&(na=!0),r()}function I(){for(;ba.mode===sa.Statement;)x();ba.multiline_frame&&l("]"===Y&&v(ba.mode)&&!ta.keep_arrayIndentation),ta.spaceIn_paren&&("TK_START_EXPR"!==$||ta.spaceIn_empty_paren?na=!0:(f(),na=!1)),"]"===Y&&ta.keep_arrayIndentation?(q(),x()):(x(),q()),t(ca),ba.do_while&&ca.mode===sa.Conditional&&(ca.mode=sa.Expression,ba.do_block=!1,ba.do_while=!1)}function J(){u(sa.BlockStatement);var a=F("}"),b=a&&"function"===ba.last_word&&"TK_END_EXPR"===$;"expand"===ta.brace_style?"TK_OPERATOR"!==$&&(b||"TK_EQUALS"===$||"TK_RESERVED"===$&&C(ba.last_text)&&"else"!==ba.last_text)?na=!0:m(!1,!0):"TK_OPERATOR"!==$&&"TK_START_EXPR"!==$?"TK_START_BLOCK"===$?m():na=!0:v(ca.mode)&&","===ba.last_text&&("}"===_?na=!0:m()),q(),r()}function K(){for(;ba.mode===sa.Statement;)x();var a="TK_START_BLOCK"===$;"expand"===ta.brace_style?a||m():a||(v(ba.mode)&&ta.keep_arrayIndentation?(ta.keep_arrayIndentation=!1,m(),ta.keep_arrayIndentation=!0):m()),x(),q()}function L(){if(z()||!ma||w(ba.mode)||"TK_OPERATOR"===$&&"--"!==ba.last_text&&"++"!==ba.last_text||"TK_EQUALS"===$||!ta.preserve_newlines&&"TK_RESERVED"===$&&D(ba.last_text,["var","let","const","set","get"])||m(),ba.do_block&&!ba.do_while){if("TK_RESERVED"===Z&&"while"===Y)return na=!0,q(),na=!0,void(ba.do_while=!0);m(),ba.do_block=!1}if(ba.if_block)if(ba.else_block||"TK_RESERVED"!==Z||"else"!==Y){for(;ba.mode===sa.Statement;)x();ba.if_block=!1,ba.else_block=!1}else ba.else_block=!0;if("TK_RESERVED"===Z&&("case"===Y||"default"===Y&&ba.in_case_statement))return m(),(ba.case_body||ta.jslint_happy)&&(s(),ba.case_body=!1),q(),ba.in_case=!0,void(ba.in_case_statement=!0);if("TK_RESERVED"===Z&&"function"===Y&&((D(ba.last_text,["}",";"])||j()&&!D(ba.last_text,["[","{",":","=",","]))&&(k()||ba.had_comment||(m(),m(!0))),"TK_RESERVED"===$||"TK_WORD"===$?"TK_RESERVED"===$&&D(ba.last_text,["get","set","new","return"])?na=!0:m():"TK_OPERATOR"===$||"="===ba.last_text?na=!0:w(ba.mode)||m()),("TK_COMMA"===$||"TK_START_EXPR"===$||"TK_EQUALS"===$||"TK_OPERATOR"===$)&&(y()||l()),"TK_RESERVED"===Z&&"function"===Y)return q(),void(ba.last_word=Y);if(la="NONE","TK_END_BLOCK"===$?"TK_RESERVED"===Z&&D(Y,["else","catch","finally"])?"expand"===ta.brace_style||"end-expand"===ta.brace_style?la="NEWLINE":(la="SPACE",na=!0):la="NEWLINE":"TK_SEMICOLON"===$&&ba.mode===sa.BlockStatement?la="NEWLINE":"TK_SEMICOLON"===$&&w(ba.mode)?la="SPACE":"TK_STRING"===$?la="NEWLINE":"TK_RESERVED"===$||"TK_WORD"===$||"*"===ba.last_text&&"function"===_?la="SPACE":"TK_START_BLOCK"===$?la="NEWLINE":"TK_END_EXPR"===$&&(na=!0,la="NEWLINE"),"TK_RESERVED"===Z&&D(Y,ia)&&")"!==ba.last_text&&(la="else"===ba.last_text?"SPACE":"NEWLINE"),"TK_RESERVED"===Z&&D(Y,["else","catch","finally"]))if("TK_END_BLOCK"!==$||"expand"===ta.brace_style||"end-expand"===ta.brace_style)m();else{f(!0);var a=X[X.length-1];"}"!==a.text[a.text.length-1]&&m(),na=!0}else"NEWLINE"===la?"TK_RESERVED"===$&&C(ba.last_text)?na=!0:"TK_END_EXPR"!==$?"TK_START_EXPR"===$&&"TK_RESERVED"===Z&&D(Y,["var","let","const"])||":"===ba.last_text||("TK_RESERVED"===Z&&"if"===Y&&"else"===ba.last_word&&"{"!==ba.last_text?na=!0:m()):"TK_RESERVED"===Z&&D(Y,ia)&&")"!==ba.last_text&&m():v(ba.mode)&&","===ba.last_text&&"}"===_?m():"SPACE"===la&&(na=!0);q(),ba.last_word=Y,"TK_RESERVED"===Z&&"do"===Y&&(ba.do_block=!0),"TK_RESERVED"===Z&&"if"===Y&&(ba.if_block=!0)}function M(){for(z()&&(na=!1);ba.mode===sa.Statement&&!ba.if_block&&!ba.do_block;)x();q(),ba.mode===sa.ObjectLiteral&&(ba.mode=sa.BlockStatement)}function N(){z()?na=!0:"TK_RESERVED"===$||"TK_WORD"===$?na=!0:"TK_COMMA"===$||"TK_START_EXPR"===$||"TK_EQUALS"===$||"TK_OPERATOR"===$?y()||l():m(),q()}function O(){z(),ba.declaration_statement&&(ba.declaration_assignment=!0),na=!0,q(),na=!0}function P(){return ba.declaration_statement?(w(ba.parent.mode)&&(ba.declaration_assignment=!1),q(),void(ba.declaration_assignment?(ba.declaration_assignment=!1,m(!1,!0)):na=!0)):(q(),void(ba.mode===sa.ObjectLiteral||ba.mode===sa.Statement&&ba.parent.mode===sa.ObjectLiteral?(ba.mode===sa.Statement&&x(),m()):na=!0))}function Q(){":"!==Y||ba.mode!==sa.BlockStatement||"{"!==_||"TK_WORD"!==$&&"TK_RESERVED"!==$||(ba.mode=sa.ObjectLiteral),z();var a=!0,b=!0;return"TK_RESERVED"===$&&C(ba.last_text)?(na=!0,void q()):"*"!==Y||"TK_DOT"!==$||_.match(/^\d+$/)?":"===Y&&ba.in_case?(ba.case_body=!0,r(),q(),m(),void(ba.in_case=!1)):"::"===Y?void q():(!ma||"--"!==Y&&"++"!==Y||m(!1,!0),"TK_OPERATOR"===$&&l(),D(Y,["--","++","!","~"])||D(Y,["-","+"])&&(D($,["TK_START_BLOCK","TK_START_EXPR","TK_EQUALS","TK_OPERATOR"])||D(ba.last_text,ia)||","===ba.last_text)?(a=!1,b=!1,";"===ba.last_text&&w(ba.mode)&&(a=!0),("TK_RESERVED"===$||"TK_END_EXPR"===$)&&(a=!0),ba.mode!==sa.BlockStatement&&ba.mode!==sa.Statement||"{"!==ba.last_text&&";"!==ba.last_text||m()):":"===Y?0===ba.ternary_depth?(ba.mode===sa.BlockStatement&&(ba.mode=sa.ObjectLiteral),a=!1):ba.ternary_depth-=1:"?"===Y?ba.ternary_depth+=1:"*"===Y&&"TK_RESERVED"===$&&"function"===ba.last_text&&(a=!1,b=!1),na=na||a,q(),void(na=b)):void q()}function R(){var a,b=i(Y),c=!1,d=!1,e=qa.join(""),f=e.length;for(m(!1,!0),b.length>1&&(A(b.slice(1),"*")?c=!0:B(b.slice(1),e)&&(d=!0)),q(b[0]),a=1;a<b.length;a++)m(!1,!0),c?q(" "+h(b[a])):d&&b[a].length>f?q(b[a].substring(f)):X[X.length-1].text.push(b[a]);m(!1,!0)}function S(){na=!0,q(),na=!0}function T(){ma?m(!1,!0):f(!0),na=!0,q(),m(!1,!0)}function U(){z(),"TK_RESERVED"===$&&C(ba.last_text)?na=!0:l(")"===ba.last_text&&ta.break_chained_methods),q()}function V(){q(),"\n"===Y[Y.length-1]&&m()}var W,X,Y,Z,$,_,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua="";for(ea="\n\r	 ".split(""),fa="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_$".split(""),ka="0123456789".split(""),ga="+ - * / % & ++ -- = += -= *= /= %= == === != !== > < >= <= >> << >>> >>>= >>= <<= && &= | || ! ~ , : ? ^ ^= |= :: =>",ga+=" <%= <% %> <?= <? ?>",ga=ga.split(" "),ia="continue,try,throw,return,var,let,const,if,switch,case,default,for,while,break,function,yield".split(","),ja=ia.concat(["do","in","else","get","set","new","catch","finally","typeof"]),sa={BlockStatement:"BlockStatement",Statement:"Statement",ObjectLiteral:"ObjectLiteral",ArrayLiteral:"ArrayLiteral",ForInitializer:"ForInitializer",Conditional:"Conditional",Expression:"Expression"},ra={TK_START_EXPR:H,TK_END_EXPR:I,TK_START_BLOCK:J,TK_END_BLOCK:K,TK_WORD:L,TK_RESERVED:L,TK_SEMICOLON:M,TK_STRING:N,TK_EQUALS:O,TK_OPERATOR:Q,TK_COMMA:P,TK_BLOCK_COMMENT:R,TKInLINE_COMMENT:S,TK_COMMENT:T,TK_DOT:U,TK_UNKNOWN:V},b=b?b:{},ta={},void 0!==b.spaceAfter_anon_function&&void 0===b.jslint_happy&&(b.jslint_happy=b.spaceAfter_anon_function),void 0!==b.braces_on_own_line&&(ta.brace_style=b.braces_on_own_line?"expand":"collapse"),ta.brace_style=b.brace_style?b.brace_style:ta.brace_style?ta.brace_style:"collapse","expand-strict"===ta.brace_style&&(ta.brace_style="expand"),ta.indent_size=b.indent_size?parseInt(b.indent_size,10):4,ta.indent_char=b.indent_char?b.indent_char:" ",ta.preserve_newlines=void 0===b.preserve_newlines?!0:b.preserve_newlines,ta.break_chained_methods=void 0===b.break_chained_methods?!1:b.break_chained_methods,ta.max_preserve_newlines=void 0===b.max_preserve_newlines?0:parseInt(b.max_preserve_newlines,10),ta.spaceIn_paren=void 0===b.spaceIn_paren?!1:b.spaceIn_paren,ta.spaceIn_empty_paren=void 0===b.spaceIn_empty_paren?!1:b.spaceIn_empty_paren,ta.jslint_happy=void 0===b.jslint_happy?!1:b.jslint_happy,ta.keep_arrayIndentation=void 0===b.keep_arrayIndentation?!1:b.keep_arrayIndentation,ta.space_before_conditional=void 0===b.space_before_conditional?!0:b.space_before_conditional,ta.unescape_strings=void 0===b.unescape_strings?!1:b.unescape_strings,ta.wrap_line_length=void 0===b.wrap_line_length?0:parseInt(b.wrap_line_length,10),ta.e4x=void 0===b.e4x?!1:b.e4x,b.indent_with_tabs&&(ta.indent_char="	",ta.indent_size=1),aa="";ta.indent_size>0;)aa+=ta.indent_char,ta.indent_size-=1;for(;a&&(" "===a.charAt(0)||"	"===a.charAt(0));)ua+=a.charAt(0),a=a.substring(1);W=a,oa=a.length,$="TK_START_BLOCK",_="",X=[e()],na=!1,qa=[],da=[],u(sa.BlockStatement),ha=0,this.beautify=function(){for(var a,b,c,d;;){if(a=G(),Y=a[0],Z=a[1],"TK_EOF"===Z){for(;ba.mode===sa.Statement;)x();break}if(c=ta.keep_arrayIndentation&&v(ba.mode),ma=pa>0,c)for(b=0;pa>b;b+=1)m(b>0);else if(ta.max_preserve_newlines&&pa>ta.max_preserve_newlines&&(pa=ta.max_preserve_newlines),ta.preserve_newlines&&pa>1)for(m(),b=1;pa>b;b+=1)m(!0);ra[Z](),"TKInLINE_COMMENT"!==Z&&"TK_COMMENT"!==Z&&"TK_BLOCK_COMMENT"!==Z&&"TK_UNKNOWN"!==Z&&(_=ba.last_text,$=Z,ba.last_text=Y),ba.had_comment="TKInLINE_COMMENT"===Z||"TK_COMMENT"===Z||"TK_BLOCK_COMMENT"===Z;

}d=X[0].text.join("");for(var e=1;e<X.length;e++)d+="\n"+X[e].text.join("");return d=d.replace(/[\r\n ]+$/,"")}}var c={};!function(a){{var b="------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",c="------------------------------------------------------------------------------------------------------------------------------------------",d=new RegExp("["+b+"]"),e=new RegExp("["+b+c+"]");a.isIdentifierStart=function(a){return 65>a?36===a:91>a?!0:97>a?95===a:123>a?!0:a>=170&&d.test(String.fromCharCode(a))},a.isIdentifierChar=function(a){return 48>a?36===a:58>a?!0:65>a?!1:91>a?!0:97>a?95===a:123>a?!0:a>=170&&e.test(String.fromCharCode(a))}}}(c),"function"==typeof define&&define.amd?define([],function(){return{js_beautify:a}}):"undefined"!=typeof exports?exports.js_beautify=a:"undefined"!=typeof window?window.js_beautify=a:"undefined"!=typeof global&&(global.js_beautify=a)}();var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},GameStartr;!function(a){"use strict";var b=function(a){function b(b){void 0===b&&(b={}),a.call(this,{customs:b,constantsSource:b.constantsSource,constants:b.constants,requirements:{global:{AudioPlayr:"References/AudioPlayr/AudioPlayr.ts",ChangeLinr:"References/ChangeLinr/ChangeLinr.ts",FPSAnalyzr:"References/FPSAnalyzr/FPSAnalyzr.ts",GamesRunnr:"References/GamesRunnr/GamesRunnr.ts",GroupHoldr:"References/GroupHoldr/GroupHoldr.ts",InputWritr:"References/InputWritr/InputWritr.ts",LevelEditr:"References/LevelEditr/LevelEditr.ts",NumberMakr:"References/NumberMakr/NumberMakr.ts",MapScreenr:"References/MapScreenr/MapScreenr.ts",MapsHandlr:"References/MapsHandlr/MapsHandlr.ts",ModAttachr:"References/ModAttachr/ModAttachr.ts",ObjectMakr:"References/ObjectMakr/ObjectMakr.ts",PixelDrawr:"References/PixelDrawr/PixelDrawr.ts",PixelRendr:"References/PixelRendr/PixelRendr.ts",QuadsKeepr:"References/QuadsKeepr/QuadsKeepr.ts",StatsHoldr:"References/StatsHoldr/StatsHoldr.ts",StringFilr:"References/StringFilr/StringFilr.ts",ThingHittr:"References/ThingHittr/ThingHittr.ts",TimeHandlr:"References/TimeHandlr/TimeHandlr.ts"}}}),this.resets=["resetObjectMaker","resetPixelRender","resetTimeHandler","resetStatsHolder","resetAudioPlayer","resetQuadsKeeper","resetGamesRunner","resetGroupHolder","resetThingHitter","resetMapScreener","resetPixelDrawer","resetNumberMaker","resetMapsCreator","resetMapsHandler","resetInputWriter","resetLevelEditor","resetWorldSeeder","resetModAttacher","startModAttacher","resetContainer"]}return __extends(b,a),b.prototype.reset=function(a,b){EightBittr.EightBittr.prototype.reset(a,a.resets,b)},b.prototype.resetTimed=function(a,b){return EightBittr.EightBittr.prototype.resetTimed(a,a.resets,b)},b.prototype.resetObjectMaker=function(a){a.ObjectMaker=new ObjectMakr.ObjectMakr(a.proliferate({properties:{Quadrant:{EightBitter:a,GameStarter:a},Thing:{EightBitter:a,GameStarter:a}}},a.settings.objects))},b.prototype.resetQuadsKeeper=function(a,b){var c=b.width/(a.settings.quadrants.numCols-3),d=b.height/(a.settings.quadrants.numRows-2);a.QuadsKeeper=new QuadsKeepr.QuadsKeepr(a.proliferate({ObjectMaker:a.ObjectMaker,createCanvas:a.createCanvas,quadrantWidth:c,quadrantHeight:d,startLeft:-c,startHeight:-d,onAdd:a.onAreaSpawn.bind(a,a),onRemove:a.onAreaUnspawn.bind(a,a)},a.settings.quadrants))},b.prototype.resetPixelRender=function(a){a.PixelRender=new PixelRendr.PixelRendr(a.proliferate({scale:a.scale,QuadsKeeper:a.QuadsKeeper,unitsize:a.unitsize},a.settings.sprites))},b.prototype.resetPixelDrawer=function(a){a.PixelDrawer=new PixelDrawr.PixelDrawr(a.proliferate({PixelRender:a.PixelRender,MapScreener:a.MapScreener,createCanvas:a.createCanvas,unitsize:a.unitsize,generateObjectKey:a.generateObjectKey},a.settings.renderer))},b.prototype.resetTimeHandler=function(a){a.TimeHandler=new TimeHandlr.TimeHandlr(a.proliferate({classAdd:a.addClass,classRemove:a.removeClass},a.settings.events))},b.prototype.resetAudioPlayer=function(a){a.AudioPlayer=new AudioPlayr.AudioPlayr(a.proliferate({StatsHolder:a.StatsHolder},a.settings.audio))},b.prototype.resetGamesRunner=function(a){a.GamesRunner=new GamesRunnr.GamesRunnr(a.proliferate({adjustFramerate:!0,interval:1e3/60,scope:a,onPlay:a.onGamePlay.bind(a,a),onPause:a.onGamePause.bind(a,a),FPSAnalyzer:new FPSAnalyzr.FPSAnalyzr},a.settings.runner))},b.prototype.resetStatsHolder=function(a){a.StatsHolder=new StatsHoldr.StatsHoldr(a.proliferate({callbackArgs:[a]},a.settings.statistics))},b.prototype.resetGroupHolder=function(a){a.GroupHolder=new GroupHoldr.GroupHoldr(a.settings.groups)},b.prototype.resetThingHitter=function(a){a.ThingHitter=new ThingHittr.ThingHittr(a.proliferate({scope:a},a.settings.collisions))},b.prototype.resetMapScreener=function(a,b){a.MapScreener=new MapScreenr.MapScreenr({EightBitter:a,unitsize:a.unitsize,width:b.width,height:b.height,variableArgs:[a],variables:a.settings.maps.screenVariables})},b.prototype.resetNumberMaker=function(a){a.NumberMaker=new NumberMakr.NumberMakr},b.prototype.resetMapsCreator=function(a){a.MapsCreator=new MapsCreatr.MapsCreatr({ObjectMaker:a.ObjectMaker,groupTypes:a.settings.maps.groupTypes,macros:a.settings.maps.macros,entrances:a.settings.maps.entrances,maps:a.settings.maps.library,scope:a})},b.prototype.resetMapsHandler=function(a){a.MapsHandler=new MapsHandlr.MapsHandlr({MapsCreator:a.MapsCreator,MapScreener:a.MapScreener,screenAttributes:a.settings.maps.screenAttributes,onSpawn:a.settings.maps.onSpawn,onUnspawn:a.settings.maps.onUnspawn})},b.prototype.resetInputWriter=function(a){a.InputWriter=new InputWritr.InputWritr(a.proliferate({canTrigger:a.canInputsTrigger.bind(a,a)},a.settings.input.InputWritrArgs))},b.prototype.resetLevelEditor=function(a){a.LevelEditor=new LevelEditr.LevelEditr(a.proliferate({GameStarter:a,beautifier:js_beautify},a.settings.editor))},b.prototype.resetWorldSeeder=function(a){a.WorldSeeder=new WorldSeedr.WorldSeedr(a.proliferate({random:a.NumberMaker.random.bind(a.NumberMaker),onPlacement:a.mapPlaceRandomCommands.bind(a,a)},a.settings.generator))},b.prototype.resetModAttacher=function(a){a.ModAttacher=new ModAttachr.ModAttachr(a.proliferate({scopeDefault:a,StatsHoldr:a.StatsHolder},a.settings.mods))},b.prototype.startModAttacher=function(a,b){var c,d=b.mods;if(d)for(c in d)d.hasOwnProperty(c)&&d[c]&&a.ModAttacher.enableMod(c);a.ModAttacher.fireEvent("onReady",a,a)},b.prototype.resetContainer=function(a,b){a.container=a.createElement("div",{className:"EightBitter",style:a.proliferate({position:"relative",width:b.width+"px",height:b.height+"px"},b.style)}),a.canvas=a.createCanvas(b.width,b.height),a.PixelDrawer.setCanvas(a.canvas),a.container.appendChild(a.canvas)},b.prototype.scrollWindow=function(a,c){var d=b.prototype.ensureCorrectCaller(this);a=0|a,c=0|c,(a||c)&&(d.MapScreener.shift(a,c),d.shiftAll(-a,-c),d.QuadsKeeper.shiftQuadrants(-a,-c))},b.prototype.scrollThing=function(a,b,c){var d=a.left,e=a.top;a.GameStarter.scrollWindow(b,c),a.GameStarter.setLeft(a,d),a.GameStarter.setTop(a,e)},b.prototype.onAreaSpawn=function(a,b,c,d,e,f){a.MapsHandler.spawnMap(b,(c+a.MapScreener.top)/a.unitsize,(d+a.MapScreener.left)/a.unitsize,(e+a.MapScreener.top)/a.unitsize,(f+a.MapScreener.left)/a.unitsize)},b.prototype.onAreaUnspawn=function(a,b,c,d,e,f){a.MapsHandler.unspawnMap(b,(c+a.MapScreener.top)/a.unitsize,(d+a.MapScreener.left)/a.unitsize,(e+a.MapScreener.top)/a.unitsize,(f+a.MapScreener.left)/a.unitsize)},b.prototype.addThing=function(a,b,c){void 0===b&&(b=0),void 0===c&&(c=0);var d;return d="string"==typeof a||a instanceof String?this.ObjectMaker.make(a):a.constructor===Array?this.ObjectMaker.make.apply(this.ObjectMaker,a):a,arguments.length>2?(d.GameStarter.setLeft(d,b),d.GameStarter.setTop(d,c)):arguments.length>1&&d.GameStarter.setLeft(d,b),d.GameStarter.updateSize(d),d.GameStarter.GroupHolder.getFunctions().add[d.groupType](d),d.placed=!0,d.onThingAdd&&d.onThingAdd(d),d.GameStarter.PixelDrawer.setThingSprite(d),d.onThingAdded&&d.onThingAdded(d),d.GameStarter.ModAttacher.fireEvent("onAddThing",d,b,c),d},b.prototype.thingProcess=function(a,b,c,d){var e,f,g=4;a.title=a.title||b,a.width&&!a.spritewidth&&(a.spritewidth=d.spritewidth||d.width),a.height&&!a.spriteheight&&(a.spriteheight=d.spriteheight||d.height),e=Math.floor(a.width*(a.GameStarter.unitsize/a.GameStarter.QuadsKeeper.getQuadrantWidth())),e>0&&(g+=(e+1)*g/2),e=Math.floor(a.height*a.GameStarter.unitsize/a.GameStarter.QuadsKeeper.getQuadrantHeight()),e>0&&(g+=(e+1)*g/2),a.maxquads=g,a.quadrants=new Array(g),a.spritewidth=a.spritewidth||a.width,a.spriteheight=a.spriteheight||a.height,a.spritewidthpixels=a.spritewidth*a.GameStarter.unitsize,a.spriteheightpixels=a.spriteheight*a.GameStarter.unitsize,a.canvas=a.GameStarter.createCanvas(a.spritewidthpixels,a.spriteheightpixels),a.context=a.canvas.getContext("2d"),a.imageData=a.context.getImageData(0,0,a.spritewidthpixels,a.spriteheightpixels),1!==a.opacity&&a.GameStarter.setOpacity(a,a.opacity),a.attributes&&a.GameStarter.thingProcessAttributes(a,a.attributes),a.onThingMake&&a.onThingMake(a,c),a.GameStarter.setSize(a,a.width,a.height),a.GameStarter.setClassInitial(a,a.name||a.title),a.spriteCycle&&(f=a.spriteCycle,a.GameStarter.TimeHandler.addClassCycle(a,f[0],f[1]||null,f[2]||null)),(f=a.spriteCycleSynched)&&a.GameStarter.TimeHandler.addClassCycleSynched(a,f[0],f[1]||null,f[2]||null),a.flipHoriz&&a.GameStarter.flipHoriz(a),a.flipVert&&a.GameStarter.flipVert(a),a.GameStarter.ModAttacher.fireEvent("onThingMake",a.GameStarter,a,b,c,d)},b.prototype.thingProcessAttributes=function(a,b){var c;for(c in b)a[c]&&(a.GameStarter.proliferate(a,b[c]),a.name?a.name+=" "+c:a.name=a.title+" "+c)},b.prototype.mapPlaceRandomCommands=function(a,b){var c,d,e,f=a.MapsCreator,g=a.MapsHandler,h=g.getPreThings(),i=g.getArea(),j=g.getMap();for(e=0;e<b.length;e+=1)c=b[e],d={thing:c.title,x:c.left,y:c.top},c.arguments&&a.proliferateHard(d,c.arguments,!0),f.analyzePreSwitch(d,h,i,j)},b.prototype.onGamePlay=function(a){a.AudioPlayer.resumeAll(),a.ModAttacher.fireEvent("onGamePlay")},b.prototype.onGamePause=function(a){a.AudioPlayer.pauseAll(),a.ModAttacher.fireEvent("onGamePause")},b.prototype.canInputsTrigger=function(){return!0},b.prototype.gameStart=function(){this.ModAttacher.fireEvent("onGameStart")},b.prototype.markChanged=function(a){a.changed=!0},b.prototype.shiftVert=function(a,b,c){EightBittr.EightBittr.prototype.shiftVert(a,b),c||a.GameStarter.markChanged(a)},b.prototype.shiftHoriz=function(a,b,c){EightBittr.EightBittr.prototype.shiftHoriz(a,b),c||a.GameStarter.markChanged(a)},b.prototype.setTop=function(a,b){EightBittr.EightBittr.prototype.setTop(a,b),a.GameStarter.markChanged(a)},b.prototype.setRight=function(a,b){EightBittr.EightBittr.prototype.setRight(a,b),a.GameStarter.markChanged(a)},b.prototype.setBottom=function(a,b){EightBittr.EightBittr.prototype.setBottom(a,b),a.GameStarter.markChanged(a)},b.prototype.setLeft=function(a,b){EightBittr.EightBittr.prototype.setLeft(a,b),a.GameStarter.markChanged(a)},b.prototype.shiftBoth=function(a,b,c,d){b=b||0,c=c||0,a.noshiftx||(a.parallaxHoriz?a.GameStarter.shiftHoriz(a,a.parallaxHoriz*b,d):a.GameStarter.shiftHoriz(a,b,d)),a.noshifty||(a.parallaxVert?a.GameStarter.shiftVert(a,a.parallaxVert*c,d):a.GameStarter.shiftVert(a,c,d))},b.prototype.shiftThings=function(a,b,c,d){for(var e=a.length-1;e>=0;e-=1)a[e].GameStarter.shiftBoth(a[e],b,c,d)},b.prototype.shiftAll=function(a,c){var d=b.prototype.ensureCorrectCaller(this);d.GroupHolder.callAll(d,d.shiftThings,a,c,!0)},b.prototype.setWidth=function(a,b,c,d){a.width=b,a.unitwidth=b*a.GameStarter.unitsize,c&&(a.spritewidth=b,a.spritewidthpixels=b*a.GameStarter.unitsize),d&&a.GameStarter.updateSize(a),a.GameStarter.markChanged(a)},b.prototype.setHeight=function(a,b,c,d){a.height=b,a.unitheight=b*a.GameStarter.unitsize,c&&(a.spriteheight=b,a.spriteheightpixels=b*a.GameStarter.unitsize),d&&a.GameStarter.updateSize(a),a.GameStarter.markChanged(a)},b.prototype.setSize=function(a,b,c,d,e){a.GameStarter.setWidth(a,b,d,e),a.GameStarter.setHeight(a,c,d,e)},b.prototype.updatePosition=function(a){a.GameStarter.shiftHoriz(a,a.xvel),a.GameStarter.shiftVert(a,a.yvel)},b.prototype.updateSize=function(a){a.unitwidth=a.width*a.GameStarter.unitsize,a.unitheight=a.height*a.GameStarter.unitsize,a.spritewidthpixels=a.spritewidth*a.GameStarter.unitsize,a.spriteheightpixels=a.spriteheight*a.GameStarter.unitsize,a.canvas.width=a.spritewidthpixels,a.canvas.height=a.spriteheightpixels,a.GameStarter.PixelDrawer.setThingSprite(a),a.GameStarter.markChanged(a)},b.prototype.reduceWidth=function(a,b,c){a.right-=b,a.width-=b/a.GameStarter.unitsize,c?a.GameStarter.updateSize(a):a.GameStarter.markChanged(a)},b.prototype.reduceHeight=function(a,b,c){a.top+=b,a.height-=b/a.GameStarter.unitsize,c?a.GameStarter.updateSize(a):a.GameStarter.markChanged(a)},b.prototype.increaseHeight=function(a,b,c){a.top-=b,a.height+=b/a.GameStarter.unitsize,a.unitheight=a.height*a.GameStarter.unitsize,c?a.GameStarter.updateSize(a):a.GameStarter.markChanged(a)},b.prototype.increaseWidth=function(a,b,c){a.right+=b,a.width+=b/a.GameStarter.unitsize,a.unitwidth=a.width*a.GameStarter.unitsize,c?a.GameStarter.updateSize(a):a.GameStarter.markChanged(a)},b.prototype.thingPauseVelocity=function(a,b){a.xvelOld=a.xvel||0,a.yvelOld=a.yvel||0,a.nofallOld=a.nofall||!1,a.nocollideOld=a.nocollide||!1,a.movementOld=a.movement||a.movementOld,a.nofall=a.nocollide=!0,a.xvel=a.yvel=0,b||(a.movement=void 0)},b.prototype.thingResumeVelocity=function(a,b){b||(a.xvel=a.xvelOld||0,a.yvel=a.yvelOld||0),a.movement=a.movementOld||a.movement,a.nofall=a.nofallOld||!1,a.nocollide=a.nocollideOld||!1},b.prototype.generateObjectKey=function(a){return a.GameStarter.MapsHandler.getArea().setting+" "+a.groupType+" "+a.title+" "+a.className},b.prototype.setClass=function(a,b){a.className=b,a.GameStarter.PixelDrawer.setThingSprite(a),a.GameStarter.markChanged(a)},b.prototype.setClassInitial=function(a,b){a.className=b},b.prototype.addClass=function(a,b){a.className+=" "+b,a.GameStarter.PixelDrawer.setThingSprite(a),a.GameStarter.markChanged(a)},b.prototype.addClasses=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];var d,e,f;for(e=0;e<b.length;e+=1)for(d=b[e],(d.constructor===String||"string"==typeof d)&&(d=d.split(" ")),f=d.length-1;f>=0;f-=1)a.GameStarter.addClass(a,d[f])},b.prototype.removeClass=function(a,b){b&&(-1!==b.indexOf(" ")&&a.GameStarter.removeClasses(a,b),a.className=a.className.replace(new RegExp(" "+b,"gm"),""),a.GameStarter.PixelDrawer.setThingSprite(a))},b.prototype.removeClasses=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];var d,e,f;for(e=0;e<b.length;e+=1)for(d=b[e],(d.constructor===String||"string"==typeof d)&&(d=d.split(" ")),f=d.length-1;f>=0;--f)a.GameStarter.removeClass(a,d[f])},b.prototype.hasClass=function(a,b){return-1!==a.className.indexOf(b)},b.prototype.switchClass=function(a,b,c){a.GameStarter.removeClass(a,b),a.GameStarter.addClass(a,c)},b.prototype.flipHoriz=function(a){a.flipHoriz=!0,a.GameStarter.addClass(a,"flipped")},b.prototype.flipVert=function(a){a.flipVert=!0,a.GameStarter.addClass(a,"flip-vert")},b.prototype.unflipHoriz=function(a){a.flipHoriz=!1,a.GameStarter.removeClass(a,"flipped")},b.prototype.unflipVert=function(a){a.flipVert=!1,a.GameStarter.removeClass(a,"flip-vert")},b.prototype.setOpacity=function(a,b){a.opacity=b,a.GameStarter.markChanged(a)},b.prototype.ensureCorrectCaller=function(a){if(!(a instanceof b))throw new Error("A function requires the scope ('this') to be the manipulated GameStartr object. Unfortunately, 'this' is a "+typeof this+".");return a},b.prototype.arrayDeleteThing=function(a,b,c){void 0===c&&(c=b.indexOf(a)),-1!==c&&(b.splice(c,1),"function"==typeof a.onDelete&&a.onDelete(a))},b.prototype.takeScreenshot=function(a,c){void 0===c&&(c="image/png");var d=b.prototype.ensureCorrectCaller(this),e=d.createElement("a",{download:a+"."+c.split("/")[1],href:d.canvas.toDataURL(c).replace(c,"image/octet-stream")});e.click()},b.prototype.addPageStyles=function(a){var c,d,e=b.prototype.ensureCorrectCaller(this),f=e.createElement("style",{type:"text/css"}),g="";for(c in a)if(a.hasOwnProperty(c)){g+=c+" { \r\n";for(d in a[c])a[c].hasOwnProperty(d)&&(g+="  "+d+": "+a[c][d]+";\r\n");g+="}\r\n"}f.styleSheet?f.style.cssText=g:f.appendChild(document.createTextNode(g)),document.querySelector("head").appendChild(f)},b}(EightBittr.EightBittr);a.GameStartr=b}(GameStartr||(GameStartr={}));var UserWrappr;!function(a){"use strict";var b=function(){function a(a){this.documentElement=document.documentElement,this.requestFullScreen=(this.documentElement.requestFullScreen||this.documentElement.webkitRequestFullScreen||this.documentElement.mozRequestFullScreen||this.documentElement.msRequestFullscreen||function(){console.warn("Not able to request full screen...")}).bind(this.documentElement),this.cancelFullScreen=(this.documentElement.cancelFullScreen||this.documentElement.webkitCancelFullScreen||this.documentElement.mozCancelFullScreen||this.documentElement.msCancelFullScreen||function(){console.warn("Not able to cancel full screen...")}).bind(document),this.customs=a.customs||{},this.GameStartrConstructor=a.GameStartrConstructor,this.settings=a,this.helpSettings=this.settings.helpSettings,this.globalName=a.globalName,this.importSizes(a.sizes),this.gameNameAlias=this.helpSettings.globalNameAlias||"{%%%%GAME%%%%}",this.gameElementSelector=a.gameElementSelector||"#game",this.gameControlsSelector=a.gameControlsSelector||"#controls",this.log=a.log||console.log.bind(console),this.isFullScreen=!1,this.setCurrentSize(this.sizes[a.sizeDefault]),this.allPossibleKeys=a.allPossibleKeys||["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","up","right","down","left","space","shift","ctrl"],this.GameStartrConstructor.prototype.proliferate(this.customs,this.currentSize,!0),this.resetGameStarter(a,this.customs)}return a.prototype.resetGameStarter=function(a,b){void 0===b&&(b={}),this.loadGameStarter(this.fixCustoms(b||{})),window[a.globalName||"GameStarter"]=this.GameStarter,this.GameStarter.UserWrapper=this,this.loadGenerators(),this.loadControls(a.schemas),a.styleSheet&&this.GameStarter.addPageStyles(a.styleSheet),this.resetPageVisibilityHandlers(),this.GameStarter.gameStart()},a.prototype.getGameStartrConstructor=function(){return this.GameStartrConstructor},a.prototype.getGameStarter=function(){return this.GameStarter},a.prototype.getStatsHolder=function(){return this.StatsHolder},a.prototype.getSettings=function(){return this.settings},a.prototype.getCustoms=function(){return this.customs},a.prototype.getHelpSettings=function(){return this.helpSettings},a.prototype.getGlobalName=function(){return this.globalName},a.prototype.getGameNameAlias=function(){return this.gameNameAlias},a.prototype.getAllPossibleKeys=function(){return this.allPossibleKeys},a.prototype.getSizes=function(){return this.sizes},a.prototype.getCurrentSize=function(){return this.currentSize},a.prototype.getIsFullScreen=function(){return this.isFullScreen},a.prototype.getIsPageHidden=function(){return this.isPageHidden},a.prototype.getLog=function(){return this.log},a.prototype.getGenerators=function(){return this.generators},a.prototype.getDocumentElement=function(){return this.documentElement},a.prototype.getRequestFullScreen=function(){return this.requestFullScreen},a.prototype.getCancelFullScreen=function(){return this.cancelFullScreen},a.prototype.setCurrentSize=function(a){if("string"==typeof a||a.constructor===String){if(!this.sizes.hasOwnProperty(a))throw new Error("Size "+a+" does not exist on the UserWrappr.");a=this.sizes[a]}this.customs=this.fixCustoms(this.customs),a.full?(this.requestFullScreen(),this.isFullScreen=!0):this.isFullScreen&&(this.cancelFullScreen(),this.isFullScreen=!1),this.currentSize=a,this.GameStarter&&(this.GameStarter.container.parentNode.removeChild(this.GameStarter.container),this.resetGameStarter(this.settings,this.customs))},a.prototype.displayHelpMenu=function(){this.helpSettings.openings.forEach(this.logHelpText.bind(this))},a.prototype.displayHelpOptions=function(){this.logHelpText("To focus on a group, enter `"+this.globalName+'.UserWrapper.displayHelpOption("<group-name>");`'),Object.keys(this.helpSettings.options).forEach(this.displayHelpGroupSummary.bind(this)),this.logHelpText("\nTo focus on a group, enter `"+this.globalName+'.UserWrapper.displayHelpOption("<group-name>");`')},a.prototype.displayHelpGroupSummary=function(a){var b,c,d=this.helpSettings.options[a],e=0;for(this.log("\n"+a),c=0;c<d.length;c+=1)e=Math.max(e,this.filterHelpText(d[c].title).length);for(c=0;c<d.length;c+=1)b=d[c],this.log(this.padTextRight(this.filterHelpText(b.title),e)+" ... "+b.description)},a.prototype.displayHelpOption=function(a){var b,c,d,e,f,g=this.helpSettings.options[a];for(e=0;e<g.length;e+=1){if(b=g[e],d=0,this.logHelpText(b.title+" -- "+b.description),b.usage&&this.logHelpText(b.usage),b.examples){for(f=0;f<b.examples.length;f+=1)c=b.examples[f],d=Math.max(d,this.filterHelpText("    "+c.code).length);for(f=0;f<b.examples.length;f+=1)c=b.examples[f],this.logHelpText(this.padTextRight(this.filterHelpText("    "+c.code),d)+"  // "+c.comment)}this.log("\n")}},a.prototype.logHelpText=function(a){this.log(this.filterHelpText(a))},a.prototype.filterHelpText=function(a){return a.replace(new RegExp(this.gameNameAlias,"g"),this.globalName)},a.prototype.padTextRight=function(a,b){var c=1+b-a.length;return 0>=c?a:a+Array.call(Array,c).join(" ")},a.prototype.importSizes=function(a){var b;this.sizes=this.GameStartrConstructor.prototype.proliferate({},a);for(b in this.sizes)this.sizes.hasOwnProperty(b)&&(this.sizes[b].name=this.sizes[b].name||b)},a.prototype.fixCustoms=function(a){var b=this.GameStartrConstructor.prototype.proliferate({},a);return this.GameStartrConstructor.prototype.proliferate(b,this.currentSize),isFinite(b.width)||(b.width=document.body.clientWidth),isFinite(b.height)||(b.height=b.full?screen.height:this.isFullScreen?window.innerHeight-140:window.innerHeight,b.height-=84),b},a.prototype.resetPageVisibilityHandlers=function(){document.addEventListener("visibilitychange",this.handleVisibilityChange.bind(this))},a.prototype.handleVisibilityChange=function(){switch(document.visibilityState){case"hidden":return void this.onPageHidden();case"visible":return void this.onPageVisible();default:return}},a.prototype.onPageHidden=function(){this.GameStarter.GamesRunner.getPaused()||(this.isPageHidden=!0,this.GameStarter.GamesRunner.pause())},a.prototype.onPageVisible=function(){this.isPageHidden&&(this.isPageHidden=!1,this.GameStarter.GamesRunner.play())},a.prototype.loadGameStarter=function(a){var b=document.querySelector(this.gameElementSelector);this.GameStarter&&this.GameStarter.GamesRunner.pause(),this.GameStarter=new this.GameStartrConstructor(a),b.textContent="",b.appendChild(this.GameStarter.container),this.GameStarter.proliferate(document.body,{onkeydown:this.GameStarter.InputWriter.makePipe("onkeydown","keyCode"),onkeyup:this.GameStarter.InputWriter.makePipe("onkeyup","keyCode")}),this.GameStarter.proliferate(b,{onmousedown:this.GameStarter.InputWriter.makePipe("onmousedown","which"),oncontextmenu:this.GameStarter.InputWriter.makePipe("oncontextmenu",null,!0)})},a.prototype.loadGenerators=function(){this.generators={OptionsButtons:new c.OptionsButtonsGenerator(this),OptionsTable:new c.OptionsTableGenerator(this),LevelEditor:new c.LevelEditorGenerator(this),MapsGrid:new c.MapsGridGenerator(this)}},a.prototype.loadControls=function(a){var b,c=document.querySelector(this.gameControlsSelector),d=a.length;for(this.StatsHolder=new StatsHoldr.StatsHoldr({prefix:this.globalName+"::UserWrapper::StatsHolder",proliferate:this.GameStarter.proliferate,createElement:this.GameStarter.createElement}),c.textContent="",c.className="length-"+d,b=0;d>b;b+=1)c.appendChild(this.loadControlDiv(a[b]))},a.prototype.loadControlDiv=function(a){var b=document.createElement("div"),c=document.createElement("h4"),d=document.createElement("div");return b.className="control",b.id="control-"+a.title,c.textContent=a.title,d.className="control-inner",d.appendChild(this.generators[a.generator].generate(a)),b.appendChild(c),b.appendChild(d),b.onmouseover=setTimeout.bind(void 0,function(){b.setAttribute("active","on")},35),b.onmouseout=function(){b.setAttribute("active","off")},b},a}();a.UserWrappr=b;var c;!function(a){var b=function(){function a(a){this.UserWrapper=a,this.GameStarter=this.UserWrapper.getGameStarter()}return a.prototype.generate=function(){throw new Error("AbstractOptionsGenerator is abstract. Subclass it.")},a.prototype.getParentControlDiv=function(a){return"control"===a.className?a:a.parentNode?this.getParentControlDiv(a.parentElement):void 0},a.prototype.ensureLocalStorageValue=function(a,b,c){if(a.constructor===Array)return void this.ensureLocalStorageValues(a,b,c);var d,e=a,f=c.title+"::"+b.title,g=b.source.call(this,this.GameStarter).toString();e.setAttribute("localStorageKey",f),this.GameStarter.StatsHolder.addItem(f,{storeLocally:!0,valueDefault:g}),d=this.GameStarter.StatsHolder.getItem(f),""!==d&&d!==e.value&&(e.value=d,e.setValue?e.setValue(d):e.onchange?e.onchange(void 0):e.onclick&&e.onclick(void 0))},a.prototype.ensureLocalStorageValues=function(a,b,c){var d,e,f,g,h=c.title+"::"+b.title,i=b.source.call(this,this.GameStarter);for(g=0;g<a.length;g+=1)d=h+"::"+g,f=a[g],f.setAttribute("localStorageKey",d),this.GameStarter.StatsHolder.addItem(d,{storeLocally:!0,valueDefault:i[g]}),e=this.GameStarter.StatsHolder.getItem(d),""!==e&&e!==f.value&&(f.value=e,f.onchange?f.onchange(void 0):f.onclick&&f.onclick(void 0))},a.prototype.storeLocalStorageValue=function(a,b){var c=a.getAttribute("localStorageKey");c&&this.GameStarter.StatsHolder.setItem(c,b)},a}();a.AbstractOptionsGenerator=b;var c=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.generate=function(a){var b,c,d,e=document.createElement("div"),f=a.options instanceof Function?a.options.call(self,this.GameStarter):a.options,g=Object.keys(f),h=a.keyActive||"active",i="select-option options-button-option",j=this;for(e.className="select-options select-options-buttons",d=0;d<g.length;d+=1)b=f[g[d]],c=document.createElement("div"),c.className=i,c.textContent=g[d],c.onclick=function(a,b){"on"===j.getParentControlDiv(b).getAttribute("active")&&(a.callback.call(j,j.GameStarter,a,b),"true"===b.getAttribute("option-enabled")?(b.setAttribute("option-enabled","false"),b.className=i+" option-disabled"):(b.setAttribute("option-enabled","true"),b.className=i+" option-enabled"))}.bind(void 0,a,c),b[h]?(c.className+=" option-enabled",c.setAttribute("option-enabled","true")):a.assumeInactive?(c.className+=" option-disabled",c.setAttribute("option-enabled","false")):c.setAttribute("option-enabled","true"),e.appendChild(c);return e},b}(b);a.OptionsButtonsGenerator=c;var d=function(a){function b(){a.apply(this,arguments),this.optionTypes={Boolean:this.setBooleanInput,Keys:this.setKeyInput,Number:this.setNumberInput,Select:this.setSelectInput,ScreenSize:this.setScreenSizeInput}}return __extends(b,a),b.prototype.generate=function(a){var b,c,d,e,f,g,h,i=document.createElement("div"),j=document.createElement("table");if(i.className="select-options select-options-table",a.options)for(h=0;h<a.options.length;h+=1)d=document.createElement("tr"),e=document.createElement("td"),f=document.createElement("td"),b=a.options[h],e.className="options-label-"+b.type,e.textContent=b.title,f.className="options-cell-"+b.type,d.appendChild(e),d.appendChild(f),g=this.optionTypes[a.options[h].type].call(this,f,b,a),b.storeLocally&&this.ensureLocalStorageValue(g,b,a),j.appendChild(d);if(i.appendChild(j),a.actions)for(h=0;h<a.actions.length;h+=1)d=document.createElement("div"),c=a.actions[h],d.className="select-option options-button-option",d.textContent=c.title,d.onclick=c.action.bind(this,this.GameStarter),i.appendChild(d);return i},b.prototype.setBooleanInput=function(a,b){var c=b.source.call(this,this.GameStarter),d=c?"enabled":"disabled",e=this;return a.className="select-option options-button-option option-"+d,a.textContent=c?"on":"off",a.onclick=function(){a.setValue("off"===a.textContent)},a.setValue=function(c){c.constructor===String&&("false"===c||"off"===c?c=!1:("true"===c||"on"===c)&&(c=!0)),c?(b.enable.call(e,e.GameStarter),a.textContent="on",a.className=a.className.replace("disabled","enabled")):(b.disable.call(e,e.GameStarter),a.textContent="off",a.className=a.className.replace("enabled","disabled")),b.storeLocally&&e.storeLocalStorageValue(a,c.toString())},a},b.prototype.setKeyInput=function(a,b){var c,d,e,f=b.source.call(this,this.GameStarter),g=[],h=this;for(d=0;d<f.length;d+=1){for(c=document.createElement("select"),c.className="options-key-option",e=0;e<this.UserWrapper.getAllPossibleKeys().length;e+=1)c.appendChild(new Option(this.UserWrapper.getAllPossibleKeys()[e]));c.value=c.valueOld=f[d].toLowerCase(),c.onchange=function(a){b.callback.call(h,h.GameStarter,a.valueOld,a.value),b.storeLocally&&h.storeLocalStorageValue(a,a.value)}.bind(void 0,c),g.push(c),a.appendChild(c)}return g},b.prototype.setNumberInput=function(a,b){var c=document.createElement("input"),d=this;return c.type="number",c.value=Number(b.source.call(d,d.GameStarter)).toString(),c.min=(b.minimum||0).toString(),c.max=(b.maximum||Math.max(b.minimum+10,10)).toString(),c.onchange=c.oninput=function(){c.checkValidity()&&b.update.call(d,d.GameStarter,c.value),b.storeLocally&&d.storeLocalStorageValue(c,c.value)},a.appendChild(c),c},b.prototype.setSelectInput=function(a,b){var c,d=document.createElement("select"),e=b.options(this.GameStarter),f=this;for(c=0;c<e.length;c+=1)d.appendChild(new Option(e[c]));return d.value=b.source.call(f,f.GameStarter),d.onchange=function(){b.update.call(f,f.GameStarter,d.value),d.blur(),b.storeLocally&&f.storeLocalStorageValue(d,d.value)},a.appendChild(d),d},b.prototype.setScreenSizeInput=function(a,b,c){var d,e=this;return b.options=function(){return Object.keys(e.UserWrapper.getSizes())},b.source=function(){return e.UserWrapper.getCurrentSize().name},b.update=function(a,b){return b===e.UserWrapper.getCurrentSize()?void 0:void e.UserWrapper.setCurrentSize(b)},d=e.setSelectInput(a,b,c)},b}(b);a.OptionsTableGenerator=d;var e=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.generate=function(){var a=document.createElement("div"),b=document.createElement("div"),c=document.createElement("div"),d=document.createElement("div"),e=this.createUploaderDiv(),f=this;return a.className="select-options select-options-level-editor",b.className="select-option-title",b.textContent="Create your own custom levels:",c.className="select-option select-option-large options-button-option",
c.innerHTML="Start the <br /> Level Editor!",c.onclick=function(){f.GameStarter.LevelEditor.enable()},d.className="select-option-title",d.innerHTML="<em>- or -</em><br />",a.appendChild(b),a.appendChild(c),a.appendChild(d),a.appendChild(e),a},b.prototype.createUploaderDiv=function(){var a=document.createElement("div"),b=document.createElement("input");return a.className="select-option select-option-large options-button-option",a.textContent="Click to upload and continue your editor files!",a.setAttribute("textOld",a.textContent),b.type="file",b.className="select-upload-input",b.onchange=this.handleFileDrop.bind(this,b,a),a.ondragenter=this.handleFileDragEnter.bind(this,a),a.ondragover=this.handleFileDragOver.bind(this,a),a.ondragleave=b.ondragend=this.handleFileDragLeave.bind(this,a),a.ondrop=this.handleFileDrop.bind(this,b,a),a.onclick=b.click.bind(b),a.appendChild(b),a},b.prototype.handleFileDragEnter=function(a,b){b.dataTransfer&&(b.dataTransfer.dropEffect="copy"),a.className+=" hovering"},b.prototype.handleFileDragOver=function(a,b){return b.preventDefault(),!1},b.prototype.handleFileDragLeave=function(a,b){b.dataTransfer&&(b.dataTransfer.dropEffect="none"),a.className=a.className.replace(" hovering","")},b.prototype.handleFileDrop=function(a,b,c){var d=a.files||c.dataTransfer.files,e=d[0],f=new FileReader;this.handleFileDragLeave(a,c),c.preventDefault(),c.stopPropagation(),f.onprogress=this.handleFileUploadProgress.bind(this,e,b),f.onloadend=this.handleFileUploadCompletion.bind(this,e,b),f.readAsText(e)},b.prototype.handleFileUploadProgress=function(a,b,c){var d;c.lengthComputable&&(d=Math.round(c.loaded/c.total*100),d>100&&(d=100),b.innerText="Uploading '"+a.name+"' ("+d+"%)...")},b.prototype.handleFileUploadCompletion=function(a,b,c){this.GameStarter.LevelEditor.handleUploadCompletion(c),b.innerText=b.getAttribute("textOld")},b}(b);a.LevelEditorGenerator=e;var f=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.generate=function(a){var b=document.createElement("div");return b.className="select-options select-options-maps-grid",a.rangeX&&a.rangeY&&b.appendChild(this.generateRangedTable(a)),a.extras&&this.appendExtras(b,a),b},b.prototype.generateRangedTable=function(a){var b,c,d,e,f=this,g=document.createElement("table"),h=a.rangeX,i=a.rangeY;for(d=i[0];d<=i[1];d+=1){for(b=document.createElement("tr"),b.className="maps-grid-row",e=h[0];e<=h[1];e+=1)c=document.createElement("td"),c.className="select-option maps-grid-option maps-grid-option-range",c.textContent=d+"-"+e,c.onclick=function(a){"on"===f.getParentControlDiv(c).getAttribute("active")&&a()}.bind(f,a.callback.bind(f,f.GameStarter,a,c)),b.appendChild(c);g.appendChild(b)}return g},b.prototype.appendExtras=function(a,b){var c,d,e,f;for(e in b.extras)if(b.extras.hasOwnProperty(e)&&(d=b.extras[e],c=document.createElement("div"),c.className="select-option maps-grid-option maps-grid-option-extra",c.textContent=d.title,c.setAttribute("value",d.title),c.onclick=d.callback.bind(this,this.GameStarter,b,c),a.appendChild(c),d.extraElements))for(f=0;f<d.extraElements.length;f+=1)a.appendChild(this.GameStarter.createElement.apply(this.GameStarter,d.extraElements[f]))},b}(b);a.MapsGridGenerator=f}(c=a.UISchemas||(a.UISchemas={}))}(UserWrappr||(UserWrappr={}));
//# sourceMappingURL=UserWrappr-0.2.0.min.js.map